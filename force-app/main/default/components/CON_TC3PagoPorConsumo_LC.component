<!--
  @description       : 
  @author            : Noe Vasquez
  @group             : 
  @last modified on  : 07-29-2024
  @last modified by  : Noe Vasquez
-->

  <apex:component controller="CON_ContractsContainer_CTRL">
      <script type="text/javascript">
          var contrato = {};
          var dataSource;
          var productsArgCodes = ['XC', 'YC'];

          var nombreProductoOriginal = '{!QuoteLineItem.Product2.Name}';
          var nombreProducto = '{!QuoteLineItem.Product2.Name}';
          console.log('Nombre del producto: ' + nombreProducto);
          console.log('UserId: ' + '{!managerName}')
          $(function () {
              console.log('quoteId: ' + '{!QuoteLineItemId}');
              console.log('QuoteName: ' + '{!QuoteLineItem.Product2.Name}');
              //Product2.ProductCode
              kendo.pdf.defineFont({
                  "DejaVu Sans": "{!URLFOR($Resource.kendoui,'/fonts/DejaVuSans.ttf')}",
                  "DejaVu Sans|Bold": "{!URLFOR($Resource.kendoui,'/fonts/DejaVuSans-Bold.ttf')}",
                  "DejaVu Sans|Bold|Italic": "{!URLFOR($Resource.kendoui,'/fonts/DejaVuSans-Oblique.ttf')}",
                  "DejaVu Sans|Italic": "{!URLFOR($Resource.kendoui,'/fonts/DejaVuSans-Oblique.ttf')}",
                  "Helvetica": "{!URLFOR($Resource.kendoui,'/fonts/Helvetica-Regular.ttf')}",
                  "Helvetica|Bold": "{!URLFOR($Resource.kendoui,'/fonts/Helvetica-Bold.ttf')}",
                  "Helvetica|Bold|Italic": "{!URLFOR($Resource.kendoui,'/fonts/Helvetica-BoldItalic.ttf')}",
                  "Helvetica|Italic": "{!URLFOR($Resource.kendoui,'/fonts/Helvetica-Italic.ttf')}",
  
              });
          });
  
          var _prodCode;//REQ: 6452
          var _prodsCode;//REQ: 6452
  
          function getProds() {//REQ: 6452
              return ctcLightning.remote("PLAN_CuentaService.query")("SELECT Id, productCode, (SELECT Id, Producto_secundario__c, ProductCode__c FROM Productos_secundarios__r) FROM Product2 WHERE Id ='{!QuoteLineItem.Product2}'")
              .then(function (res) {
                  console.debug('PDF1', res);
                  if(res.length > 0) {
                      console.debug('PDF2');
                      for( var product of res ) {
                          console.debug('PDF3');
                          if(undefined != product.Productos_secundarios__r && 
                              product.Productos_secundarios__r.length > 0) 
                              _prodsCode = product.Productos_secundarios__r;
                      }
                      
                  }
              })
          }
  
          function pdf() {//REQ: 6452
              getProds().then(function() {
                  console.debug('PDF');
                  if(undefined != _prodsCode && _prodsCode.length > 0) {
                      var time = 0;
                      console.log('NVH-_prodsCode ', _prodsCode);
                      for(var cod of _prodsCode) {
                          setTimeout(callPDFs, time, cod.ProductCode__c);
                          time = time+10000;
                      }                    
                  } else {
                      generaPDF();
                  }
              })
          }
  
          function callPDFs(_cod) { //REQ: 6452
              _prodCode = _cod;
              generaPDF();
          }

          // NVH -- Arg
        function buildConceptArg(dataSource, concepto, tipoConcepto) {
            let vigencia = concepto.VigenciaDescuento__c;
            
            let dateV;
            if(vigencia) {
                dateV = new Date(vigencia);
                let dia = dateV.getUTCDate().toString().length > 1 ? dateV.getUTCDate() + '' : '0' + dateV.getUTCDate();
                let mes = (dateV.getUTCMonth() + 1).toString().length > 1 ? (dateV.getUTCMonth() + 1) + '' : '0' + (dateV.getUTCMonth() + 1);
                vigencia = dia + '-' + mes + '-' + dateV.getUTCFullYear();
            }
            else {
                vigencia = '';
            }
            let concept = {
                
                    'PrecioFinal__c': concepto.PrecioFinal__c,
                    'Bonificacion__c': concepto.Bonificacion__c,
                    'VigenciaDescuento__c': vigencia,
                    'GLBAr_Currency__c': concepto.GLBAr_Currency__c,
                    'PrecioLista__c': concepto.PrecioLista__c

                
            }
            if (typeof dataSource['ProductoConcepto'] !== 'object' || dataSource['ProductoConcepto'] === null) {
                dataSource['ProductoConcepto'] = {};
            }

            dataSource['ProductoConcepto'][tipoConcepto] = concept;
        }
  
          (function (window) {
              "use strict"
  
              window.generaPDF = function () {
  
                  /*ctcLightning.remote("CON_ContractsContainer_CTRL.executeQueryRA")("SELECT Id, Name, AnexoA__c, AnexoB__c, AnexoC__c, AnexoD__c, AnexoE__c, Contenido_del__c FROM PlantillaContrato__c")
                  .then( function( res ) {
                      console.log(" success response: ", res)
                      var templates = {}
                      for( var template of res ) {
                          templates[ template.Name ] = {}
                          for( var field of ['AnexoA__c', 'AnexoB__c', 'AnexoC__c', 'AnexoD__c', 'AnexoE__c', 'Contenido_del__c'])  {
                              if( template[ field ] ) {
                                  var e = document.createElement('div');
                                  e.innerHTML = template[ field ];
                                  var textHtml = e.childNodes[0].nodeValue
                                  // templates[ template.Name ][ field ] = getExpresiones(textHtml)
  
  
                                  var ret = {};
                                  textHtml.split('\{').forEach( function( token, index ) {
                                      if ( token.indexOf('}') != - 1 ) {
                                          ret['{' + token.substr(0, token.indexOf('}') + 1)] = ''
                                      } else if( token.indexOf(')') != - 1 ) {
                                          // ret['{' + token.substr(0, token.indexOf(')') + 1)] = ''
                                      }
                                  })
                                  templates[ template.Name ][ field ] = ret;
                              }
                          }
                      }
                      console.log("templates: ", templates, JSON.stringify(templates))
  
                  }).catch( function( err ) {
                      console.log("error response: ", err)
                  })*/
  
                  console.log("ctcLightning: ", ctcLightning);
                  var prodCode = _prodCode;//REQ: 6452
                  var contrato = {}
                  var creditDays = ''
                  var dataSource = {}
                  var dataConcept = {}    //Conceptos
                  var plantilla = {}
                  var maquilaTempleate = {};
                  var query = ''
                  var nombreProducto = ''
                  var anexos = {}
                  var filiales = []
                  var representantes = []
                  var entidadLegal = []
                  var contactos = []
                  var templateFiliales = ''
                  var templateConceptos = ''
                  var templateDatosRepLegales = '';
                  var templateRepLegalesFirma = '';
                  var nombresRepLegales = '';
                  var titularAMEX = '';
                  var cantidadRepLegales = 0;
                  var conceptsListTC4 = {
                      'Comisión por el servicio': {}, 
                      'Comisión por Servicio Telepeaje' : {}, 
                      'TAG Telepeaje' : {}, 
                      'Comisión por servicio piloto': {}, 
                      'Cargo por envío - Recurrente': {},
                      'Cargo por envío estándar': {},					
                      'Cargo por refacturacion': {}, 
                      'Anualidad - Grande': {},
                      'Anualidad - Pyme': {}, 
                      'Cuota por impresión de logo a color': {}, 
                      'Cuota por renta mensual TAG': {}, 
                      'Cuota por transacción con TAG': {},
                      'TAG Ticket Car': {}, 
                      'Cargo por tarjeta activa': {}, 
                      'Reposición de tarjetas': {}, 
                      'Tarjeta titular': {}, 
                      'Cuota de adscripción - Grande': {}, 
                      'Cuota de adscripción - Pyme': {}, 
                      'Renta de plataforma': {}, 
                      'Cobro por gestion de vehiculos': {},
                      'Cargo por envío': {},
                      'Vehiculo/Mes NFC':{},  
                      'Tarjeta stock': {}, 
                      'Etiqueta de Presencia TAG NFC' : {}, 
                      'Transacción - NFC' : {}
                  };
                  var conceptList = {};
                  var logoHeader = 'LogoEdenred.png'
                  var leyendaHeader = '<strong style="color: red">!Por definir!</strong>'
                  var top = '2cm'
                  var subHeader = ''
                  var fieldsDocs = { FM3__c: true, ActaConstitutivaCliente__c: true, RegistroPatronal__c: true, CURP__c: true, PoderNotarial__c: true, AltaSHCP__c: true, ComprobanteDomicilioCliente__c: true, IdentificacionOficialCliente__c: true, RFCDoc__c: true }
                  var strAccountRecordType = '';
                  ctcLightning.remote("CON_ContractsContainer_CTRL.getContrato")("{!QuoteLineItem.Id}")
                      .then(function (res) {
                          contrato = res || {};
                          strAccountRecordType = res.Entidad_Cuenta__r.Cuenta__r.RecordType.DeveloperName;
                          console.log("\n\nContrato success: ", res, '\tAccountId: ', '{!AccountId}');
  
                          return ctcLightning.remote("CON_ContractsContainer_CTRL.executeQueryRA")(
                              "SELECT Id, AccountId, Contact.Name, Contact.Email,Contact.FirstName,Contact.LastName, Contact.MailingCity "+
                              "FROM AccountContactRelation "+
                              "WHERE AccountId ='{!AccountId}' "+
                              "AND Contact.Funcion__c IN('Quien administra Plataforma') "+
                              "ORDER BY CreatedDate ASC"
                          );
                      })
                      .then(function (res) {
                          console.log("contacts: ", res)
                          for (var acc of res) {
                              var cnt = acc.Contact || {}
                              contactos.push(cnt)
                          }
  
                          var idsreps = '';
                          if (contrato.Legal_representatives__c != null){
                              var arrayreps = contrato.Legal_representatives__c.split(',')
                              for(var i= 0; i < arrayreps.length; i++){
                                  idsreps = idsreps + "\'" + arrayreps[i] + "\',";
                              }
                              idsreps = idsreps.substring(0,idsreps.length - 1)
                          }
                          else{
                              idsreps = "\'\'";
                          }
  
                          return ctcLightning.remote("CON_ContractsContainer_CTRL.executeQueryRA")(
                              "SELECT Id, Name, LastName, FirstName, BirthdateText__c, BirthState__c, BirthCountry__c, MailingCity, " +
                                  "RFC__c, ConditionOfStaying__c, ProfessionName__c, Nationality__c, Curp__c, Phone, Email, Street__c, Colonia__c, "+
                                  "MailingState, NumberingOuterInner__c, MailingPostalCode, MailingCountry, typeIdentification__c, IDNumber__c, IDName__c, ElectorID__c "+
                              "FROM Contact "+
                              "WHERE Id IN (" + idsreps + ")"
                          );
                      }).then(function (res) {
                          for (var rep of res) {
                              representantes.push(rep)
                          }
  
                          console.log('Representantes ', representantes);
  
                          if (contrato.Entidad_Legal__c) {
                              return ctcLightning.remote("CON_ContractsContainer_CTRL.executeQueryRA")(
                                  "SELECT Id, Calle__c, Ciudad__c, CodigoPostal__c, Colonia__c, DelegacionMunicipioFiscal__c, Direccion__c"+
                                      ", Estado__c, NumeroExterior__c, NumeroInterior__c, Name, RazonSocial__c,TipoSociedad_PL__c,FM3__c"+
                                      ", ActaConstitutivaCliente__c, RegistroPatronal__c, CURP__c, PoderNotarial__c,AltaSHCP__c"+
                                      ", ComprobanteDomicilioCliente__c, IdentificacionOficialCliente__c, RFCDoc__c, RecordType.Name"+
                                      ",DeedDate__c,DeedDateText__c,CountryOrigin__c, Cuenta__r.RecordType.DeveloperName,NumberingOuterInner__c"+
                                      ",EconomicActivity__r.Name "+
                                  "FROM EntidadLegal__c "+
                                  "WHERE Id='" + contrato.Entidad_Legal__c + "'");
                          }
                      }).then(function (res) {
                          
                          entidadLegal = res && res.length > 0 ? res[0] : [];
                          entidadLegal.TipoPersona__c = entidadLegal.RecordType && entidadLegal.RecordType.Name ? entidadLegal.RecordType.Name : '';
  
                          var tipo = entidadLegal.TipoPersona__c == 'Persona Moral' ? 'PM' : 'PF';
                          Object.keys(fieldsDocs).forEach((field, index) => {
                              var aux = field.split('__');
                              fieldsDocs[field] = aux[0] + '_' + tipo + '__c';
                              if (entidadLegal.hasOwnProperty(field)) {
                                  entidadLegal[fieldsDocs[field]] = entidadLegal[field];
                              }
                          })
                          if(entidadLegal.Cuenta__r && isMerchand(contrato.Producto__c, strAccountRecordType)) {
                              return ctcLightning.remote("CON_ContractsContainer_CTRL.executeQueryRA")(
                                  "SELECT Id, Contract_2__c, AccountEntity__r.Name" +
                                      ", AccountEntity__r.EntidadLegal__r.RazonSocial__c" +
                                      ", AccountEntity__r.EntidadLegal__r.Direccion__c" +
                                      ", AccountEntity__r.EntidadLegal__r.Name" +
                                      ", AccountEntity__r.EntidadLegal__r.RecordType.Name " +
                                  "FROM Affiliate__c WHERE Contract_2__c='" + contrato.Id + "'"
                              );
                          } else {
                              return ctcLightning.remote("CON_ContractsContainer_CTRL.executeQueryRA")(
                                  "SELECT Id, Contrato_2__c" +
                                      ", Entidad_Cuenta__r.EntidadLegal__r.RazonSocial__c" +
                                      ", Entidad_Cuenta__r.EntidadLegal__r.Direccion__c" +
                                      ", Entidad_Cuenta__r.EntidadLegal__r.Name" +
                                      ", Entidad_Cuenta__r.EntidadLegal__r.RecordType.Name " +
                                  "FROM ContratoFilial__c WHERE Contrato_2__c='" + contrato.Id + "'"
                              );
                          }
                              
                      }).then(function (res) {
  
                          filiales = [];
                          var mapFiliales = {};
  
                          if(entidadLegal.Cuenta__r && isMerchand(contrato.Producto__c, strAccountRecordType)) {
  
                              for (let item of res) {
                                  if (mapFiliales[item.AccountEntity__r.Name]) {
                                      mapFiliales[item.AccountEntity__r.Name].push(item);
                                  } else {
                                      mapFiliales[item.AccountEntity__r.Name] = [item];
                                  }
                              }
                              
                              for (let keyMap in mapFiliales) {
                                  filiales.push(mapFiliales[keyMap][0]);
                              }
                                  
                          } else {
                              filiales = res || [];
                          }
                              
                          var idsEntidadCuenta = ''
                          for (var filial of filiales) {
                              if (idsEntidadCuenta.length > 0) {
                                  idsEntidadCuenta += ', '
                              }
                              if(entidadLegal.Cuenta__r && isMerchand(contrato.Producto__c, strAccountRecordType)) {
                                  idsEntidadCuenta += "\'" + filial.AccountEntity__c + "\'"
                              } else {
                                  idsEntidadCuenta += "\'" + filial.Entidad_Cuenta__c + "\'"
                              }	
                          }
  
                          if (idsEntidadCuenta && idsEntidadCuenta.length > 0) {
                              return ctcLightning.remote("CON_ContractsContainer_CTRL.executeQueryRA")(
                                  "SELECT Id, (SELECT Id, Contacto__r.Name FROM Contactos_Entidad1__r ORDER BY CreatedDate ASC LIMIT 1) "+
                                  "FROM EntidadCuenta__c "+
                                  "WHERE Id IN(" + idsEntidadCuenta + ")"
                              );
                          }
                      }).then(function (res) {
                          var contactoEntidadCuenta = {};
                          var contactos = res || [];
                          for (var contacto of contactos) {
                              contactoEntidadCuenta[contacto.Id] = contacto.Contactos_Entidad1__r && contacto.Contactos_Entidad1__r[0] && contacto.Contactos_Entidad1__r[0].Contacto__r ? contacto.Contactos_Entidad1__r[0].Contacto__r : {}
                          }
  
                          for (var filial of filiales) {
                              if (entidadLegal.Cuenta__r && isMerchand(contrato.Producto__c, strAccountRecordType)){
                                  filial.EntidadLegal__c = filial.AccountEntity__r && filial.AccountEntity__r.EntidadLegal__r ? filial.AccountEntity__r.EntidadLegal__r : {};
                                  filial.AccountEntityName = filial.AccountEntity__r.Name;
                              } else {
                                  filial.EntidadLegal__c = filial.Entidad_Cuenta__r && filial.Entidad_Cuenta__r.EntidadLegal__r ? filial.Entidad_Cuenta__r.EntidadLegal__r : {};
                              }
                                  
                              filial.EntidadLegal__c.TipoPersona__c = filial.EntidadLegal__c.RecordType ? filial.EntidadLegal__c.RecordType.Name : ''
                              
                              if (entidadLegal.Cuenta__r && isMerchand(contrato.Producto__c, strAccountRecordType)) {
                                  delete filial.AccountEntity__r;
                              } else {
                                  delete filial.Entidad_Cuenta__r;
                              }
                                  
                              delete filial.EntidadLegal__c.RecordType;
                              if(entidadLegal.Cuenta__r && isMerchand(contrato.Producto__c, strAccountRecordType)) {
                                  filial.Contacto__c = contactoEntidadCuenta[filial.AccountEntity__c];
                              } else {
                                  filial.Contacto__c = contactoEntidadCuenta[filial.Entidad_Cuenta__c];
                              }
                          }
  
                          console.log("filiales: ", filiales);
                          console.log("NVH- QLI: ", "{!QuoteLineItem.Id}");
  
                          //return ctcLightning.remote("CON_ContractsContainer_CTRL.executeQueryRA")("SELECT Id, Product2.ProductCode,Quote.Opportunity.Name,Quote.Opportunity.RecordType.DeveloperName,Quote.Opportunity.StageName,Quote.Opportunity.Owner.Name,Quote.Opportunity.Owner.Phone,Quote.Opportunity.Owner.Email,Quote.Opportunity.Contacto__r.Name,Quote.Opportunity.Contacto__r.Email,Quote.OpportunityId,Quote.Opportunity.ActaConstitutivaCliente__c, Quote.Opportunity.CURP__c,Quote.Opportunity.CedulaRFC__c,Quote.Opportunity.ComprobanteDomicilioCliente__c,Quote.Opportunity.ComprobanteDomicilioFiscal__c, Quote.Opportunity.ConstanciaRFC__c, Quote.Opportunity.ConstanciaRFCCliente__c,Quote.Opportunity.IdentificacionOficialCliente__c,Quote.Opportunity.IdentificacionOficialVigente__c, Quote.Opportunity.PoderNotarial__c,Quote.Opportunity.RegistroPatronal__c, Quote.Opportunity.RegistroPatronalOPAM__c,Quote.Opportunity.Familia__c, Quote.Opportunity.Owner.Manager.Name,Quote.Opportunity.Pilot__c,Quote.Owner.Name,Quote.AccountId,Quote.Account.RazonSocial__c,Quote.Account.Direccion__c,Quote.Account.BillingState,Quote.Account.RFC__c,Quote.Account.Owner.Name,Quote.Account.BillingAddress, Quote.Account.Sector__c,Quote.Account.TipoPersona__c,Quote.Contact.Email,Quote.Contact.CorreoAP__c,Quote.Contact.Name,Quote.Contact.FirstName,Quote.Contact.LastName,Quote.Contact.Puesto__c,Quote.Contact.MobilePhone,Quote.Contact.Phone,Quote.Contact.AreaTrabajo__c,Quote.Account.BillingStreet,Quote.Account.NumeroExterior__c,Quote.Account.Colonia__c,Quote.Account.ColMpoCpEdo__c,Quote.Account.BillingPostalCode,Quote.Account.Name,Quote.Account.CodigoClienteAS400__c, Quote.Account.Giro__c, Quote.Account.Subgiro__c, Quote.Account.Phone, Quote.Account.Telefono2__c FROM QuoteLineItem WHERE Id ='{!QuoteLineItem.Id}'")
                          return ctcLightning.remote("CON_ContractsContainer_CTRL.executeQueryRA")(
                              "SELECT Id, Product2.ProductCode,Quote.Opportunity.Name,Quote.Opportunity.RecordType.DeveloperName"+
                              ",Quote.Opportunity.StageName,Quote.Opportunity.Owner.Name,Quote.Opportunity.Owner.Phone"+
                              ",Quote.Opportunity.Owner.Email,Quote.Opportunity.Contacto__r.Name,Quote.Opportunity.Contacto__r.Email"+
                              ",Quote.Opportunity.Contacto__r.RFC__c,Quote.Opportunity.Contacto__r.BirthCountry__c"+
                              
                              ",Quote.OpportunityId,Quote.Opportunity.ActaConstitutivaCliente__c, Quote.Opportunity.CURP__c"+
                              ",Quote.Opportunity.CedulaRFC__c,Quote.Opportunity.ComprobanteDomicilioCliente__c"+
                              ",Quote.Opportunity.ComprobanteDomicilioFiscal__c, Quote.Opportunity.ConstanciaRFC__c"+
                              ",Quote.Opportunity.ConstanciaRFCCliente__c,Quote.Opportunity.IdentificacionOficialCliente__c"+
                              ",Quote.Opportunity.IdentificacionOficialVigente__c, Quote.Opportunity.PoderNotarial__c"+
                              ",Quote.Opportunity.RegistroPatronal__c, Quote.Opportunity.RegistroPatronalOPAM__c"+
                              ",Quote.Opportunity.Familia__c, Quote.Opportunity.Owner.Manager.Name,Quote.Opportunity.Pilot__c"+
                              ",Quote.Opportunity.Maquilas__c,Quote.Opportunity.Codigo_Producto_cotizacion__c,Quote.Owner.Name"+
                              ",Quote.AccountId,Quote.Account.RazonSocial__c,Quote.Account.Direccion__c,Quote.Account.BillingState"+
                              ",Quote.Account.RFC__c,Quote.Account.Owner.Name,Quote.Account.BillingAddress, Quote.Account.Sector__c"+
                              ",Quote.Account.TipoPersona__c,Quote.Contact.Email,Quote.Contact.CorreoAP__c,Quote.Contact.Name"+
                              ",Quote.Contact.FirstName,Quote.Contact.LastName,Quote.Contact.Puesto__c,Quote.Contact.MobilePhone"+
                              ",Quote.Contact.Phone,Quote.Contact.AreaTrabajo__c,Quote.Account.BillingStreet"+
                              ",Quote.Account.NumeroExterior__c,Quote.Account.Colonia__c,Quote.Account.ColMpoCpEdo__c"+
                              ",Quote.Account.BillingPostalCode,Quote.Account.Name,Quote.Account.CodigoClienteAS400__c"+
                              ",Quote.Account.Giro__c, Quote.Account.Subgiro__c, Quote.Account.Phone, Quote.Account.Telefono2__c"+
                              ",CreditDays__c, Quote.Opportunity.Contrato_Filial__r.Producto__r.ProductCode, CantidadTarjetas__c, TotalPrice "+
                              "FROM QuoteLineItem "+
                              "WHERE Id ='{!QuoteLineItem.Id}'"
                          );
                      }).then(function (res) {
                          console.log("res qli: ", res)
                          creditDays = res[0].CreditDays__c;
                          dataSource = res[0].Quote;
                          var productoQLI = res[0].Id;
  
                          dataSource.Product2 = res[0].Product2;
                          dataSource.QuoteLineItem = res[0];
                          dataSource.FormaPago__c = '{!FormaPago}';

                          //* NVH -- Edenred Arg */
                            let numberLetra = '';
                            if(dataSource.QuoteLineItem && productsArgCodes.includes(dataSource.QuoteLineItem.Product2.ProductCode)) {
                                numberLetra = numeroALetras(dataSource.QuoteLineItem.TotalPrice, {plural: 'PESOS', singular: 'PESO', centPlural: 'CENTAVOS', centSingular: 'CENTAVO'});
                                dataSource.QuoteLineItem.TotalPriceLetra = numberLetra;
                            }
                        


                          //Datos del ejecutivo(propietario de la oportunidad)
                          let executive = {};
                          executive.Name = res[0].Quote.Opportunity.Owner.Name ? res[0].Quote.Opportunity.Owner.Name : '';
                          executive.Phone = res[0].Quote.Opportunity.Owner.Phone ? res[0].Quote.Opportunity.Owner.Phone : '';
                          executive.Email = res[0].Quote.Opportunity.Owner.Email ? res[0].Quote.Opportunity.Owner.Email : '';
                          dataSource.executive = executive;
  
                          //REQ: 6452
                          if(prodCode != undefined && prodCode != null && prodCode != '') {
                              dataSource.Product2.ProductCode = prodCode;
                          }
  
                          /***DYAMPI***/
                          if (dataSource.Product2 != null && dataSource.Product2.Id != null) {
                              ctcLightning.remote("CON_ContractsContainer_CTRL.executeQueryRA")("SELECT Id, Concepto_Tipo_Cargo__c,PrecioLista__c,Bonificacion__c,VigenciaDescuento__c,PrecioFinal__c,CantidadTarjetas__c, Concepto__r.EtiquetaTipoDeCargo__c, GLBAr_Currency__c FROM ProductoConcepto__c where  PartidaPresupuesto__c=\'" + productoQLI + "\'")
                                  .then(function (result) {
                                      var conceptos = result;
                                      conceptList = result;
                                      dataConcept = result;
                                      dataSource.conceptos = dataConcept;
                                      console.log('Conceptos ', conceptos);
                                      templateConceptos = '<table class="tableFilial">';
                                      templateConceptos = templateConceptos + '<thead>';
  
                                      //REQ: 6452
                                      if(prodCode != undefined && prodCode != null && prodCode != '') {
                                          dataSource.Product2.ProductCode = prodCode;
                                      }
  
                                      if ((dataSource.Product2.ProductCode == '29' || dataSource.Product2.ProductCode == '29-TER' 
                                              || dataSource.Product2.ProductCode == '29-P' 
                                              || dataSource.Product2.ProductCode == '29-D') 
                                          && dataSource.Opportunity.Pilot__c == true
                                      ) {
                                          templateConceptos = templateConceptos + '<th style="width:35%; text-align: center;">' + 'Concepto' + '</th>';
                                      } else if (dataSource.Product2.ProductCode == '52-C'|| dataSource.Product2.ProductCode == '62-C'
                                          || dataSource.Product2.ProductCode == '69-C' 
                                          || dataSource.Product2.ProductCode == '44'
                                      ) {
                                          templateConceptos = templateConceptos + '<th style="width:35%; text-align: center;">' + 'Tipo de monedero' + '</th>';
                                      } else {
                                          templateConceptos = templateConceptos + '<th style="width:35%; text-align: center;">' + (dataSource.Product2.ProductCode != '33' ? 'Tipo de Monedero' : '') + '</th>';
                                      }
  
                                      templateConceptos = templateConceptos + '<th style="width:10%; text-align: center;">Precio Lista</th><th style="width:15%; text-align: center;">Comentarios</th>';
                                      
                                      if (dataSource.Product2.ProductCode != '33') {
                                          templateConceptos = templateConceptos + '<th style="width:20%; text-align: center;">Vigencia (DD-MM-AAAA)</th><th style="width:10%;text-align: center;">Precio Final</th>';
                                      }
                                      
                                      templateConceptos = templateConceptos + '</thead>';
                                      templateConceptos = templateConceptos + '</tbody>';
                                      dataSource['Forma_pago'] = (dataSource.Contrato2__c.PartidaPresupuesto__r.FormaPago__c != 'Cheque')? dataSource.Contrato2__c.PartidaPresupuesto__r.FormaPago__c:'Depósito referenciado';
                                      
                                      for (var i = 0; i < conceptos.length; i++) {
                                        let tipoConcepto = conceptos[i].Concepto_Tipo_Cargo__c.trim().replaceAll(' ','_');
                                        
                                        //NVH --Arg
                                        if(productsArgCodes.includes(dataSource.Product2.ProductCode)) {
                                            if(tipoConcepto === 'Retribución_por_nuestra_gestión_(FEE)') {
                                                tipoConcepto = 'Retribución_por_nuestra_gestión_FEE'; 
                                            }
                                            //datasource -- 
                                            buildConceptArg(dataSource, conceptos[i], tipoConcepto);
                                        }
                                          dataSource[tipoConcepto] = conceptos[i].PrecioFinal__c;
                                          console.log('###################'+conceptos[i].Concepto_Tipo_Cargo__c);
                                          console.log('###################'+conceptos[i].PrecioFinal__c);
                                          if (conceptos[i].Concepto_Tipo_Cargo__c == 'Comisión por el servicio' && dataSource.Product2.ProductCode != '33')
                                              continue;
                                          var dateV;
                                          var vig = '';
                                          if (conceptos[i].VigenciaDescuento__c != undefined) {
                                              dateV = new Date(conceptos[i].VigenciaDescuento__c);
                                              var dia = dateV.getUTCDate().toString().length > 1 ? dateV.getUTCDate() + '' : '0' + dateV.getUTCDate();
                                              var mes = (dateV.getUTCMonth() + 1).toString().length > 1 ? (dateV.getUTCMonth() + 1) + '' : '0' + (dateV.getUTCMonth() + 1);
                                              vig = dia + '-' + mes + '-' + dateV.getUTCFullYear();
                                          } else {
                                              vig = '';
                                          }
  
                                          var bon = '';
                                          if (conceptos[i].Bonificacion__c == 0 || conceptos[i].Bonificacion__c == '0' || conceptos[i].Bonificacion__c == null) {
                                              //VALOR ANTERIOR
                                              bon = 'N/A';
  
                                              /*FORMATO SOLO PARA TICKET CAR O BENEFITS (MERCHATS 2)
                                              if((dataSource.Opportunity.Familia__c == 'Benefits' || dataSource.Opportunity.Familia__c == 'Ticket Car') && dataSource.Opportunity.RecordType.DeveloperName.includes('RT_NuevaAfiliacion')){
                                              bon = '0.0 %';
                                              }else{
                                                  bon = 'N/A';
                                              }
                                              //====================================================*/
                                          } else {
                                              //VALOR ANTERIOR
                                              bon = conceptos[i].Bonificacion__c + '%';
  
                                              /*FORMATO SOLO PARA TICKET CAR O BENEFITS (MERCHATS 2)
                                              if((dataSource.Opportunity.Familia__c == 'Benefits' || dataSource.Opportunity.Familia__c == 'Ticket Car' ) && dataSource.Opportunity.RecordType.DeveloperName.includes('RT_NuevaAfiliacion')){
                                                  var bonDecimal = conceptos[i].Bonificacion__c.toFixed(1);
                                                  bon = bonDecimal + '%';
                                              }else{
                                                  bon = conceptos[i].Bonificacion__c + '%';
                                              }
                                              //==================================================== */
                                          }
                                          var ct = '';
                                          if (conceptos[i].CantidadTarjetas__c != 0 && conceptos[i].CantidadTarjetas__c != '0' && conceptos[i].CantidadTarjetas__c != null) {
                                              ct = conceptos[i].CantidadTarjetas__c;
                                          }
                                          // ==== VALOR ANTERIOR ====
                                          templateConceptos = templateConceptos + '<tr>';
                                          if(conceptos[i].Concepto__c != undefined){
                                              if(conceptos[i].Concepto__r.EtiquetaTipoDeCargo__c != undefined)
                                                  templateConceptos = templateConceptos + '<td style="width:35%;text-align: justify;">' + conceptos[i].Concepto__r.EtiquetaTipoDeCargo__c + '</td>';
                                              else
                                                  templateConceptos = templateConceptos + '<td style="width:35%;text-align: justify;">' + conceptos[i].Concepto_Tipo_Cargo__c + '</td>';
                                          }else
                                              templateConceptos = templateConceptos + '<td style="width:35%;text-align: justify;">' + conceptos[i].Concepto_Tipo_Cargo__c + '</td>';
                                          templateConceptos = templateConceptos + '<td style="width:10%; text-align: center;">' + (conceptos[i].Concepto_Tipo_Cargo__c != 'Comisión por el servicio' ? '$' : '') + conceptos[i].PrecioLista__c + (conceptos[i].Concepto_Tipo_Cargo__c == 'Comisión por el servicio' ? '%' : '') + '</td>';
                                          templateConceptos = templateConceptos + '<td style="widhth:10%; text-align: center;">' + bon + '</td>';
                                          if (dataSource.Product2.ProductCode != '33'){
                                              //templateConceptos = templateConceptos + '<td style="width:15%; text-align: center;">' + ct + '</td>';
                                              templateConceptos = templateConceptos + '<td style="width:20%;text-align: center;">' + vig + '</td>';
                                              templateConceptos = templateConceptos + '<td style="width:10%;text-align: center;">' + (conceptos[i].Concepto_Tipo_Cargo__c != 'Comisión por el servicio' ? '$' : '') + conceptos[i].PrecioFinal__c + (conceptos[i].Concepto_Tipo_Cargo__c == 'Comisión por el servicio' ? '%' : '') + '</td>';
                                          }
                                          templateConceptos = templateConceptos + '</tr>';
  
                                          //FORMATO SOLO PARA TICKET CAR O BENEFITS (MERCHATS 2)
                                          /*if((dataSource.Opportunity.Familia__c == 'Benefits' || dataSource.Opportunity.Familia__c == 'Ticket Car') && dataSource.Opportunity.RecordType.DeveloperName.includes('RT_NuevaAfiliacion')){
  
                                              var valorPrecioLista = '';
                                              var valorPrecioFinal = '';
  
                                              if(conceptos[i].Concepto_Tipo_Cargo__c != 'Comisión por el servicio'){
                                                  valorPrecioLista = '$'+ conceptos[i].PrecioLista__c;
                                                  valorPrecioFinal = '$'+ conceptos[i].PrecioFinal__c;
                                              }else{
                                                  var pListaDecimal = conceptos[i].PrecioLista__c.toFixed(1);
                                                  valorPrecioLista = ''+pListaDecimal+'%';
  
                                                  var pFinalDecimal = conceptos[i].PrecioFinal__c.toFixed(1);
                                                  valorPrecioFinal = ''+pFinalDecimal+'%';
                                              }
  
                                              templateConceptos = templateConceptos + '<tr>';
                                                  templateConceptos = templateConceptos + '<td style="width:35%;text-align: justify;">' + conceptos[i].Concepto_Tipo_Cargo__c + '</td>';
                                                  templateConceptos = templateConceptos + '<td style="width:10%; text-align: center;">' + valorPrecioLista + '</td>';
                                                  templateConceptos = templateConceptos + '<td style="widhth:10%; text-align: center;">' + bon + '</td>';
                                                  if (dataSource.Product2.ProductCode != '33'){
                                                      templateConceptos = templateConceptos + '<td style="width:15%; text-align: center;">' + ct + '</td>';
                                                      templateConceptos = templateConceptos + '<td style="width:20%;text-align: center;">' + vig + '</td>';
                                                      templateConceptos = templateConceptos + '<td style="width:10%;text-align: center;">' + valorPrecioFinal + '</td>';
                                                  }
                                              templateConceptos = templateConceptos + '</tr>';
  
                                          }else{
  
                                              // ==== VALOR ANTERIOR ====
                                              templateConceptos = templateConceptos + '<tr>';
                                                  templateConceptos = templateConceptos + '<td style="width:35%;text-align: justify;">' + conceptos[i].Concepto_Tipo_Cargo__c + '</td>';
                                                  templateConceptos = templateConceptos + '<td style="width:10%; text-align: center;">' + (conceptos[i].Concepto_Tipo_Cargo__c != 'Comisión por el servicio' ? '$' : '') + conceptos[i].PrecioLista__c + (conceptos[i].Concepto_Tipo_Cargo__c == 'Comisión por el servicio' ? '%' : '') + '</td>';
                                                  templateConceptos = templateConceptos + '<td style="widhth:10%; text-align: center;">' + bon + '</td>';
                                                  if (dataSource.Product2.ProductCode != '33'){
                                                      templateConceptos = templateConceptos + '<td style="width:15%; text-align: center;">' + ct + '</td>';
                                                      templateConceptos = templateConceptos + '<td style="width:20%;text-align: center;">' + vig + '</td>';
                                                      templateConceptos = templateConceptos + '<td style="width:10%;text-align: center;">' + (conceptos[i].Concepto_Tipo_Cargo__c != 'Comisión por el servicio' ? '$' : '') + conceptos[i].PrecioFinal__c + (conceptos[i].Concepto_Tipo_Cargo__c == 'Comisión por el servicio' ? '%' : '') + '</td>';
                                                  }
                                              templateConceptos = templateConceptos + '</tr>';
                                          }*/
                                      }
                                      templateConceptos = templateConceptos + '</tbody></table>';
                                  });
                              }
  
                          /***********/
                          console.log('templateConceptos: ' , templateConceptos);
                          if (contrato != null) {
                              if (contrato.Entidad_Legal__r && contrato.Entidad_Legal__r.RecordType) {
                                  contrato.Entidad_Legal__r.TipoPersona__c = contrato.Entidad_Legal__r.RecordType.Name
                              }
                              dataSource.Contrato2__c = contrato;
                              var today = new Date();
                              dataSource.fechaHoy = today.getDate() + '-' + (today.getMonth() + 1) + '-' + today.getFullYear();
                              var meses = { '1': 'Enero', '2': 'Febrero', '3': 'Marzo', '4': 'Abril', '5': 'Mayo', '6': 'Junio', '7': 'Julio', '8': 'Agosto', '9': 'Septiembre', '10': 'Octubre', '11': 'Noviembre', '12': 'Diciembre' };
                              let fecha = new Date();
                              dataSource.dia = fecha.getDate();
                              dataSource.mes = meses[fecha.getMonth() + 1];
                              dataSource.anio = fecha.getFullYear();
                          }
  
                          dataSource.User = {};
                          dataSource.SaltoPagina = {};
                          dataSource.SaltoPagina.sPagina = '<div class="page-break"></div>';
                          dataSource.User.ManagerId = '{!managerName}';
                          dataSource.EntidadLegal__c = entidadLegal;
                          dataSource.Account.AdministradorPlataforma__c = contactos && contactos.length > 0 && contactos[0].Id ? contactos[0] : {}
                          if (!dataSource.Account.AdministradorPlataforma__c.Id) {
                              dataSource.Account.AdministradorPlataforma__c = contrato.Contacto__r || {}
                          }
  
                          /////Condición para el check de los anexos y documentación para contratos//////
                          //(dataSource.Opportunity.Pilot__c);
                          dataSource.myname = dataSource.Contrato2__c['AmountContingency__c'];
                          console.log("dataSource 1: ", dataSource);
  
                            //NVH -- EdenredArg
                            //Para productos de argentina, no muestra logo
                            leyendaHeader = !productsArgCodes.includes(dataSource.Product2.ProductCode)?leyendaHeader:'';

                          if (dataSource.Product2.ProductCode == "G500-AF") {
                              dataSource.Contrato2__c.urlImg = '<p style="text-align: center;"> <img class="imgG5" src="{!URLFOR($Resource.imagesAfiliados , "/images/TarjetaG500.png")}"/> </p>';
                          } else if (dataSource.Product2.ProductCode == "BP-AF") {
                              dataSource.Contrato2__c.urlImg = '<img style="width: 30%; height: auto; text-align: center;" class="imgBP" src="{!URLFOR($Resource.imagesAfiliados , "/images/TarjetaBP.png")}"/>';
                          }
                          if (dataSource.Product2.ProductCode == "BP-AF" || dataSource.Product2.ProductCode == "G500-AF" || dataSource.Product2.ProductCode == "TC-AF") {
                              dataSource.Contrato2__c.urlImgPapel = '<p style="text-align: center;"> <img style="width: 90%; height: auto;" class="imgG5" src="{!URLFOR($Resource.imagesAfiliados , "/images/OperacionValePapel.png")}"/> </p>';
                          }
                          if (dataSource.Product2.ProductCode == "G500-AF" || (dataSource.Opportunity.Maquilas__c && dataSource.Opportunity.Maquilas__c.includes('G500 FLEET'))) {
                              dataSource.Contrato2__c.urlImglogoG500 = '<img style="width: 20%; height: auto;" class="imgG5" src="{!URLFOR($Resource.imagesAfiliados , "/images/LogoG500.png")}"/>';
                          }
                          if (dataSource.Product2.ProductCode == "BP-AF" || (dataSource.Opportunity.Maquilas__c && dataSource.Opportunity.Maquilas__c.includes('BPfleet'))) {
                              dataSource.Contrato2__c.urlImglogoBP = '<img style="width: 20%; height: auto;" class="imgBP" src="{!URLFOR($Resource.imagesAfiliados , "/images/LogoBP.png")}"/>';
                          }
                          if (dataSource.Product2.ProductCode == "BP-AF" || dataSource.Product2.ProductCode == "G500-AF") {
                              dataSource.Contrato2__c.urlImglogoEdenred = '<img style="width: 20%;" class="imgEDE" src="{!URLFOR($Resource.imagesAfiliados , "/images/LogoEdenred.png")}"/>';
                          }
                          if (dataSource.Product2.ProductCode == "BP-AF" || dataSource.Product2.ProductCode == "G500-AF") {
                              dataSource.Contrato2__c.urlImglogoWhi = '<img style="width: 20%;" class="imgEDE" src="{!URLFOR($Resource.imagesAfiliados , "/images/LogoWhite.png")}"/>';
                          }
                          console.log("URLIMG::" + dataSource.Contrato2__c.urlImg);
                          if (contrato.Entidad_Legal__r.RecordType.Name == 'Persona Moral') {
                              dataSource.Contrato2__c.isPersonMoral = true;
                              dataSource.Contrato2__c.containAnexoM = true;
                          } else {
                              dataSource.Contrato2__c.isPersonMoral = false;
                              dataSource.Contrato2__c.containAnexoM = false;
                          }
                          if (contrato.Entidad_Legal__r.RecordType.Name == 'Persona Física') {
                              dataSource.Contrato2__c.isPersonFisica = true;
                              dataSource.Contrato2__c.containAnexoF = true;
                          } else {
                              dataSource.Contrato2__c.isPersonFisica = false;
                              dataSource.Contrato2__c.containAnexoF = false;
                          }
                          if (dataSource.Product2.ProductCode == "TC-AF" || dataSource.Product2.ProductCode == "BP-AF" || dataSource.Product2.ProductCode == "G500-AF") {
                              dataSource.Contrato2__c.containDocsTC = true;
                          }
                          if (["multip-AF", "viat-AF", "ince-AF", "ayudaS-AF", "vest-AF", "com-AF", "des-AF", "des-AF-OPAM"].includes(dataSource.Product2.ProductCode)) {
                              dataSource.Contrato2__c.clabe = true;
                          }
                          ////Checks para Productos///////
                          if (dataSource.Contrato2__c.IsPaper__c && ["multip-AF", "viat-AF", "ayudaS-AF", "com-AF", "des-AF", "des-AF-OPAM"].includes(dataSource.Product2.ProductCode)) {
                              dataSource.Contrato2__c.IsPaper = true;
                          } else {
                              dataSource.Contrato2__c.IsPaper = false;
                          }
                          if (contrato.Producto__c == 'Multiproducto') {
                              dataSource.Contrato2__c.systemFood = true;
                              dataSource.Contrato2__c.systemGift = true;
                              dataSource.Contrato2__c.publicSectorSystem = true;
                              dataSource.Contrato2__c.dressSystem = true;
                          } else if (contrato.Producto__c == 'Regalo - Afiliación') {
                              dataSource.Contrato2__c.systemGift = true;
                          } else if (contrato.Producto__c == 'Despensa Sector Público - Afiliación') {
                              dataSource.Contrato2__c.publicSectorSystem = true;
                          } else if (contrato.Producto__c == 'Vestimenta - Afiliación') {
                              dataSource.Contrato2__c.dressSystem = true;
                          } else if (contrato.Producto__c == 'Restaurante - Afiliación') {
                              dataSource.Contrato2__c.systemFood = true;
                          }
                          ////////////////////////////////////
                          // alert(dataSource.Opportunity.Pilot__c);
                          console.debug('✨', prodCode);
                          console.debug('🎈', dataSource.Product2.ProductCode);
                          //NVH -- 
                          let recordTypeOpp = dataSource.Opportunity.RecordType.DeveloperName || '';
                            if(productsArgCodes.includes(dataSource.Product2.ProductCode)) {
                                conceptsListTC4 = {
                                    'Servicio de personalización RFID': {},
                                    'Costo de implementación': {},
                                    'Reposición Tarjeta Virtual': {},
                                    'Costo de entrega': {},
                                    'Servicio de personalización Tarjeta Virtual': {},
                                    'Mantenimiento de tarjetas': {},
                                    'Reposición RFID': {},
                                    'Mantenimiento de RFID': {},
                                    'Move for good 100%': {},
                                    'Move for good 50%': {}
                                }
                                
                            }
                          if (dataSource.Product2.ProductCode == "33") {
                              conceptsListTC4 = {
                                  'Mensualidad Premium': {},
                                  'Mensualidad Premium Plus': {},
                                  'Comisión portal por pago': {},
                                  'Cargo por envío - Recurrente': {},
                                  'Cargo por envío estándar': {},	
                                  'Cargo por refacturacion': {},
                                  'Tarjetas Físicas': {},
                                  'Implementación': {},
                                  'Cuenta Activa': {},
                                  'Comisión por el servicio': {},
                                  'TAG Dual': {},
                                  'TAG Regular': {},
                                  'Tarjetas Virtuales': {},
                                  'Cuota por ordenamiento y/o entrega especial': {},
                                  'Forma de Pago': {},
                                  'Periodo de Facturación': {}
                              }
                              if (recordTypeOpp === 'Migracion') {
                                  nombreProducto = '33-Fleet Edenred-Addendum';
                                  leyendaHeader = `<div class="leyendaHeader">
                                      <img class="logoFleet" src="{!URLFOR($Resource.LogoTicketCar)}" />
                                  </div>`;
                              } else {
                                  if(contrato.TipoPago__c == 'Prepago') {
                                      nombreProducto = '33-Fleet Edenred'; 
                                      leyendaHeader = `<div class="leyendaHeader">
                                      <img class="logoFleet" src="{!URLFOR($Resource.LogoTicketCar)}" />
                                      <p>FECHA DE ACTUALIZACIÓN 14/06/2024 </p>
                                      <p>CONTRATO CLIENTES TC PAGO POR PEDIDO JUR</p>
                                      <p><strong>DTCOM-MOVE-001</strong></p>
                                      </div>`;
                                  } else if(contrato.TipoPago__c == 'Pospago') {
                                      nombreProducto = '33-Fleet Edenred Pospago'; 
                                      leyendaHeader = `<div class="leyendaHeader">
                                      <img class="logoFleet" src="{!URLFOR($Resource.LogoTicketCar)}" />
                                      <p>FECHA DE ACTUALIZACIÓN 14/06/2024</p>
                                      <p>CONTRATO CLIENTES TC PAGO POR CONSUMO JUR</p>
                                      <p><strong>DTCOM-MOVE-005</strong></p>
                                      </div>`;
                                  }                                
                              }
                                                          
                              top = '3cm'
                              dataSource.nectarPaloma = `<img  src="{!URLFOR($Resource.CotizacionesPDF, "/Encabezados/paloma.png")}" />`;
                              var today = new Date();
                              dataSource.fechaHoy = today.getDate() + '-' + (today.getMonth() + 1) + '-' + today.getFullYear();
  
                          } else if ((contrato.TipoPago__c == 'Prepago' || contrato.TipoPago__c == 'Pospago')
                              && (contrato.Item_Contratacion__c == 'TC Basico' || contrato.Item_Contratacion__c == 'TC Avanzado')
                              && dataSource.Opportunity.Pilot__c == false  
                              && dataSource.Product2.ProductCode == "30"
                          ) { // NUEVO CONTINGENCIA
  
                              if(contrato.TipoPago__c == 'Prepago' && contrato.Item_Contratacion__c == 'TC Avanzado'  && contrato.Tipo_Maquila__c !='SmartCard Business'){
                                  console.log('ENTRA IF 475 VIRTUAL');
                                  nombreProducto = 'Contrato Clientes Edenred TC3 Pago por pedido Editable';
                                  //6193 -->
                                  if(contrato.Telepeaje__c == true){
                                      nombreProducto = 'Contrato Clientes Edenred TC3 Pago por pedido Editable Telepeaje';
                                  }
                                  //<-- 6193
                                  leyendaHeader = `<div class="leyendaHeader">
                                  <img class="logoEdenred2" src="{!URLFOR($Resource.CotizacionesPDF, "/Encabezados/LogoTicketCar.png")}" />
                                  <p>TCBV030519</p>
                                  <p>FECHA DE ACTUALIZACIÓN  07/02/2023</p>
                                  <p>CONTRATO CLIENTES EDENRED TC PAGO POR PEDIDO JUR</p>
                                  <p><strong>DTCOMTC-001 - 2</strong></p>
                                  </div>`
                                  top = '3cm'
                              } else if (contrato.TipoPago__c == 'Prepago' && contrato.Item_Contratacion__c == 'TC Avanzado' 
                                  && contrato.Tipo_Maquila__c =='SmartCard Business'
                              ) {
                                  //Begin Added By Fran Rojas | HU SmartCard 14/06/2021 <frojas@freewayconsulting.com>
                                  console.log('ENTRA CLON IF 475 VIRTUAL PARA SmartCard Business TC3 Avanzado');
                                  logoHeader = 'LogoSmartCard.png';
                                  nombreProducto = 'Contrato Clientes Edenred TC3 SmartCard Pago por pedido Editable';
                                  leyendaHeader = `<div class="leyendaHeader">
                                  <img class="logoEdenred2" src="{!URLFOR($Resource.CotizacionesPDF, "/Encabezados/LogoTicketCar.png")}" />
                                  <p>TCBV030519</p>
                                  <p>FECHA DE ACTUALIZACIÓN  07/02/2023</p>
                                  <p>CONTRATO CLIENTES EDENRED TC PAGO POR PEDIDO JUR</p>
                                  <p><strong>DTCOMTC-001 - 2</strong></p>
                                  </div>`
                                  top = '3cm'
                              } else if (contrato.TipoPago__c == 'Prepago' && contrato.Item_Contratacion__c == 'TC Basico' 
                                  && contrato.Tipo_Maquila__c !='SmartCard Business'
                              ) {//End Added By Fran Rojas | HU SmartCard 14/06/2021 <frojas@freewayconsulting.com>
  
                                  console.log('ENTRA IF 485 VIRTUAL');
                                  nombreProducto = 'Contrato Clientes Edenred TC3 Basico Pago Por Pedido Editable';
                                  leyendaHeader = `<div class="leyendaHeader">
                                  <img class="logoEdenred2" src="{!URLFOR($Resource.CotizacionesPDF, "/Encabezados/LogoTicketCar.png")}" />
  
                                  <p>FECHA DE ACTUALIZACIÓN  07/02/2023</p>
                                  <p>CONTRATO CLIENTES EDENRED TC BASICO PAGO POR PEDIDO JUR</p>
                                  <p><strong>DTCOMTC-001-3</strong></p>
                                  </div>`
                                  top = '3cm'
  
                              } else if (contrato.TipoPago__c == 'Prepago' && contrato.Item_Contratacion__c == 'TC Basico' 
                                  && contrato.Tipo_Maquila__c =='SmartCard Business'
                              ) {//Begin Added By Fran Rojas | HU SmartCard 14/06/2021 <frojas@freewayconsulting.com>
                                  console.log('ENTRA IF 485 VIRTUAL CLON para SmartCard');
                                  nombreProducto = 'Contrato Clientes Edenred TC3 SmartCard Basico Pago Por Pedido Editable'; //BUSCAR
                                  leyendaHeader = `<div class="leyendaHeader">
                                  <img class="logoEdenred2" src="{!URLFOR($Resource.CotizacionesPDF, "/Encabezados/LogoTicketCar.png")}" />
  
                                  <p>FECHA DE ACTUALIZACIÓN  07/02/2023</p>
                                  <p>CONTRATO CLIENTES EDENRED TC BASICO PAGO POR PEDIDO JUR</p>
                                  <p><strong>DTFMTC-001-6</strong></p>
                                  </div>`
                                  top = '3cm'
                              } else if (contrato.TipoPago__c == 'Pospago' && contrato.Item_Contratacion__c == 'TC Avanzado' 
                                  && contrato.Tipo_Maquila__c !='SmartCard Business'
                              ) {//End Added By Fran Rojas | HU SmartCard 14/06/2021 <frojas@freewayconsulting.com>
                                  console.log('ENTRA IF 494 VIRTUAL');
                                  nombreProducto = 'Contrato Clientes Edenred TC3 pago por consumo Editable';
                                  //6193 -->
                                  if(contrato.Telepeaje__c == true){
                                      nombreProducto = 'Contrato Clientes Edenred TC3 Pago por consumo Editable Telepeaje';
                                  }
                                  //<-- 6193
                                  leyendaHeader = `<div class="leyendaHeader">
                                  <img class="logoEdenred2" src="{!URLFOR($Resource.CotizacionesPDF, "/Encabezados/LogoTicketCar.png")}" />
                                  <p>DTCOM-</p>
                                  <p>FECHA DE ACTUALIZACIÓN  07/02/2023<p/>
                                  <p>CONTRATO CLIENTES EDENRED TC PAGO POR CONSUMO JUR</p>
                                  <p><strong>DTCOMTC-001 - 1</strong></p>
                                  </div>`
                                  top = '3cm'
                              } else if (contrato.TipoPago__c == 'Pospago' && contrato.Item_Contratacion__c == 'TC Avanzado' 
                                  && contrato.Tipo_Maquila__c =='SmartCard Business'
                              ) { //Begin Added By Fran Rojas | HU SmartCard 14/06/2021 <frojas@freewayconsulting.com>
                                  console.log('ENTRA CLON IF 494 VIRTUAL PARA SmartCard Business TC3 Avanzado');
                                  logoHeader = 'LogoSmartCard.png';
                                  nombreProducto = 'Contrato Clientes Edenred TC3 SmartCard pago por consumo Editable';
                                  leyendaHeader = `<div class="leyendaHeader">
                                  <img class="logoEdenred2" src="{!URLFOR($Resource.CotizacionesPDF, "/Encabezados/LogoTicketCar.png")}" />
                                  <p>DTCOM-</p>
                                  <p>FECHA DE ACTUALIZACIÓN  07/02/2023<p/>
                                  <p>CONTRATO CLIENTES EDENRED TC PAGO POR CONSUMO JUR</p>
                                  <p><strong>DTCOMTC-001 - 1</strong></p>
                                  </div>`
                                  top = '3cm'
                              } else if (contrato.TipoPago__c == 'Pospago' && contrato.Item_Contratacion__c == 'TC Basico') {//End Added By Fran Rojas | HU SmartCard 14/06/2021 <frojas@freewayconsulting.com>
                                  console.log('ENTRA IF 503 VIRTUAL');
                                  nombreProducto = 'Contrato Clientes Edenred TC3 Basico Pago Por Consumo Editable';
                                  leyendaHeader = `<div class="leyendaHeader">
                                  <img class="logoEdenred2" src="{!URLFOR($Resource.CotizacionesPDF, "/Encabezados/LogoTicketCar.png")}" />
  
                                  <p>FECHA DE ACTUALIZACIÓN  07/02/2023<p/>
                                  <p>CONTRATO CLIENTES EDENRED TC BASICO PAGO POR CONSUMO JUR</p>
                                  <p><strong>DTCOMTC-001-6</strong></p>
                                  </div>`
                                  top = '3cm'
                              }
  
                          } else if (
                              (contrato.TipoPago__c == 'Prepago' || contrato.TipoPago__c == 'Pospago')
                              && (contrato.Item_Contratacion__c == 'TC Basico' || contrato.Item_Contratacion__c == 'TC Avanzado')
                              && dataSource.Product2.ProductCode == "30-TC4"
                          ) { // NUEVO CONTINGENCIA
  
                              if (contrato.TipoPago__c == 'Pospago' && contrato.Item_Contratacion__c == 'TC Avanzado' && contrato.Tipo_Maquila__c !='SmartCard Business'){
                                  console.log('ENTRA IF 524 VIRTUAL');
                                  nombreProducto = 'Contrato Clientes Edenred TC4 Pago por Consumo editable';
                                  //6193 -->
                                  if(contrato.Telepeaje__c == true){
                                      nombreProducto = 'Contrato Clientes Edenred TC4 Pago por Consumo Editable Telepeaje';
                                  }
                                  //<-- 6193
                                  leyendaHeader = `<div class="leyendaHeader">
                                  <p>DTCOM-</p>
                                  <p>FECHA DE ACTUALIZACIÓN  07/02/2023<p/>
                                  <p>CONTRATO CLIENTES EDENRED TC PAGO POR CONSUMO JUR</p>
                                  <p><strong>DTCOMTC-001-4</strong></p>
                                  </div>`
                                  top = '3cm'
                              } else if (contrato.TipoPago__c == 'Pospago' && contrato.Item_Contratacion__c == 'TC Avanzado' 
                                  && contrato.Tipo_Maquila__c =='SmartCard Business'
                              ) {
                                  //Begin Added By Fran Rojas | HU SmartCard 14/06/2021 <frojas@freewayconsulting.com>
                                  console.log('ENTRA IF 524 VIRTUAL');
                                  nombreProducto = 'Contrato Clientes Edenred TC4 SmartCard Pago por Consumo editable';
                                  leyendaHeader = `<div class="leyendaHeader">
                                  <p>DTCOM-</p>
                                  <p>FECHA DE ACTUALIZACIÓN  07/02/2023<p/>
                                  <p>CONTRATO CLIENTES EDENRED TC PAGO POR CONSUMO JUR</p>
                                  <p><strong>DTCOMTC-001 - 1</strong></p>
                                  </div>`
                                  top = '3cm'
                                  //End Added By Fran Rojas | HU SmartCard 14/06/2021 <frojas@freewayconsulting.com>
                              } else if (contrato.TipoPago__c == 'Pospago' && contrato.Item_Contratacion__c == 'TC Basico') {
                                  console.log('ENTRA IF 515 VIRTUAL');
                                  nombreProducto = 'Contrato Clientes Edenred TC4 Basico Pago por Consumo editable';
                                  leyendaHeader = `<div class="leyendaHeader">
                                  <img class="logoEdenred2" src="{!URLFOR($Resource.CotizacionesPDF, "/Encabezados/LogoTicketCar.png")}" />
                                  <p>FECHA DE ACTUALIZACIÓN  07/02/2023</p>
                                  <p>CONTRATO CLIENTES EDENRED TC BASICO PAGO POR CONSUMO JUR</p>
                                  <p>DTFMTC-001-7</p>
                                  </div>`
                                  top = '3cm'
                              } else if (contrato.TipoPago__c == 'Prepago' && contrato.Item_Contratacion__c == 'TC Avanzado' 
                                  && contrato.Tipo_Maquila__c !='SmartCard Business'
                              ) {
                                  console.log('ENTRA IF 524 VIRTUAL');
                                  nombreProducto = 'Contrato Clientes Edenred TC4 Pago por Pedido editable';
                                  //6193 -->
                                  if(contrato.Telepeaje__c == true){
                                      nombreProducto = 'Contrato Clientes Edenred TC4 Pago por Pedido Editable Telepeaje';
                                  }
                                  //<-- 6193
                                  leyendaHeader = `<div class="leyendaHeader">
                                  <img class="logoEdenred2" src="{!URLFOR($Resource.CotizacionesPDF, "/Encabezados/LogoTicketCar.png")}" />
                                      <p>DTCOM- </p>
                                      <p>FECHA DE ACTUALIZACIÓN  07/02/2023 </p>
                                      <p>CONTRATO CLIENTES EDENRED TC PAGO POR PEDIDO JUR </p>
                                      <p>DTCOMTC-001-5</p>
                                  </div>`;
                                  top = '3cm';
                              } else if (contrato.TipoPago__c == 'Prepago' && contrato.Item_Contratacion__c == 'TC Avanzado' 
                                  && contrato.Tipo_Maquila__c =='SmartCard Business'
                              ) {
                                  //Begin Added By Fran Rojas | HU SmartCard 14/06/2021 <frojas@freewayconsulting.com>
                                  console.log('ENTRA IF 524 VIRTUAL CLON para SmartCard');
                                  logoHeader = 'LogoSmartCard.png';
                                  nombreProducto = 'Contrato Clientes Edenred TC4 SmartCard Pago por Pedido editable';
                                  leyendaHeader = `<div class="leyendaHeader">
                                  <img class="logoEdenred2" src="{!URLFOR($Resource.CotizacionesPDF, "/Encabezados/LogoTicketCar.png")}" />
                                      <p>DTCOM- </p>
                                      <p>FECHA DE ACTUALIZACIÓN  07/02/2023 </p>
                                      <p>CONTRATO CLIENTES EDENRED TC PAGO POR PEDIDO JUR </p>
                                      <p>DTCOMTC-001 - 2</p>
                                  </div>`;
                                  top = '3cm';
                                  //End Added By Fran Rojas | HU SmartCard 14/06/2021 <frojas@freewayconsulting.com>
                              } else if (contrato.TipoPago__c == 'Prepago' && contrato.Item_Contratacion__c == 'TC Basico') {
                                  console.log('ENTRA IF 524 VIRTUAL');
                                  nombreProducto = 'Contrato Clientes Edenred TC4 Basico Pago por Pedido editable';
                                  leyendaHeader = `<div class="leyendaHeader">
                                  <img class="logoEdenred2" src="{!URLFOR($Resource.CotizacionesPDF, "/Encabezados/LogoTicketCar.png")}" />
  
                                  <p>FECHA DE ACTUALIZACIÓN  07/02/2023</p>
                                  <p>CONTRATO CLIENTES EDENRED TC BASICO PAGO POR PEDIDO JUR</p>
                                  <p>DTFMTC-001-8</p>
                                  </div>`;
                                  top = '3cm';
                              }
                          } else if (contrato.TipoPago__c == 'Prepago' && contrato.Item_Contratacion__c == 'TC Avanzado' 
                              && dataSource.Product2.ProductCode == "30" 
                              && dataSource.Opportunity.Pilot__c == true
                          ) {
                              console.log('ENTRA piloto prepago');
                              nombreProducto = 'Contrato PILOTO Clientes Edenred TC3 Pedido';
                              leyendaHeader = `<div class="leyendaHeader">
                                      <img class="logoEdenred2" src="{!URLFOR($Resource.CotizacionesPDF, "/Encabezados/LogoTicketCar.png")}" />
                                      <p>DTCOMTC-001-2</p>
                                      <p>FECHA DE ACTUALIZACIÓN  07/02/2023</p>
                                      <p> CONTRATO PIL  <strong>CLIENTES EDENRED</strong> TC PAGO POR PEDIDO JUR</p>
                                      </div>`;
                              top = '3cm';
                          } else if (contrato.TipoPago__c == 'Pospago' && contrato.Item_Contratacion__c == 'TC Avanzado' 
                              && dataSource.Product2.ProductCode == "30" 
                              && dataSource.Opportunity.Pilot__c == true
                          ) {
                              console.log('ENTRA piloto pospago');
                              nombreProducto = 'Contrato PILOTO Clientes Edenred TC3'; //Consumo
                              leyendaHeader = `<div class="leyendaHeader">
                                      <img class="logoEdenred2" src="{!URLFOR($Resource.CotizacionesPDF, "/Encabezados/LogoTicketCar.png")}" />
                                      <p>DTCOMTC-001-1</p>
                                      <p>FECHA DE ACTUALIZACIÓN  07/02/2023</p>
                                      <p> CONTRATO PIL  <strong>CLIENTES EDENRED</strong> TC PAGO POR CONSUMO JUR</p>
                                      </div>`;
                              top = '3cm';
                          } else if (contrato.TipoPago__c == 'Prepago' && contrato.Item_Contratacion__c == 'TC Avanzado' 
                              && dataSource.Product2.ProductCode == "30-TC4" 
                              && dataSource.Opportunity.Pilot__c == true
                          ) {
                              nombreProducto = 'Contrato PILOTO Clientes Edenred TC4 Pedido';
                              leyendaHeader = `<div class="leyendaHeader">
                                      <img class="logoEdenred2" src="{!URLFOR($Resource.CotizacionesPDF, "/Encabezados/LogoTicketCar.png")}" />
                                      <p>DTCOMTC-001-2</p>
                                      <p>FECHA DE ACTUALIZACIÓN  07/02/2023</p>
                                      <p> <strong> CONTRATO PIL CLIENTES EDENRED</strong> TC PAGO POR PEDIDO JUR</p>
                                      </div>`;
                              top = '3cm';
                          } else if (contrato.TipoPago__c == 'Pospago' && contrato.Item_Contratacion__c == 'TC Avanzado' 
                              && dataSource.Product2.ProductCode == "30-TC4" 
                              && dataSource.Opportunity.Pilot__c == true
                          ) {
                              nombreProducto = 'Contrato PILOTO Clientes Edenred TC4 Consumo';
                              leyendaHeader = `<div class="leyendaHeader">
                                      <img class="logoEdenred2" src="{!URLFOR($Resource.CotizacionesPDF, "/Encabezados/LogoTicketCar.png")}" />
                                      <p>DTCOMTC-001-1</p>
                                      <p>FECHA DE ACTUALIZACIÓN  07/02/2023</p>
                                      <p> <strong> CONTRATO PIL CLIENTES EDENRED</strong> TC PAGO POR CONSUMO JUR</p>
                                      </div>`;
                              top = '3cm';
  
                          // CONTINGENCIA AJUSTAR BP FLEET CON BASE A NUEVAS PLANTILLAS SE INCLUYE BP FLEET CLIENTE BÁSICO AVANZADO QUEDA IGUAL NO SE TOCA NADA
                          } else if (contrato.TipoPago__c == 'Prepago' && contrato.Item_Contratacion__c == 'TC Avanzado' 
                              && (dataSource.Product2.ProductCode == "30-B") 
                              || contrato.TipoPago__c == 'Prepago' 
                              && contrato.Item_Contratacion__c == 'TC Basico' 
                              && (dataSource.Product2.ProductCode == "30-B")
                          ) {
                              if (contrato.Item_Contratacion__c == 'TC Avanzado') {
                                  nombreProducto = 'Contrato Clientes BPfleet Prepago';      // Ok  'Contrato Clientes BPfleet Pago por Pedido';
                                  leyendaHeader = `<div class="leyendaHeader" >
                                      <p>DTCFLEET-001-3</p>
                                      <p>FECHA DE ACTUALIZACIÓN 01/03/21</p>
                                      <p>CONTRATO CLIENTES BPfleet PAGO POR PEDIDO JUR</p>
                                      </div>`;
                                  logoHeader = 'LogoEdenred.png';
                              } else if (contrato.Item_Contratacion__c == 'TC Basico') {
                                  nombreProducto = 'Contrato Clientes BPfleet Prepago';      // Ok  'Contrato Clientes BPfleet Pago por Pedido';
                                  leyendaHeader = `<div class="leyendaHeader" >
  
                                      <p>FECHA DE ACTUALIZACIÓN 10/08/2020</p>
                                      <p>CONTRATO CLIENTES BPFLEET BASICO PAGO POR PEDIDO JUR</p>
                                      <p>DTFMBPFLEET-001-8</p>
                                      </div>`;
                                  logoHeader = 'LogoEdenred.png';
                              }
  
                          } else if (contrato.TipoPago__c == 'Pospago' && contrato.Item_Contratacion__c == 'TC Avanzado' 
                              && (dataSource.Product2.ProductCode == "30-B") 
                              || contrato.TipoPago__c == 'Pospago' 
                              && contrato.Item_Contratacion__c == 'TC Basico' 
                              && (dataSource.Product2.ProductCode == "30-B")
                          ) {
                              if (contrato.Item_Contratacion__c == 'TC Avanzado') {
                                  nombreProducto = 'Contrato Clientes BPfleet pago por consumo con descuentos';// Ok
                                  leyendaHeader = `<div class="leyendaHeader" >
                                                      <p>DTCFLEET-001-2</p>
                                                      <p>FECHA DE ACTUALIZACIÓN 01/03/21</p>
                                                      <p>CONTRATO CLIENTES BPfleet PAGO POR CONSUMO JUR</p>
                                                  </div>`;
                                  logoHeader = 'LogoEdenred.png';
                              } else if (contrato.Item_Contratacion__c == 'TC Basico'){
                                      nombreProducto = 'Contrato Clientes BPfleet pago por consumo con descuentos';// Ok
                                  leyendaHeader = `<div class="leyendaHeader" >
                                      <p>FECHA DE ACTUALIZACIÓN 10/08/2020</p>
                                      <p>CONTRATO CLIENTES BPFLEET BASICO PAGO POR CONSUMO JUR</p>
                                      <p>DTFMBPFLEET-001-7</p>
                                      </div>`;
                                  logoHeader = 'LogoEdenred.png';
                              }
  
                              // FIN CONTINGENCIA BPFLEET
                          } else if (dataSource.Product2.ProductCode == "12" && dataSource.Opportunity.Familia__c == "Despensa") {
                              nombreProducto = 'Contrato Vale Despensas Edenred -Banda';
                              leyendaHeader = `<div class="leyendaHeader"><p>Fecha de actualización: 02/02/2023</p>
                                      <p><strong>DTCOMBE-001-3</strong></p>
                                      </div>`;
                              logoHeader = 'LogoValeDespensas.png';
                          } else if (dataSource.Product2.ProductCode == "57" && dataSource.Opportunity.Familia__c == "Despensa" 
                              && dataSource.Opportunity.Pilot__c == false
                          ) {
                              nombreProducto = 'Contrato Despensas Electrónico (EDMX) Agosto 2020';
                              leyendaHeader = `<div class="leyendaHeader"><p>Fecha de Actualización 02/02/2023</p>
                                      <p>DTBEVDE-001-1</p>
                                      </div>`;
                              logoHeader = 'LogoValeDespensas.png';
                          
                          //Separación de logica para cad uno de los productos 32,95,96
                          } else if (dataSource.Product2.ProductCode == "32" && dataSource.Opportunity.Familia__c == "Despensa" 
                              && dataSource.Opportunity.Pilot__c == false
                          ) {
                              nombreProducto = 'Contrato Despensas Electrónico (EDMX) Premium 32';    
                              leyendaHeader = `<div class="leyendaHeader"><p>Fecha de Actualización 05/Agosto/2024</p>    
                              <p>DTCOM-BE-002</p>    
                              </div>`;
                              logoHeader = 'LogoValeDespensas.png';
                          } else if (
                              (dataSource.Opportunity?.RecordType?.DeveloperName == 'Migracion'
                                  || dataSource.Opportunity?.RecordType?.DeveloperName == 'VentaNueva')
                              && (dataSource.Product2.ProductCode == "52-C" || dataSource.Product2.ProductCode == "62-C" 
                                  || dataSource.Product2.ProductCode == "69-C")
                              && (dataSource.Opportunity?.Codigo_Producto_cotizacion__c == "95" 
                                  /*|| dataSource.Opportunity?.Codigo_Producto_cotizacion__c == "32" */ 
                                  || dataSource.Opportunity?.Codigo_Producto_cotizacion__c == "96")
                              && dataSource.Opportunity.Familia__c == "Despensa"
                              && dataSource.Opportunity.Pilot__c == false
                          ) {
                              nombreProducto = 'Contrato Despensas Electrónico (EDMX) Carta Terminos';
                              leyendaHeader = `<div class="leyendaHeader"><p>  Fecha de Actualización 19/09/2023</p>
                              <p><strong> DTBEVDE-001-2P</strong></p> 
                              </div>`;
                              logoHeader = 'LogoValeDespensas.png';
                          } else if ( dataSource.Product2.ProductCode == "95" && dataSource.Opportunity.Familia__c == "Despensa" 
                              && dataSource.Opportunity.Pilot__c == false
                          ) {
                              nombreProducto = 'Contrato Despensas Electrónico (EDMX) Óptima 95'; 
                              leyendaHeader = `<div class="leyendaHeader"> <p>Fecha de Actualización 05/Agosto/2024</p>   
                              <p>DTCOM-BE-002</p>
                              </div>`;
                              logoHeader = 'LogoValeDespensas.png'
                          } else if (dataSource.Product2.ProductCode == "96" && dataSource.Opportunity.Familia__c == "Despensa" 
                              && dataSource.Opportunity.Pilot__c == false 
                          ) {
                              nombreProducto = 'Contrato Despensas Electrónico (EDMX) Esencial 96'; 
                              leyendaHeader = `<div class="leyendaHeader"> <p>Fecha de Actualización 05/Agosto/2024</p>   
                              <p>DTCOM-BE-002</p>;
                              </div>`;
                              logoHeader = 'LogoValeDespensas.png';
                              //Fin de Sepacrión de Contratos
  
                          } else if (
                              (dataSource.Product2.ProductCode == "32" || dataSource.Product2.ProductCode == "95" 
                                  || dataSource.Product2.ProductCode == "96" 
                                  || dataSource.Product2.ProductCode == "57") 
                              && dataSource.Opportunity.Familia__c == "Despensa" 
                              && dataSource.Opportunity.Pilot__c == true
                          ) {
                              nombreProducto = 'Contrato PILOTO Despensas Electrónico';
                              leyendaHeader = `<div class="leyendaHeader"><p>  Fecha de Actualización 02/02/2023</p>
                                      <p><strong> DTBEVDE-001-2P</strong></p>
                                      </div>`;
                              logoHeader = 'LogoValeDespensas.png';
                          } else if (
                              ((dataSource.Product2.ProductCode == "52-C") || (dataSource.Product2.ProductCode == "62-C") 
                                  || (dataSource.Product2.ProductCode == "69-C")) 
                              && dataSource.Opportunity.Familia__c == "Despensa" 
                              && dataSource.Opportunity.Pilot__c == true
                          ) {
                              nombreProducto = 'Contrato PILOTO Despesa Electronico Mellizos';
                              leyendaHeader = `<div class="leyendaHeader"><p> Fecha de Actualización 02/02/2023</p>
                                      <p><strong> DTBEECO-001-2P</strong></p>
                                      </div>`;
                              logoHeader = 'LogoValeDespensas.png';
                          } else if (
                              (dataSource.Product2.ProductCode == "29" || dataSource.Product2.ProductCode == '29-TER' 
                                  || dataSource.Product2.ProductCode == '29-P') 
                              && dataSource.Opportunity.Familia__c == "Empresarial" 
                              && dataSource.Opportunity.Pilot__c == false
                          ) {
                              nombreProducto = "Contrato Empresarial Edenred";
                              leyendaHeader = `<div class="leyendaHeader">
                                  <p>CONTRATO CLIENTES <strong>EMPRESARIAL EDENRED</strong></p>
                                      <p>FECHA DE ACTUALIZACIÓN 02/02/2023</p>
                                  <p><strong>DTCOM-TE-001</strong></p>
                                      </div>`;
                              // subHeader = 'CONTRATO CLIENTES <strong>EMPRESARIAL EDENRED</strong>'
                          } else if (
                              (dataSource.Product2.ProductCode == "29" || dataSource.Product2.ProductCode == '29-TER' 
                                  || dataSource.Product2.ProductCode == '29-P') 
                              && dataSource.Opportunity.Familia__c == "Empresarial" 
                              && dataSource.Opportunity.Pilot__c == true
                          ) {
                              nombreProducto = "Contrato PILOTO Cliente Empresarial Edenred";
                              leyendaHeader = `<div class="leyendaHeader"><p><strong>DTCOM- TE-001 </strong></p>
                                      <p>FECHA DE ACTUALIZACIÓN 02/02/2023</p>
                                      </div>`;
                              subHeader = 'CONTRATO CLIENTES <strong>EMPRESARIAL EDENRED</strong>';
                          } else if (dataSource.Product2.ProductCode == '29-D') {
                              nombreProducto = "Contrato Empresarial Dólares";
                              leyendaHeader = `<div class="leyendaHeader">
                                  <p>CONTRATO <strong> CLIENTES EMPRESARIAL EDENRED</strong></p>
                                      <p>FECHA DE ACTUALIZACIÓN 02/02/2023</p>
                                  <p><strong>DTCOM-TE-001</strong></p>
                                      </div>`;
                              logoHeader = 'EmpresarialEdenredLogo.png';
                          } else if (
                              ((dataSource.Product2.ProductCode == "60-D") || (dataSource.Product2.ProductCode == "60-M") 
                                  || (dataSource.Product2.ProductCode == "60-P") 
                                  || (dataSource.Product2.ProductCode == "60-t")) 
                              && dataSource.Opportunity.Familia__c == "Combustible"
                          ) {
                              
                              if(dataSource.Product2.ProductCode == "60-t") {
                                  conceptsListTC4 = {
                                      'Cargo por envío - Recurrente': {},
                                      'Cargo por envío estándar': {},	
                                      'Refacturación': {},
                                      'Cuota por renta mensual Tarjeta Física': {},
                                      'Implementación Especial': {},
                                      'Comisión por el servicio': {},
                                      'Tarjeta Física': {},
                                      'Cuota por litro Move for Good - 100%': {},
                                      'Ordenamiento y/o entrega especial': {},
                                      'Cuota por litro Move for Good - 50%': {},
                                      'Impresión Especial': {},
                                      'Cargo por Envío Express': {}
                                  };
                                  
                                  nombreProducto = "60-Ecovale combustible";
                                  leyendaHeader = `<div class="leyendaHeaderOPAM style="top: 50px !important;"><p>DTCOM-</p>
                                      <p>FECHA DE ACTUALIZACIÓN 11/03/24</p>
                                      <p>CONTRATO DE CLIENTES OPAM GASOLINA JUR</p>
                                      </div>`;
                                  logoHeader = 'LogoEcovaleOPAM.png';
                                  top = '3cm';
                              } else {
                                  nombreProducto = "Contrato Clientes ECOVALE combustible";
                                  leyendaHeader = `<div class="leyendaHeader"><p>DTCOM-</p>
                                      <p>FECHA DE ACTUALIZACIÓN 02/02/2023</p>
                                      <p>CONTRATO DE CLIENTES OPAM GASOLINA JUR</p>
                                      </div>`;
                                  logoHeader = 'LogoEcovaleCombustible.png';
                              }
                          } else if (
                              ((dataSource.Product2.ProductCode == "41") || (dataSource.Product2.ProductCode == "51") 
                                  || (dataSource.Product2.ProductCode == "61") 
                                  || (dataSource.Product2.ProductCode == "71") 
                                  || (dataSource.Product2.ProductCode == "81") 
                                  || (dataSource.Product2.ProductCode == "91") 
                                  || (dataSource.Product2.ProductCode == "18") 
                                  || (dataSource.Product2.ProductCode == "38") 
                                  || (dataSource.Product2.ProductCode == "48") 
                                  || (dataSource.Product2.ProductCode == "58") 
                                  || (dataSource.Product2.ProductCode == "14") 
                                  || (dataSource.Product2.ProductCode == "34") 
                                  || (dataSource.Product2.ProductCode == "44")) 
                              && ((dataSource.Opportunity.Familia__c == "Ticket Restaurante") || (dataSource.Opportunity.Familia__c == "Regalo") 
                                  || (dataSource.Opportunity.Familia__c == "Vestimenta")  
                                  || (dataSource.Opportunity.Familia__c == "Teletrabajo")) 
                              && (dataSource.Opportunity.Pilot__c == false)
                          ) {
                              switch (dataSource.Product2.ProductCode) {
                                  case "71":
                                      nombreProducto = "Contrato Clientes Edenred Restaurante 12 Abr";
                                      leyendaHeader = `<div class="leyendaHeader">
                                          <p>FECHA DE ACTUALIZACIÓN Marzo/2024</p>
                                          <p>DTCOM-BE-001</p>
                                          </div>`;
                                           top= '2cm'
                                      break;
                                  case "81":
                                      nombreProducto = "Contrato Clientes Edenred Restaurante 12 Abr";
                                      leyendaHeader = `<div class="leyendaHeader">
                                          <p>FECHA DE ACTUALIZACIÓN Marzo/2024</p>
                                          <p>DTCOM-BE-001</p>
                                          </div>`;
                                           top= '2cm'
                                      break;
                                  case "18":
                                      nombreProducto = "Contrato Edenred Multiproducto Mayo 2020 18";
                                      leyendaHeader = `<div class="leyendaHeader">
                                          <p>DTCOMBE-001-11</p>
                                          <p>FECHA DE ACTUALIZACIÓN 02/02/2023</p>
                                          <p>CONTRATO CLIENTES COMIDA/REGALO/VESTIMENTA / JUR</p>
                                          <p>DTCOMMP-001- 1</p>
                                          </div>`;
                                          top= '2cm'
                                      break;
  
                                  case "58":
                                      nombreProducto = "Contrato Edenred Multiproducto Mayo 2020 58";
                                      leyendaHeader = `<div class="leyendaHeader">
                                          <p>DTBEMTP-001-1</p>
                                          <p>	FECHA DE ACTUALIZACIÓN 02/02/2023</p>
                                          <p>CONTRATO CLIENTES COMIDA/REGALO/VESTIMENTA / JUR</p>
                                          <p>DTCOMMP-001- 1</p>
                                          </div>`;
                                      break;
                                      /*case "34":
                                      nombreProducto = "Contrato Edenred Multiproducto Mayo 2020 34";
                                      leyendaHeader = `<div class="leyendaHeader">
                                          <p>DTBEMTP-001-1</p>
                                          <p>FECHA DE ACTUALIZACIÓN 10/02/21</p>
                                          <p>CONTRATO CLIENTES COMIDA/REGALO/VESTIMENTA / PAGO POR CONSUMO JUR</p>
                                          <p>DTCOMMP-001- 1</p>
                                          </div>`;
                                      break;*/
  
                                      /*GEO
                                  case "58":
                                      nombreProducto = "Contrato Edenred Multiproducto Mayo 2020 58";
                                      leyendaHeader = `<div class="leyendaHeader">
                                          <p>DTCOMBE-001-11</p>
                                          <p>FECHA DE ACTUALIZACIÓN 06/04/2020</p>
                                          <p>CONTRATO CLIENTES COMIDA/REGALO/VESTIMENTA / JUR</p>
                                          <p>DTCOMMP-001- 1</p>
                                          </div>`;
                                      break;
                                  case "34":
                                      nombreProducto = "Contrato Edenred Multiproducto Mayo 2020 34";
                                      leyendaHeader = `<div class="leyendaHeader">
                                          <p>DTCOMBE-001-11</p>
                                          <p>FECHA DE ACTUALIZACIÓN 06/04/2020</p>
                                          <p>CONTRATO CLIENTES COMIDA/REGALO/VESTIMENTA / JUR</p>
                                          <p>DTCOMMP-001- 1</p>
                                          </div>`;
                                      break;
                                  */
                                  case "44":
                                      nombreProducto = "Contrato 44-Teletrabajo Edenred.";
                                      leyendaHeader = `<div class="leyendaHeader">
                                          <p>DTBETTC-001-1</p>
                                          <p>FECHA DE ACTUALIZACIÓN 02/02/2023</p>
                                          <p>CONTRATO CLIENTES TELETRABAJO / JUR</p>
                                          </div>`;
                                      break;
                                  default:
                                      if (dataSource.Product2.ProductCode == '41' || dataSource.Product2.ProductCode == '61' 
                                          || dataSource.Product2.ProductCode == '71' 
                                          || dataSource.Product2.ProductCode == '81'
                                      ) {
                                          nombreProducto = "Contrato Edenred Multiproducto Mayo 2020";
                                          leyendaHeader = `<div class="leyendaHeader"><p>DTBEMTP-001-1</p>
                                              <p>FECHA DE ACTUALIZACIÓN 02/02/20232 </p>
                                              <p>CONTRATO CLIENTES COMIDA/REGALO/VESTIMENTA / JUR</p>
                                              <p>DTCOMMP-001-1</p>
                                              </div>`;
                                      } else {
                                          nombreProducto = "Contrato Clientes Multiproducto";
                                          leyendaHeader = `<div class="leyendaHeader"><p>DTBEMTP-001-1</p>
                                              <p>FECHA DE ACTUALIZACIÓN 02/02/2023 </p>
                                              <p>CONTRATO CLIENTES COMIDA/REGALO/VESTIMENTA / JUR</p>
                                              <p>DTCOMMP-001-1</p><br/>
                                              </div>`;
                                      
                                      }
                                      break;
                              }
                          } else if (
                              ((dataSource.Product2.ProductCode == "41") || (dataSource.Product2.ProductCode == "61") 
                                  || (dataSource.Product2.ProductCode == "71") 
                                  || (dataSource.Product2.ProductCode == "81") 
                                  || (dataSource.Product2.ProductCode == "58")) 
                              && ((dataSource.Opportunity.Familia__c == "Ticket Restaurante") || (dataSource.Opportunity.Familia__c == "Regalo")) 
                              && (dataSource.Opportunity.Pilot__c == true)
                          ) {
                              /*BEFORE UPDATE
                                      nombreProducto = "Contrato PILOTO Clientes Edenred Multiproducto";
                                      leyendaHeader = `<div class="leyendaHeader"><p>DTBEMTP-001-2P</p>
                                      <p>FECHA DE ACTUALIZACIÓN 25/05/2020</p>
                                      <p>CONTRATO CLIENTES COMIDA/REGALO/VESTIMENTA / JUR </p>
                                      </div>`
                              */
                              //UPDATE 
                              switch (dataSource.Product2.ProductCode) {
                                  case "58":
                                      nombreProducto = "Contrato Edenred Multiproducto Mayo 2020 58 PILOTO";
                                      leyendaHeader = `<div class="leyendaHeader">
                                          <p>DTBEMTP-001-2P</p>
                                          <p>FECHA DE ACTUALIZACIÓN 02/02/2023</p>
                                          <p>CONTRATO CLIENTES COMIDA/REGALO/VESTIMENTA / JUR</p>
                                          </div>`;
                                      break;
                                  case "71":
                                      nombreProducto = "Contrato PILOTO Clientes Edenred Multiproducto";
                                      leyendaHeader = `<div class="leyendaHeader"><p>DTBEMTP-001-2P</p>
                                      <p>FECHA DE ACTUALIZACIÓN 02/02/2023</p>
                                      <p>CONTRATO CLIENTES COMIDA/REGALO/VESTIMENTA / JUR</p>
                                      </div>`
                                      break;
                                  case "81":
                                      nombreProducto = "Contrato PILOTO Clientes Edenred Multiproducto";
                                      leyendaHeader = `<div class="leyendaHeader"><p>DTBEMTP-001-2P</p>
                                      <p>FECHA DE ACTUALIZACIÓN 02/02/2023</p>
                                      <p>CONTRATO CLIENTES COMIDA/REGALO/VESTIMENTA / JUR</p>
                                      </div>`
                                      break;
                                  default:
                                      nombreProducto = "Contrato PILOTO Clientes Edenred Multiproducto";
                                      leyendaHeader = `<div class="leyendaHeader"><p>DTBEMTP-001-2P</p>
                                      <p>FECHA DE ACTUALIZACIÓN 02/02/2023</p>
                                      <p>CONTRATO CLIENTES COMIDA/REGALO/VESTIMENTA / JUR</p>
                                      </div>`
                                      break;
                              }
                              //FIN UPDATE CONTRATOS
  
                          } else if (
                              ((dataSource.Product2.ProductCode == "34" || dataSource.Product2.ProductCode == "14") 
                                  && (dataSource.Opportunity.Pilot__c == true) 
                                  && (dataSource.Opportunity.Familia__c == "Vestimenta"))
                          ) {
                              nombreProducto = "Contrato PILOTO Clientes Edenred Multiproducto 34";
                              leyendaHeader = `<div class="leyendaHeader"><p>DTBEMTP-001-2P</p>
                                      <p>FECHA DE ACTUALIZACIÓN 02/02/2023</p>
                                      <p>CONTRATO CLIENTES COMIDA/REGALO/VESTIMENTA / JUR </p>
                                      </div>`
                          } else if (
                              ((dataSource.Product2.ProductCode == "39") || (dataSource.Product2.ProductCode == "39-C")) 
                              && (dataSource.Opportunity.Familia__c == "Ayuda Social")
                          ) {
                              if (dataSource.Account.hasOwnProperty("Sector__c")) {
                                  if (dataSource.Account.Sector__c == "Privado") {
                                      nombreProducto = "Contrato Plus Edenred Banda"
                                      leyendaHeader = `<div class="leyendaHeader"><p>CONTRATO CLIENTES PLUS EDENRED 02/02/2023</p>
                                      <p>DTCOMTP-001-01</p>
                                      </div>`
                                  }
                                  else if (dataSource.Account.Sector__c == "Público") {
                                      nombreProducto = "Contrato Plus Edenred Chip";
                                      leyendaHeader = `<div class="leyendaHeader"><p>CONTRATO CLIENTES PLUS EDENRED 02/02/2023</p>
                                      <p>DTCOMTP-001-02</p>
                                      </div>`
                                  }
                              }
                          } else if (
                              ((dataSource.Product2.ProductCode == "52-C") || (dataSource.Product2.ProductCode == "62-C") 
                                  || (dataSource.Product2.ProductCode == "69-C")) 
                              && dataSource.Opportunity.Familia__c == "Despensa" 
                              && dataSource.Opportunity.Pilot__c == false
                          ) {
                              nombreProducto = "Contrato Clientes ECOVALE Despensa";
                              leyendaHeader = `<div class="leyendaHeader"><p>Fecha de Actualización 02/02/2023</p>
                                      <p><strong> DTBEECO-001-01</strong></p>
                                      </div>`
                              logoHeader = 'LogoEcoValeDespensas.png'
                          } else if (dataSource.Product2.ProductCode == "19" && dataSource.Opportunity.Familia__c == "Despensa") {
                              nombreProducto = "Contrato Clientes TVBE Papel";
                              leyendaHeader = `<div class="leyendaHeader"><p><strong>Fecha de actualización: 02/02/2023</strong></p>
                                      <p>DTCOMBE-001-02</p><br>
                                      </div>`
                          } else if (
                              (dataSource.Product2.ProductCode == "02" && dataSource.Opportunity.Familia__c == "Despensa") 
                              || (dataSource.Product2.ProductCode == "9" && dataSource.Opportunity.Familia__c == "Despensa")
                          ) {
                              nombreProducto = "Contrato Despensa Papel Mayo 2020";
                              leyendaHeader = `<div class="leyendaHeader"><p><strong>Fecha de actualización: 02/02/2023</strong></p>
                                      <p>DTBETD-001–01</p><br>
                                      </div>`
                          } else if (dataSource.Product2.ProductCode == "1" && dataSource.Opportunity.Familia__c == "Ticket Restaurante" 
                              && dataSource.Opportunity.Pilot__c == false
                          ) {
                              nombreProducto = "Contrato clientes papel TRestaurante";
                              leyendaHeader = `<div class="leyendaHeader"><p>DTBEMTP-001-1</p>
                                              <p>FECHA DE ACTUALIZACIÓN 02/02/2023 </p>
                                              <p>CONTRATO CLIENTES COMIDA/REGALO/VESTIMENTA / JUR</p>
                                              <p>DTCOMMP-001-1</p>
                                              </div>`
                          } else if (dataSource.Product2.ProductCode == "1" && dataSource.Opportunity.Familia__c == "Ticket Restaurante" 
                              && dataSource.Opportunity.Pilot__c == true
                          ) {
                              nombreProducto = "Contrato clientes papel TRestaurante PILOTO";
                              leyendaHeader = `<div class="leyendaHeader"><p>DTBEMTP-001-2P</p>
                                              <p>FECHA DE ACTUALIZACIÓN 02/02/2023 </p>
                                              <p>CONTRATO CLIENTES COMIDA/REGALO/VESTIMENTA / JUR</p>
                                      </div>`
                          } else if ((dataSource.Product2.ProductCode == "3") && (dataSource.Opportunity.Familia__c == "Combustible")) {
                              nombreProducto = "Contrato clientes Gasolina PAPEL MAYO 2020";
                              leyendaHeader = `<div class="leyendaHeader">
                                                  <p><strong>Fecha de actualización: 02/02/2023</strong></p>
                                              </div>`
                              ////////////////////////////////////////////////////
                          } else if (dataSource.Product2.ProductCode == "TC-AF") {
                              leyendaHeader = `<div class="leyendaHeader">`
                              top = '3.2cm'
                              nombreProducto = "Ticket Car - Alta Afiliado";
                          } else if (dataSource.Product2.ProductCode == "des-AF" || dataSource.Product2.ProductCode == "des-AF-OPAM") {
                              if (contrato.Entidad_Legal__r && contrato.Entidad_Legal__r.RecordType.Name) {
                                  leyendaHeader = `<div class="leyendaHeader">`
                                  top = '3.2cm'
                                  var tipoPersona = contrato.Entidad_Legal__r.RecordType.Name || ''
                                  if (tipoPersona == 'Persona Moral') {
                                      nombreProducto = "Contrato Benefits - Afiliados VDE (Persona moral) Fija";
                                  } else {
                                      nombreProducto = "Contrato Benefits - Afiliados VDE (Persona física) Fija";
                                  }
                              }
                          } else if (dataSource.Product2.ProductCode == "CONAPESCA-AF") {
                              leyendaHeader = `<div class="leyendaHeader">`
                              top = '3.2cm'
                              nombreProducto = "Contrato Ticket Car - Afiliados CONAPESCA";
                          } else if (dataSource.Product2.ProductCode == "BP-AF") {
                              leyendaHeader = `<div class="leyendaHeader">`
                              logoHeader = ''
                              top = '3.2cm'
                              nombreProducto = "Contrato Ticket Car - Afiliados BP";
                          } else if (dataSource.Product2.ProductCode == "G500-AF") {
                              leyendaHeader = `<div class="leyendaHeader">`
                              top = '3.2cm'
                              logoHeader = ''
                              nombreProducto = "Contrato Ticket Car - Afiliados G500";
                          } else if (["multip-AF", "viat-AF", "ince-AF", "ayudaS-AF", "vest-AF", "com-AF"].includes(dataSource.Product2.ProductCode)) {
                              console.log("MULTIPROD");
                              if (contrato.Entidad_Legal__r && contrato.Entidad_Legal__r.RecordType.Name) {
                                  top = '3.2cm'
                                  leyendaHeader = `<div class="leyendaHeader">`
                                  var tipoPersona = contrato.Entidad_Legal__r.RecordType.Name || ''
                                  if (tipoPersona == 'Persona Moral') {
                                      console.log("MULTIPROD1");
                                      nombreProducto = "Contrato Benefits - Afiliados Multiproducto (persona moral) fija";
                                  } else {
                                      console.log("MULTIPROD2");
                                      nombreProducto = "Contrato Benefits - Afiliados Multiproducto (persona física) Fija";
                                  }
                              }
  
                          } else if((dataSource.Product2.ProductCode == "43") && (dataSource.Opportunity.Familia__c == "Mantenimiento Fleet") /*&& nombreProductoOriginal != "43 Mantenimiento Fleet Américas" && nombreProductoOriginal != "Mantenimiento Fleet Edenred + Américas"*/){//Req Producto 43
                              var tipoPersona = contrato.Entidad_Legal__r.TipoPersona__c || '';
                              if (tipoPersona == 'Persona Moral') {
                                  nombreProducto = "Contrato Clientes Mantenimiento Consumo PM 43";
                                  leyendaHeader = `<div class="leyendaHeader">
                                          <img class="logoEdenred2 logoEdenred3" src="{!URLFOR($Resource.CotizacionesPDF, "/Encabezados/LogoMantenimiento_Fleet.png")}" />
                                          <p>FECHA DE ACTUALIZACIÓN 02/02/2023</p>
                                          <p>CONTRATO <strong>CLIENTES MANTENIMIENTO FLEET</strong> JUR</p>
                                          <p>EDENRED MÉXICO, S.A. DE C.V</p>
                                          <p>DTAMTO-001 - 2</p>
                                          </div>`
                                          top='3.5cm'
                                          logoHeader = 'LogoEdenred.png'
                              } else if (tipoPersona == 'Persona Física') {
                                  console.log('entramos 3: ' + dataSource.Product2.Name);
                                  nombreProducto = "Contrato Clientes Mantenimiento Consumo PF 43";
                                  leyendaHeader = `<div class="leyendaHeader">
                                          <img class="logoEdenred2 logoEdenred3" src="{!URLFOR($Resource.CotizacionesPDF, "/Encabezados/LogoMantenimiento_Fleet.png")}" />
                                          <p>DTCOMTCM-001-3-1</p>
                                          <p>FECHA DE ACTUALIZACIÓN 01/02/23</p>
                                          <p>CONTRATO <strong>CLIENTES MANTENIMIENTO FLEET</strong> JUR</p>
                                          <p>EDENRED MÉXICO, S.A. DE C.V.</p>
                                          </div>`
                                          top='3.5cm'
                                          logoHeader = 'LogoEdenred.png'
  
                              }
                          } else if (nombreProductoOriginal == "31 Mantenimiento de flota" && (dataSource.Opportunity.Familia__c == "Mantenimiento Fleet")){//REQ 6452 PROD 31 
                              console.log('ENTRA 31 AMERICAS');
                              var tipoPersona = contrato.Entidad_Legal__r.TipoPersona__c || '';
                              if (tipoPersona == 'Persona Moral') {
                                  console.log('ENTRA 31 AMERICAS PM');
                                  nombreProducto = "Contrato 31-Mantenimiento Fleet -- Persona Moral";
                                  leyendaHeader = `<div class="leyendaHeader">
                                          <img class="logoEdenred2 logoEdenred3" src="{!URLFOR($Resource.CotizacionesPDF, "/Encabezados/LogoMantenimiento_Fleet.png")}" />
                                          <p>FECHA DE ACTUALIZACIÓN 22/02/21</p>
                                          <p>CONTRATO <strong>SOCIOS AFILIADOS MANTENIMIENTO PM EDENRED</strong> JUR</p>
                                          <p>SERVICIOS Y SOLUCIONES EMPRESARIALES TICKET EDENRED, S.A. DE C.V.</p>
                                          <p>DTAMTO-001 - 2</p>
                                          </div>`
                                          top='3.5cm'
                                          logoHeader = 'LogoEdenred.png'
                              } else if (tipoPersona == 'Persona Física'){
                                  console.log('ENTRA 31 AMERICAS PF');
                                  nombreProducto = "Contrato 31-Mantenimiento Fleet -- Persona Física";
                                  leyendaHeader = `<div class="leyendaHeader">
                                          <img class="logoEdenred2 logoEdenred3" src="{!URLFOR($Resource.CotizacionesPDF, "/Encabezados/LogoMantenimiento_Fleet.png")}" />
                                          <p>DTCOMTCM-001-3-1</p>
                                          <p>FECHA DE ACTUALIZACIÓN 22/02/21</p>
                                          <p>CONTRATO <strong>SOCIOS AFILIADOS MANTENIMIENTO PF EDENRED</strong> JUR</p>
                                          <p>SERVICIOS Y SOLUCIONES EMPRESARIALES TICKET EDENRED, S.A. DE C.V.</p>
                                          </div>`
                                          top='3.5cm'
                                          logoHeader = 'LogoEdenred.png'
  
                              } else {
                                      console.log('ENTRA 43 AMERICAS SIN PM y PF');
                              }
                          } else if (
                              nombreProductoOriginal == "Mantenimiento Fleet Edenred + Américas" 
                              && (dataSource.Opportunity.Familia__c == "Mantenimiento Fleet")
                          ) {//REQ 6452 PROD 43 MTTO FLEET + AMERICAS 
  
                              console.log('ENTRA 43 MTTO. FLEET + AMERICAS');
                              var tipoPersona = contrato.Entidad_Legal__r.TipoPersona__c || '';
                              //REQ: 6452 >>>>
                              if (tipoPersona == 'Persona Moral') {
                                  console.log('ENTRA 43 MTTO. FLEET + AMERICAS PM');
                                  if(dataSource.Product2.ProductCode == '31') {
                                      nombreProducto = "Contrato 31-Mantenimiento Fleet -- Persona Moral";
                                      console.debug('📘',nombreProducto);
                                      leyendaHeader = `<div class="leyendaHeader">
                                          <img class="logoEdenred2 logoEdenred3" src="{!URLFOR($Resource.CotizacionesPDF, "/Encabezados/LogoMantenimiento_Fleet.png")}" />
                                          <p>FECHA DE ACTUALIZACIÓN 02/02/2023</p>
                                          <p>CONTRATO <strong>SOCIOS AFILIADOS MANTENIMIENTO PM EDENRED</strong> JUR</p>
                                          <p>SERVICIOS Y SOLUCIONES EMPRESARIALES TICKET EDENRED, S.A. DE C.V.</p>
                                          <p>DTAMTO-001 - 2</p>
                                          </div>`
                                          top='3.5cm'
                                          logoHeader = 'LogoEdenred.png'
                                  } else if(dataSource.Product2.ProductCode == '43') {
                                      nombreProducto = "Contrato Clientes Mantenimiento Consumo PM 43";
                                      console.debug('📘',nombreProducto);
                                      leyendaHeader = `<div class="leyendaHeader">
                                          <img class="logoEdenred2 logoEdenred3" src="{!URLFOR($Resource.CotizacionesPDF, "/Encabezados/LogoMantenimiento_Fleet.png")}" />
                                          <p>FECHA DE ACTUALIZACIÓN 02/02/2023</p>
                                          <p>CONTRATO <strong>SOCIOS AFILIADOS MANTENIMIENTO PM EDENRED</strong> JUR</p>
                                          <p>SERVICIOS Y SOLUCIONES EMPRESARIALES TICKET EDENRED, S.A. DE C.V.</p>
                                          <p>DTAMTO-001 - 2</p>
                                          </div>`
                                          top='3.5cm'
                                          logoHeader = 'LogoEdenred.png'
                                  }
                                  
                              } else if (tipoPersona == 'Persona Física') {
                                  console.log('ENTRA 43 MTTO. FLEET + AMERICAS PF');
                                  
                                  if(dataSource.Product2.ProductCode == '31') {
                                      nombreProducto = "Contrato 31-Mantenimiento Fleet -- Persona Física"; 
                                      console.debug('📘',nombreProducto);
                                      leyendaHeader = `<div class="leyendaHeader">
                                          <img class="logoEdenred2 logoEdenred3" src="{!URLFOR($Resource.CotizacionesPDF, "/Encabezados/LogoMantenimiento_Fleet.png")}" />
                                          <p>DTCOMTCM-001-3-1</p>
                                          <p>FECHA DE ACTUALIZACIÓN 22/02/21</p>
                                          <p>CONTRATO <strong>SOCIOS AFILIADOS MANTENIMIENTO PF EDENRED</strong> JUR</p>
                                          <p>SERVICIOS Y SOLUCIONES EMPRESARIALES TICKET EDENRED, S.A. DE C.V.</p>
                                          </div>`
                                          top='3.5cm'
                                          logoHeader = 'LogoEdenred.png'
                                  } else if(dataSource.Product2.ProductCode == '43') {
                                      nombreProducto = "Contrato Clientes Mantenimiento Consumo PF 43"; 
                                      console.debug('📘',nombreProducto);
                                      leyendaHeader = `<div class="leyendaHeader">
                                          <img class="logoEdenred2 logoEdenred3" src="{!URLFOR($Resource.CotizacionesPDF, "/Encabezados/LogoMantenimiento_Fleet.png")}" />
                                          <p>DTCOMTCM-001-3-1</p>
                                          <p>FECHA DE ACTUALIZACIÓN 02/02/2023</p>
                                          <p>CONTRATO <strong>SOCIOS AFILIADOS MANTENIMIENTO PF EDENRED</strong> JUR</p>
                                          <p>SERVICIOS Y SOLUCIONES EMPRESARIALES TICKET EDENRED, S.A. DE C.V.</p>
                                          </div>`
                                          top='3.5cm'
                                          logoHeader = 'LogoEdenred.png'
                                  }
                              } else {//REQ: 6452 <<<
                                  console.log('ENTRA 43 AMERICAS SIN PM y PF');
                              }
                          }
                          //NVH------- implementación producto 43 y recordtype Mantenimiento  ------------------------------
                          //Codigo_Producto_cotizacion__c vive en la oportunidad, es el nuevo code a migrar
                          else if(dataSource.Product2.ProductCode === "31" 
                              && dataSource.Opportunity?.Codigo_Producto_cotizacion__c === "43" 
                              && (dataSource.Opportunity?.RecordType?.DeveloperName === 'Migracion' 
                                  || dataSource.Opportunity?.RecordType?.DeveloperName === 'VentaNueva')
                          ) {
                              console.log('NVH- Contrato Migracion', contrato);                            
                              
                              if (contrato.Entidad_Legal__r && contrato.Entidad_Legal__r.TipoPersona__c) {
                                  top = '3.5cm';
                                  logoHeader = 'LogoEdenred.png';
                                  var tipoPersona = contrato.Entidad_Legal__r.TipoPersona__c || '';
                                  if (tipoPersona === 'Persona Moral') {
                                      nombreProducto = "Contrato Clientes Mantenimiento Consumo PM";
                                      leyendaHeader = `<div class="leyendaHeader">
                                              <img class="logoEdenred2 logoEdenred3" src="{!URLFOR($Resource.CotizacionesPDF, "/Encabezados/LogoMantenimiento_Fleet.png")}" />
                                              <p>DTCOMTCM-001-2-2</p>
                                              <p>FECHA DE ACTUALIZACIÓN 01/02/23</p>
                                              <p>CONTRATO <strong>CLIENTES MANTENIMIENTO EDENRED PAGO POR CONSUMO PM</strong> JUR</p>
                                              <p>EDENRED MÉXICO, S.A. DE C.V</p>
                                              
                                              </div>`;
                                  } else if (tipoPersona === 'Persona Física') {
                                      nombreProducto = "Contrato Clientes Mantenimiento Consumo PF";
                                      leyendaHeader = `<div class="leyendaHeader">
                                              <img class="logoEdenred2 logoEdenred3" src="{!URLFOR($Resource.CotizacionesPDF, "/Encabezados/LogoMantenimiento_Fleet.png")}" />
                                              <p>DTCOMTCM-001-2-1</p>
                                              <p>FECHA DE ACTUALIZACIÓN 01/02/23</p>
                                              <p>CONTRATO <strong>CLIENTES MANTENIMIENTO EDENRED PAGO POR CONSUMO PF</strong> JUR</p>
                                              <p>EDENRED MÉXICO, S.A. DE C.V.</p>
                                              </div>`;
                                  }
                              }
                          } else if ((dataSource.Product2.ProductCode == "31" || dataSource.Product2.ProductCode == "43") 
                              && (dataSource.Opportunity.Familia__c != "Mantenimiento Fleet")
                          ) {
                              if (contrato.Entidad_Legal__r && contrato.Entidad_Legal__r.TipoPersona__c && contrato.TipoPago__c) {
  
                                  top = '3.5cm';
                                  var tipoPersona = contrato.Entidad_Legal__r.TipoPersona__c || '';
  
                                  if (tipoPersona == 'Persona Moral' && contrato.TipoPago__c == 'Prepago' 
                                      && dataSource.Opportunity.Pilot__c == false
                                  ) {
                                      nombreProducto = "Contrato Clientes Mantenimiento Pedido PM"//OK
                                      leyendaHeader = `<div class="leyendaHeader">
                                      <img class="logoEdenred2 logoEdenred3" src="{!URLFOR($Resource.CotizacionesPDF, "/Encabezados/LogoMantenimiento_Fleet.png")}" />
                                      <p>DTCOMTCM-001-1-2</p>
                                      <p>FECHA DE ACTUALIZACIÓN 02/02/2023</p>
                                      <p>CONTRATO <strong>CLIENTES MANTENIMIENTO EDENRED PAGO POR PEDIDO PM</strong> JUR</p>
                                      <p>SERVICIOS Y SOLUCIONES EMPRESARIALES TICKET EDENRED, S.A. DE C.V.</p>
                                      </div>`
                                  } else if (tipoPersona == 'Persona Moral' && contrato.TipoPago__c == 'Prepago' 
                                      && dataSource.Opportunity.Pilot__c == true
                                  ) {
                                      console.log('NVH- esc1');
                                      nombreProducto = "CONTRATO PILOTO CLIENTES MANTO PEDIDO PM"//OK
                                      leyendaHeader = `<div class="leyendaHeader">
                                      <img class="logoEdenred2 logoEdenred3" src="{!URLFOR($Resource.CotizacionesPDF, "/Encabezados/LogoMantenimiento_Fleet.png")}" />
                                      <p>DTCOMTCM-001-2-2</p>
                                      <p>FECHA DE ACTUALIZACIÓN 02/02/2023</p>
                                      <p> CONTRATO<strong> CLIENTES MANTENIMIENTO EDENRED PAGO POR CONSUMO PM</strong>  JUR</p>
                                      <p>SERVICIOS Y SOLUCIONES EMPRESARIALES TICKET EDENRED, S.A. DE C.V.</p>
                                      </div>`
                                  } else if (tipoPersona == 'Persona Física' && contrato.TipoPago__c == 'Prepago' 
                                      && dataSource.Opportunity.Pilot__c == false
                                  ) {
                                      nombreProducto = "Contrato Clientes Mantenimiento Pedido PF"
                                      leyendaHeader = `<div class="leyendaHeader">
                                      <img class="logoEdenred2 logoEdenred3" src="{!URLFOR($Resource.CotizacionesPDF, "/Encabezados/LogoMantenimiento_Fleet.png")}" />
                                      <p>DTCOMTCM-001-1-1</p>
                                      <p>FECHA DE ACTUALIZACIÓN 02/02/2023</p>
                                      <p>CONTRATO <strong>CLIENTES MANTENIMIENTO PAGO POR PEDIDO PF</strong> JUR</p>
                                      <p>SERVICIOS Y SOLUCIONES EMPRESARIALES TICKET EDENRED, S.A. DE C.V.</p>
                                      </div>`
                                      top='3.5cm'
                                  } else if (tipoPersona == 'Persona Física' && contrato.TipoPago__c == 'Prepago' 
                                      && dataSource.Opportunity.Pilot__c == true
                                  ) {
                                      nombreProducto = "CONTRATO PILOTO CLIENTES MANTO PEDIDO PF2"
                                      leyendaHeader = `<div class="leyendaHeader">
                                      <img class="logoEdenred2 logoEdenred3" src="{!URLFOR($Resource.CotizacionesPDF, "/Encabezados/LogoMantenimiento_Fleet.png")}" />
                                      <p>DTCOMTCM-001-1-1</p>
                                      <p>FECHA DE ACTUALIZACIÓN 02/02/2023</p>
                                      <p>CONTRATO <strong>CLIENTES MANTENIMIENTO EDENRED</strong> PAGO POR PEDIDO PF JUR</p>
                                      <p>SERVICIOS Y SOLUCIONES EMPRESARIALES TICKET EDENRED, S.A. DE C.V.</p>
                                      </div>`
                                  } else if (dataSource.Product2.ProductCode == "43" && tipoPersona == 'Persona Moral' 
                                      && contrato.TipoPago__c == 'Pospago' 
                                      && dataSource.Opportunity.Pilot__c == false
                                  ) { // ACTUALIZACIÓN CONTRATOS
                                      console.log('NVH- esc2');
                                      //nombreProducto = "Contrato Clientes Mantenimiento Consumo PM 43"//OK
                                      nombreProducto = "Contrato Clientes Mantenimiento Consumo PM"//OK
                                      leyendaHeader = `<div class="leyendaHeader">
                                      <img class="logoEdenred2" src="{!URLFOR($Resource.CotizacionesPDF, "/Encabezados/LogoMantenimiento_Fleet.png")}" />
                                      <p>DTCOMTCM-001-2-2</p>
                                      <p>FECHA DE ACTUALIZACIÓN 02/02/2023</p>
                                      <p>CONTRATO <strong>CLIENTES MANTENIMIENTO EDENRED PAGO POR CONSUMO PM</strong> JUR</p>
                                      <p>EDENRED MÉXICO, S.A. DE C.V.</p>
                                      </div>`
                                  } else if (tipoPersona == 'Persona Moral' && contrato.TipoPago__c == 'Pospago' 
                                      && dataSource.Opportunity.Pilot__c == false
                                  ) {
                                      console.log('NVH- esc3');
                                      console.log('NVH- datasource: ', dataSource);
                                      console.log('NVH- datasource: ', dataSource);
                                      
                                      nombreProducto = "Contrato Clientes Mantenimiento Consumo PM"//OK
                                      leyendaHeader = `<div class="leyendaHeader">
                                      <img class="logoEdenred2" src="{!URLFOR($Resource.CotizacionesPDF, "/Encabezados/LogoMantenimiento_Fleet.png")}" />
                                      <p>DTCOMTCM-001-2-2</p>
                                      <p>FECHA DE ACTUALIZACIÓN 02/02/2023</p>
                                      <p>CONTRATO <strong>CLIENTES MANTENIMIENTO EDENRED PAGO POR CONSUMO PM</strong> JUR</p>
                                      <p>EDENRED MÉXICO, S.A. DE C.V.</p>
                                      </div>`
                                  } else if (tipoPersona == 'Persona Moral' && contrato.TipoPago__c == 'Pospago' 
                                      && dataSource.Opportunity.Pilot__c == true
                                  ) {
                                      console.log('NVH- esc4');
                                      nombreProducto = "CONTRATO PILOTO CLIENTES MANTO CONSUMO PM"//OK
                                      leyendaHeader = `<div class="leyendaHeader">
                                      <img class="logoEdenred2" src="{!URLFOR($Resource.CotizacionesPDF, "/Encabezados/LogoMantenimiento_Fleet.png")}" />
                                      <p>DTCOMTCM-001-2-2</p>
                                      <p>FECHA DE ACTUALIZACIÓN 02/02/2023</p>
                                      <p>CONTRATO <strong>CLIENTES MANTENIMIENTO EDENRED</strong> PAGO POR CONSUMO PM JUR</p>
                                      <p>SERVICIOS Y SOLUCIONES EMPRESARIALES TICKET EDENRED, S.A. DE C.V.</p>
                                      </div>`
                                  } else if (dataSource.Product2.ProductCode == "43" && tipoPersona == 'Persona Física' 
                                      && contrato.TipoPago__c == 'Pospago' 
                                      && dataSource.Opportunity.Pilot__c == false
                                  ) { // ACTUALIZACIÓN CONTRATOS
                                      //nombreProducto = "Contrato Clientes Mantenimiento Consumo PF 43"
                                      nombreProducto = "Contrato Clientes Mantenimiento Consumo PF"
                                      leyendaHeader = `<div class="leyendaHeader">
                                      <img class="logoEdenred2" src="{!URLFOR($Resource.CotizacionesPDF, "/Encabezados/LogoMantenimiento_Fleet.png")}" />
                                      <p>DTCOMTCM-001-2-1</p>
                                      <p>FECHA DE ACTUALIZACIÓN 01/02/23</p>
                                      <p>CONTRATO <strong>CLIENTES MANTENIMIENTO EDENRED PAGO POR CONSUMO PF</strong> JUR</p>
                                      <p>EDENRED MÉXICO, S.A. DE C.V.</p>
                                      </div>`
                                  } else if (tipoPersona == 'Persona Física' && contrato.TipoPago__c == 'Pospago' 
                                      && dataSource.Opportunity.Pilot__c == false
                                  ) {
                                      nombreProducto = "Contrato Clientes Mantenimiento Consumo PF"
                                      leyendaHeader = `<div class="leyendaHeader">
                                      <img class="logoEdenred2" src="{!URLFOR($Resource.CotizacionesPDF, "/Encabezados/LogoMantenimiento_Fleet.png")}" />
                                      <p>DTCOMTCM-001-2-1</p>
                                      <p>FECHA DE ACTUALIZACIÓN 02/02/2023</p>
                                      <p>CONTRATO <strong>CLIENTES MANTENIMIENTO EDENRED PAGO POR CONSUMO PF</strong> JUR</p>
                                      <p>SERVICIOS Y SOLUCIONES EMPRESARIALES TICKET EDENRED, S.A. DE C.V.</p>
                                      </div>`
                                  } else if (tipoPersona == 'Persona Física' && contrato.TipoPago__c == 'Pospago' 
                                      && dataSource.Opportunity.Pilot__c == true
                                  ) {
                                      nombreProducto = "CONTRATO PILOTO CLIENTES MANTO CONSUMO PF2"
                                      leyendaHeader = `<div class="leyendaHeader">
                                      <img class="logoEdenred2" src="{!URLFOR($Resource.CotizacionesPDF, "/Encabezados/LogoMantenimiento_Fleet.png")}" />
                                      <p>DTCOMTCM-001-2-1</p>
                                      <p>FECHA DE ACTUALIZACIÓN 02/02/2023</p>
                                      <p>CONTRATO <strong>CLIENTES MANTENIMIENTO EDENRED</strong> PAGO POR CONSUMO PF JUR</p>
                                      <p>SERVICIOS Y SOLUCIONES EMPRESARIALES TICKET EDENRED, S.A. DE C.V.</p>
                                      </div>`
                                  } else {
                                      return Promise.reject(new Error('Para la adecuada generación del contrato es necesario asociar una Entidad Legal y Tipo de Facturación'))
                                  }
                              } else {
                                  return Promise.reject(new Error('Para la adecuada generación del contrato es necesario asociar una Entidad Legal y Tipo de Facturación'))
                              }
                          } else if (dataSource.Product2.ProductCode == "32-WebSale" && dataSource.Opportunity.Pilot__c == false) {
                              nombreProducto = "32-Vale Despensas Red Premium chip_WebSales";
                              leyendaHeader = `<div class="leyendaHeader" >
                              <p>FECHA DE ACTUALIZACIÓN 02/02/2023</p>
                                      <p>DTBEMQLCH - 001 - 01</p>
                                      </div>`
                              logoHeader = 'LogoValeDespensas.png'
                          } else if (dataSource.Product2.ProductCode == "32-CH") {
                              nombreProducto = "Contrato Despensas Electrónico Chedraui Mayo 2020";//Ajuste 6207
                              leyendaHeader = `<div class="leyendaHeader" >
                                  <img class="logoEdenred2" src="{!URLFOR($Resource.CotizacionesPDF, "/Encabezados/LogoChedraui.png")}" />
                                      <p>Fecha de Actualización 22/Marzo/2024</p>
                                      <p>DTBEMQLCH-001-1</p>
                                      </div>`
                              top= '3cm'
                              logoHeader = 'LogoValeDespensas.png'
                          } else if (dataSource.Product2.ProductCode == "32-W") { // 6207 ajuste fecha de actualización
                              nombreProducto = "Contrato Vale Despensa Walmart";   //"Contrato Vale Despensa Walmart";
                              leyendaHeader = `<div class="leyendaHeader" >
                                  <img class="logoEdenred2" src="{!URLFOR($Resource.CotizacionesPDF, "/Encabezados/LogoWalmart.png")}" />
                                      <p>Fecha de Actualización 22/Marzo/2024</p>
                                      <p>DTBEMQLWM-001-1</p>
                                      </div>`
                              top='3cm'
                              logoHeader = 'LogoValeDespensas.png'
                          } else if (dataSource.Product2.ProductCode == "48-CH") {
                              nombreProducto = "Contrato Chedraui Regalo Junio 2020";
                              leyendaHeader = `<div class="leyendaHeader" >
                              <img class="logoEdenred2" src="{!URLFOR($Resource.CotizacionesPDF, "/Encabezados/LogoChedraui.png")}" />
                              <p>DTBEMQLCHTTR-001-1</p>
                              <p>FECHA DE ACTUALIZACIÓN  08/Marzo/2024</p>
                              <p>CONTRATO CLIENTES REGALO CHEDRAUI/JUR</p>
                              </div>`
                              top= '3cm'
                              logoHeader = 'LogoRegaloEdenred.png'
                          } else if (dataSource.Product2.ProductCode == "48-W") {
                              nombreProducto = "Contrato Clientes Regalo Walmart Mayo 2020 v1";
                              leyendaHeader = `<div class="leyendaHeader" >
                                  <img class="logoEdenred2" src="{!URLFOR($Resource.CotizacionesPDF, "/Encabezados/LogoWalmart.png")}" />
                                                  <p> FECHA DE ACTUALIZACIÓN  08/Octubre/2024</p>
                                                  <p>DTBEMQLW-001-1</p>
                                              </div>`
                                                  top= '3cm'
                              logoHeader = 'LogoRegaloEdenred.png'
                          } else if (dataSource.Product2.ProductCode == "30-G") {
                              nombreProducto = "Contrato Ticket Car G500 Fleet";
                              leyendaHeader = `<div class="leyendaHeader" >
                              <p>DTCOM - 001 - 03</p>
                              <p>FECHA DE ACTUALIZACIÓN 02/02/2023</p>
                              <p>CONTRATO CLIENTES EDENRED TC PAGO POR PEDIDO JUR</p>
                              </div>`
                              logoHeader = 'LogoTicketCar.png'
                          } else if (dataSource.Product2.ProductCode == "30-E") {
                              nombreProducto = "Contrato Ticket Car Element";
                              leyendaHeader = `<div class="leyendaHeader" >
                              <p>DTCOM - 001 - 03</p>
                              <p>FECHA DE ACTUALIZACIÓN 02/02/2023</p>
                              <p>CONTRATO CLIENTES EDENRED TC PAGO POR PEDIDO JUR</p>
                              </div>`
                              logoHeader = 'LogoTicketCar.png'
                          } else if (dataSource.Product2.ProductCode == "30-S") {
                              nombreProducto = "Contrato Ticket Car Servifacil";
                              leyendaHeader = `<div class="leyendaHeader" >
                              <p>DTCOM - 001 - 20</p>
                              <p>FECHA DE ACTUALIZACIÓN 02/02/2023</p>
                              <p>CONTRATO CLIENTES SERVIFAC PAGO POR PEDIDO JUR</p>
                              </div>`
                              logoHeader = 'LogoTicketCar.png'
                          } else {

                                //NVH -- Edenred Arg -- No aplica para productos Arg
                                if (productsArgCodes.includes(dataSource.Product2.ProductCode)) {
                                    if (dataSource.Product2.ProductCode == "XC") {
                                        nombreProducto = "XC-Ticket Car";
                                    } 
                                    else if(dataSource.Product2.ProductCode == "YC") {
                                        nombreProducto = "YC-Shell";
                                    }
                                   
                                }
                                else {
                                    nombreProducto = '{!QuoteLineItem.Product2.Name}';
                                    return Promise.reject(new Error('Los criterios definidos no son adecuados para la generación del contrato, favor de revisar'));
                                }
                          }
                          console.log('HOLA 13_04_2021');
                          console.log(`Plantilla de contrato: ${nombreProducto}`);
                          query = "select Activo__c, AnexoA__c, AnexoB__c, AnexoC__c, AnexoD__c, AnexoE__c, AdditionalAnnexVP__c,AdditionalAnnexME__c, CamposAnexoA__c, CamposAnexoB__c, CamposAnexoC__c, CamposAnexoD__c, CodigosTYC__c, Contenido_del__c, Contratos_Ticket_Despensa__c, CreatedById, CreatedDate, Dias_habiles_para_entrega_de_tarjetas__c, Horas_de_anticipacion_para_dispersion_de__c, Horas_de_dispersion_de_saldos__c, Id, IsDeleted, LastModifiedById, LastModifiedDate, LastReferencedDate, LastViewedDate, Name, OwnerId, RecordTypeId, Seccion1__c, Seccion2__c, Seccion3__c, Seccion4__c, Seccion5__c, Seccion6__c, SystemModstamp, Tipo_Contrato__c, UsoMarcaLogotipo__c, UsoProgramaOrganismoGubernamental__c,Logocontrato__c,Adicional__c, Carta_terminos__c from PlantillaContrato__c WHERE Name = '" + nombreProducto + "' ";
                          
                          if (dataSource.Opportunity.Maquilas__c) {
  
                              console.log('dataSource.Opportunity.Maquilas__c',dataSource.Opportunity.Maquilas__c);
                              var queryMaquilas = 'SELECT AdditionalAnnexME__c FROM PlantillaContrato__c WHERE Name IN (';
                              var arrayMaquilas = dataSource.Opportunity.Maquilas__c.split(';');
  
                              for(let m in arrayMaquilas) {
                                  queryMaquilas += "'" + getContractName(arrayMaquilas[m]) + "',";
                              }
                              queryMaquilas += "'end')";
                              return ctcLightning.remote("CON_ContractsContainer_CTRL.getMultiTempleate")(query, queryMaquilas);
                          } else {
                              return ctcLightning.remote("CON_ContractsContainer_CTRL.executeQueryRA")(query);
                          }
                      })
                      .then(function (res) {
                          console.log('NVH_res1:  ', res);
                          if (dataSource.Opportunity.Maquilas__c) {
                              plantilla = res && res.Main ? res.Main[0] : {};
                              maquilaTempleate = res && res.Maquilas ? res.Maquilas : null;
                          } else {
                              plantilla = res && res.length > 0 ? res[0] : {};
                          }
                              
                          console.log('Plantilla: ', plantilla);
                          // query = "select CuentaActiva_Text__c, AnualidadTarjeta__c, Bonificacion__c, Cargo__c, CargoConsecutivo__c, CargoCuentaActiva__c, CargoporEnvio__c, CargoTAG__c, ComisionFijaAS__c, ComisionFijaAsignacionSaldo__c, ComisionServicio__c, ComisionServicios__c, Contraprestacion__c, CreatedById, CreatedDate, CuentaActiva__c, CuentaAutoconsumo__c, CuotaAdscripcion__c, CuotaAnual__c, CuotaDispersion__c, CuotaLitros__c, Datos_Anexo__c, DescuentoEquivalente__c, EmisionTarjetas__c, EnvioTarjetas__c, Etiqueta__c, FechaContrato__c, Fianza__c, FormaPago__c, Id, IdContrato__c, ImplementacionInscripcion__c, IsDeleted, LastModifiedById, LastModifiedDate, Mensualidad__c, MensualidadAutoconsumo__c, MontoDO__c, Name, NombreCliente__c, NombreTitular__c, NumeroTarjeta__c, OwnerId, PeriodoFacturacion__c, PresenciaVehicular__c, RecordTypeId, Renovacion__c, RenovacionTarjeta__c, RenovacionTarjetaTexto__c, ReposicionTarjeta__c, ReposicionTarjetaLetra__c, Solucion__c, SystemModstamp, TarjetaAdicional__c, TarjetaAdicionalTexto__c, TarjetaTitular__c, TarjetaTitularTexto__c, TipoAnexo__c, Transacciones__c, TransferenciaReferenciada__c, Vigencia__c, VigenciaTarjetas__c, VigenciaVehicular__c  from Anexo__c where IdContrato__c = '" + contrato.Id + "'";
                          query = "SELECT AnualidadTarjeta__c,annualQuota__c,IssuanceElectronicCheck__c,redemptionPoints__c,transactionFee__c,collectionPerLiter__c,electronicTransferExpedition__c,PaperTransferExpedition__c,PercentagePaperParticipation__c,PercentageElectronicParticipation__c,PercentageElectronicParticipationText__c, Bonificacion__c, CargoConsecutivo__c, CargoCuentaActiva__c, CargoRefactura__c, CargoTAG__c, Cargo__c, Cargo_por_env_o_letra__c," +
                              "CargoporEnvio__c, Cargos_por_Asignaci_n_de_Saldo__c, Cargos_por_Asignaci_n_de_Saldo_letra__c, ComisionFijaAS__c, ComisionFijaAsignacionSaldo__c," +
                              "ComisionServicio__c, ComisionServicios__c, Contraprestacion_Letra__c, Contraprestacion__c, CreatedById, CreatedDate, CuentaActiva__c," +
                              "CuentaAutoconsumo__c, CuotaAdscripcion__c, CuotaAnual__c, CuotaAutoconsumo__c, CuotaDispersionLetra__c, CuotaDispersion__c, CuotaInscripcionLetra__c," +
                              "CuotaLitros__c, Cuota_por_cuenta_activa__c, Cuota_por_cuenta_activa_letra__c, Cuota_por_env_o__c, Cuota_por_env_o_letra__c, Datos_Anexo__c, " +
                              "DescuentoEquivalente__c, Detalle__c, EmisionTarjetas__c, EnvioTarjetas__c, Etiqueta__c, FechaContrato__c, Fianza__c, FijoVehiculo__c, FormaPago__c," +
                              "Gestor_propietario_de_Opp__c, Id, IdContrato__c, ImplementacionInscripcion__c, IsDeleted, LastModifiedById, LastModifiedDate, MensualidadAutoconsumo__c," +
                              "Mensualidad__c, MontoDO__c, Name, NombreCliente__c, NombreTitular__c, NumeroTarjeta__c, OwnerId, PeriodoFacturacion__c, Porcentaje__c," +
                              "PresenciaVehicular__c, Propietario_de_la_oportunidad__c, Raz_n_social__c, RecordTypeId, RenovacionTarjetaTexto__c, RenovacionTarjeta__c, Renovacion__c," +
                              "RentaPlataforma__c, ReposicionTarjetaLetra__c, ReposicionTarjeta__c, Representante_legal_Edenred__c, Representante_legal_cliente__c, Solucion__c, " +
                              "SystemModstamp, TarjetaAdicionalTexto__c, TarjetaAdicional__c, TarjetaTitularTexto__c, TarjetaTitular__c, TipoAnexo__c, Transacciones__c," +
                              "TransferenciaReferenciada__c, VigenciaTarjetas__c, VigenciaVehicular__c, Vigencia__c, Implementacion_Text__c, CuotaImplementacionLetra_Text__c," +
                              "CuotaMensualidad_Text__c, CuotaMensualidadLetra_Text__c, CuentaActiva_Text__c, CuotaAnualidadLetra_Text__c, CuotaAdscripcionPyme_Text__c," +
                              "CuotaAdscripcionPymeLetra_Text__c, CuotaAdscripcionGrande_Text__c, CuotaAdscripcionGrandeLetra_Text__c, CargoEnvio_Text__c, CargoEnvioLetra_Text__c," +
                              "CuotaImplementacion_Text__c, AnualidadGrande_Text__c, AnualidadGrandeLetra_Text__c, AnualidadPyme_Text__c, AnualidadPymeLetra_Text__c," +
                              "CuotaInscripcion_Text__c, CuotaInscripcionLetra_Text__c, CargoRefacturacionLetra_Text__c FROM Anexo__c where IdContrato__c = '" + contrato.Id + "'";
                          var e = document.createElement('div');
                          e.innerHTML = plantilla.Contenido_del__c;
                          if(dataSource.Product2.ProductCode == "33") {
                              if(dataSource.Opportunity.RecordType.DeveloperName === 'Migracion') {
                                  plantilla.Contenido_del__c = e.childNodes[0].nodeValue;
                              }
                              else {
                                  console.log('######################Contenido_del__c',e.childNodes[0], e.childNodes[1])
                                  plantilla.Contenido_del__c = e.childNodes[0].nodeValue; //+ e.childNodes[1].nodeValue; //before: e.childNodes[0].nodeValue;
                              }
                          } else {
                              plantilla.Contenido_del__c = e.childNodes[0].nodeValue;
                          }
  
                          plantilla.Contenido_del__c = plantilla.Contenido_del__c.replace(/font-family: Calibri;/g, 'font-family: Helvetica;');
                          plantilla.Contenido_del__c = plantilla.Contenido_del__c.replace(/‐/g, '-');
  
                          console.log("dataSource: ", dataSource)
                          console.log("dataSource PrepaidTag__c: ", dataSource.Contrato2__c.PrepaidTag__c)
  
                          // Agregar aquí filiales - calvarez 4/04/2018
  
                          if (filiales.length > 0) {
                              var representanteLegal = '<table class="tableFilial">';
                              if (representantes.length > 0) {
                                  for (var representante of representantes) {
                                      representanteLegal = representanteLegal + '<tr><td style="width: 50%">' + representante.Name + '</td><td style="width: 50%">&nbsp;</td></tr>';
                                  }
                              }
                              representanteLegal = representanteLegal + '</table>';
  
                              var strFilial = ""
                              for (var filial of filiales) {
                                  var nombreFilial = filial.EntidadLegal__c.RazonSocial__c || ''
  
                                  filial.EntidadLegal__c.Direccion__c = filial.EntidadLegal__c.Direccion__c && filial.EntidadLegal__c.Direccion__c != ', , , , , ,' ? filial.EntidadLegal__c.Direccion__c : ''
                                  filial.EntidadLegal__c.Name = filial.EntidadLegal__c.Name || ''
                                  // filial.Contacto__c.Name = filial.Contacto__c.Name || ''
                                  //var representanteLegal = contrato.Contacto__r && contrato.Contacto__r.Name ? contrato.Contacto__r.Name : '';
  
  
                                  /*if(entidadLegal.Cuenta__r && isMerchand(contrato.Producto__c, strAccountRecordType))
                                      templateFiliales = '<p> EDENRED y el AFILIADO acuerdan y consienten que, las filiales del AFILIADO que se señalan a continuación quedan adheridas al contrato en todos los términos y condiciones señalados en el mismo. El AFILIADO acepta ser responsable solidario para pagar la totalidad de las transacciones y conceptos de cobro generados por sus filiales adheridas al CONTRATO; así como ser el representante del resto de las filiales para todas las negociaciones y acuerdos de la relación comercial con EDENRED. </p> <p>  Para todos los efectos de este CONTRATO las partes convienen en considerar dentro del término “CLIENTE” a la persona moral principal y a todas las personas morales filiales que se detallan a continuación:</p>'
                                  else
                                      templateFiliales = '<p>  Para todos los efectos de este CONTRATO las partes convienen en considerar dentro del término “CLIENTE” a la persona moral principal y a todas las personas morales filiales que se detallan en este documento. Así mismo ambas partes están de acuerdo en que se autorizan en forma expresa y reciproca el uso de sus nombres comerciales, denominaciones o razones sociales sin el pago de regalías, ni cargo alguno, para referencia comercial. </p>';
                                  */
                                  if(entidadLegal.Cuenta__r && isMerchand(contrato.Producto__c, strAccountRecordType))
                                      strFilial += '<tr> <td>FILIAL</td> <td>' + nombreFilial + '</td> <td>' + filial.EntidadLegal__c.Direccion__c + '</td> <td>' + filial.AccountEntityName + '</td> <td colspan="2">' + representanteLegal + '</td> </tr>'
                                  else
                                      strFilial += '<tr> <td>FILIAL</td> <td>' + nombreFilial + '</td> <td>' + filial.EntidadLegal__c.Direccion__c + '</td> <td>' + filial.EntidadLegal__c.Name + '</td> <td colspan="2">' + representanteLegal + '</td></tr>';
                              }
  
                              templateFiliales = templateFiliales + '<table class="tableFilial"><thead> <tr> <th rowspan="2" style="width: 7%">Entidad</th> <th rowspan="2" style="width: 13%">Razón social</th> <th rowspan="2">Domicilio fiscal</th> <th rowspan="2" style="width: 15%">RFC</th> <th rowspan="1" colspan="2" style="width: 40%">Representante legal</th> </tr> <tr> <th style="width: 15%">Nombre</th> <th style="width: 25%">Firma</th> </tr> </thead> <tbody>' + strFilial + '</tbody> </table>';
  
                              // console.log("strFilial: ", strFilial, "\ntemplateFiliales", templateFiliales)
                              // plantilla.Contenido_del__c += templateFiliales
                          }
                          plantilla.Contenido_del__c = plantilla.Contenido_del__c.replace(/\(filiales\)/g, templateFiliales);
  
  
                          //Datos representantes Legales
  
                          if (representantes.length > 0) {
                              if(dataSource.Product2.ProductCode == "43" || dataSource.Product2.ProductCode == "31"){
                                  templateRepLegalesFirma = '<table class="ql-table-blob" border="0" style="white-space: normal; color: rgb(112, 110, 107); style="font-size: xx-small;" width="100%"><tr>';
                              }else{
                                  templateRepLegalesFirma = '<table class="ql-table-blob" border="0" style="white-space: normal; color: rgb(112, 110, 107);" width="100%"><tr>';
                              }
                              var cont = 0;
                              var contfirma = 2;
                              var contreps = 0;
                              cantidadRepLegales = representantes.length;
                              for (var rep of representantes) {
                                  contreps ++;
  
                                  templateDatosRepLegales = templateDatosRepLegales + '<table class="ql-table-blob" border="2" style="width: 488.95pt; color: rgb(62, 62, 60); margin-left: 10.2pt; white-space: normal;"><tbody><tr><td align="left" colspan="4" rowspan="1">';
                                  templateDatosRepLegales = templateDatosRepLegales + '<p>Apellidos: ' + rep.LastName + '<br>Nombre(s): '+ rep.FirstName+'<br>Actividad, giro o negocio: ' + dataSource.Account.Giro__c + '</p></td></tr>';
                                  templateDatosRepLegales = templateDatosRepLegales + '<tr><td align="left" colspan="1" rowspan="1">Fecha de nacimiento<ul/>' + (rep.BirthdateText__c==null?'':rep.BirthdateText__c) +'</td><td colspan="1" rowspan="1">Lugar de nacimiento<ul/>'+(rep.BirthState__c==null?'':rep.BirthState__c)+'</td><td colspan="1" rowspan="1">País de nacimiento<ul/>'+(rep.BirthCountry__c==null?'':rep.BirthCountry__c)+'</td><td colspan="1" rowspan="1">Lugar de residencia<ul/>'+(rep.MailingCity==null?'':rep.MailingCity)+'</td></tr>';
                                  templateDatosRepLegales = templateDatosRepLegales + '<tr><td colspan="1" rowspan="1">RFC (con homoclave)<ul/>'+(rep.RFC__c==null?'':rep.RFC__c)+'</td><td colspan="1" rowspan="1">Condición de estancia<ul/>'+(rep.ConditionOfStaying__c==null?'':rep.ConditionOfStaying__c)+'</td><td colspan="1" rowspan="1">Ocupación<ul/>'+(rep.ProfessionName__c==null?'':rep.ProfessionName__c)+'</td><td colspan="1" rowspan="1">Nacionalidad<ul/>'+(rep.Nationality__c==null?'':rep.Nationality__c)+'</td></tr>';
                                  templateDatosRepLegales = templateDatosRepLegales + '<tr><td colspan="1" rowspan="1">CURP<ul/>'+(rep.Curp__c==null?'':rep.Curp__c)+'</td><td colspan="1" rowspan="1">Teléfono de negocio<ul/>'+ (dataSource.Account.Phone==null?'':dataSource.Account.Phone)+'</td><td colspan="1" rowspan="1">Teléfono personal<ul/>'+(rep.Phone=null?'':rep.Phone)+'</td><td colspan="1" rowspan="1">Correo electrónico<ul/><span style="font-size: 11px;">'+(rep.Email==null?'':rep.Email)+'</span></td></tr>';
                                  templateDatosRepLegales = templateDatosRepLegales + '<tr><td colspan="1" rowspan="1">Datos de la identificación<ul/>'+(rep.typeIdentification__c=='INE'?rep.ElectorID__c:'')+'</td><td colspan="1" rowspan="1">Nombre de identificación<ul/>'+(rep.typeIdentification__c==null?'':rep.typeIdentification__c)+'</td><td colspan="1" rowspan="1">Autoridad que la emite<ul/>'+(rep.typeIdentification__c=='INE'?'Instituto Nacional Electoral':rep.typeIdentification__c=='Cedula profesional'?'Secretaría de Educación Pública':rep.typeIdentification__c=='Pasaporte'?'Secretaría de relaciones exteriores':rep.typeIdentification__c=='Licencia de manejo'?'Secretaría de transporte':'')+'</td><td colspan="1" rowspan="1">Número de identificación<ul/><span style="font-size: 11px;">'+(rep.IDNumber__c==null?'':rep.IDNumber__c)+'</span></td></tr>';
                                  templateDatosRepLegales = templateDatosRepLegales + '<tr><td align="left" colspan="2" rowspan="1">Domicilio particular (residencia) del representante legal y/o persona física:<ul/>Calle: ' +(rep.Street__c==null?'':rep.Street__c)+'<ul/>Colonia: '+(rep.Colonia__c==null?'':rep.Colonia__c)+'<ul/>'+(dataSource.Product2.ProductCode == "33" ? 'Alcaldía o Municipio: ' : 'Municipio: ')+(rep.MailingCity==null?'':rep.MailingCity)+'<ul/>Entidad federativa: '+(rep.MailingState==null?'':rep.MailingState)+'</td><td align="left" colspan="2" rowspan="1"><ul/>No. Ext y/o Int: '+(rep.NumberingOuterInner__c==null?'':rep.NumberingOuterInner__c)+'<ul/>Código postal: '+(rep.MailingPostalCode==null?'':rep.MailingPostalCode)+'<ul/>Ciudad o población: '+(rep.MailingCity==null?'':rep.MailingCity)+'<ul/>País: '+(rep.MailingCountry==null?'':rep.MailingCountry)+'</td></tr>';
                                  templateDatosRepLegales = templateDatosRepLegales + '<tr><td align="left" colspan="4" rowspan="1"><p>Establezca si tiene conocimiento de la existencia de Beneficiario Controlador<span>Si [ ] / No [ ]</span></p><p>(en caso afirmativo indicar R.F.C.)<span>________________________________________</span></p><p>Establezca si el Representante Legal o el Beneficiario Controlador es una persona<span>Si [ ] / No [ ]</span><br>Políticamente Expuesta</p><p>(en caso afirmativo indicar R.F.C.)<span>________________________________________</span></p></td></tr>';
                                  templateDatosRepLegales = templateDatosRepLegales + '</tbody></table></br>';
  
                                  if (cont == 2){
                                      templateRepLegalesFirma = templateRepLegalesFirma + '</tr><tr>';
                                      cont = 0;
                                  }
                                  if(dataSource.Product2.ProductCode == "43" || dataSource.Product2.ProductCode == "31"){
                                      templateRepLegalesFirma = templateRepLegalesFirma + '<td align="center"><table><tr height="15"><td align="center" colspan="1" rowspan="1" width="100%" style="color: #ffffff;">\\s'+contfirma+'\\</td></tr><tr><td align="center" colspan="1" rowspan="1" width="100%">_________________________</td></tr><tr height="15"><td align="center" colspan="1" rowspan="1" width="100%">'+rep.Name+'</td></tr><tr height="15"><td align="center" colspan="1" rowspan="1" width="100%">Por: ' + dataSource.EntidadLegal__c.RazonSocial__c + ' ' + dataSource.EntidadLegal__c.TipoSociedad_PL__c +'</td></tr></table></td>';
                                  }else{
                                      templateRepLegalesFirma = templateRepLegalesFirma + '<td align="center"><table><tr height="17"><td align="center" colspan="1" rowspan="1" width="100%" style="color: #ffffff;">\\s'+contfirma+'\\</td></tr><tr><td align="center" colspan="1" rowspan="1" width="100%">________________________________________</td></tr><tr height="17"><td align="center" colspan="1" rowspan="1" width="100%">'+rep.Name+'</td></tr><tr height="17"><td align="center" colspan="1" rowspan="1" width="100%">Por: ' + dataSource.EntidadLegal__c.RazonSocial__c + ' ' + dataSource.EntidadLegal__c.TipoSociedad_PL__c +'</td></tr></table></td>';
                                  }
                                  contfirma++;
                                  cont++;
  
                                  nombresRepLegales = nombresRepLegales + rep.Name;
                                  if (contreps < cantidadRepLegales - 1){
                                      nombresRepLegales = nombresRepLegales + ', ';
                                  }
                                  else{
                                      nombresRepLegales = nombresRepLegales + ' Y ';
                                  }
                              }
  
                              templateRepLegalesFirma = templateRepLegalesFirma + '</tr></table>';
                          }
  
                          nombresRepLegales = nombresRepLegales.toUpperCase();
                          nombresRepLegales = nombresRepLegales.substring(0,nombresRepLegales.length - 3);
  
  
                          return ctcLightning.remote("CON_ContractsContainer_CTRL.executeQueryRA")(query)
                      })
                      .then(function (res) {
                          console.log('ENTRA RESPUESTA:' , res);
                          anexos = res && res.length > 0 ? res[0] : {};
                          if ( anexos.electronicTransferExpedition__c == undefined || anexos.electronicTransferExpedition__c == null ){
                              anexos.electronicTransferExpedition__c = "0.00";
                          }
                              
                          if ( anexos.collectionPerLiter__c == undefined || anexos.collectionPerLiter__c == null ){
                              anexos.collectionPerLiter__c = "0.00";
                          }
                              
                          if ( anexos.transactionFee__c == undefined || anexos.transactionFee__c == null ){
                              anexos.transactionFee__c = "0.00";
                          }
                              
                          if ( anexos.annualQuota__c == undefined || anexos.annualQuota__c == null ){
                              anexos.annualQuota__c = "0.00";
                          }
                              
                          dataSource.Anexo__c = anexos;
                          plantilla.Contenido_del__c = replaceStr(plantilla.Contenido_del__c, dataSource);
                          plantilla.Contenido_del__c = replaceTextRespLegales(plantilla.Contenido_del__c, cantidadRepLegales, templateDatosRepLegales, templateRepLegalesFirma);
                          plantilla.Contenido_del__c = plantilla.Contenido_del__c.replace(/\(\!filiales\)/g, templateFiliales);
                          plantilla.Contenido_del__c = plantilla.Contenido_del__c.replace(/\(\!productosConcepto\)/g, templateConceptos);
                          plantilla.Contenido_del__c = plantilla.Contenido_del__c.replace(/\(\!nombresreplegales\)/g, nombresRepLegales);
  
                          replaceConceptValues(plantilla, conceptList, conceptsListTC4, 'Contenido_del__c');
                          plantilla.Contenido_del__c = plantilla.Contenido_del__c.replace(/color: rgb\(112\, 110\, 107\)\;/g, '');
                          plantilla.Contenido_del__c = plantilla.Contenido_del__c.replace(new RegExp('!check', 'gi'), '<input type="checkbox" kendoCheckBox checked="true" [(ngModel)]="model.foo" />');
  
                          // ECOVALE
                          if (!dataSource.Anexo__c.hasOwnProperty("CuotaInscripcionLetra_Text__c")) {
                              plantilla.Contenido_del__c = plantilla.Contenido_del__c.replace(/\(\!CuotaInscripcionLetra_Text__c\)/g, '(N/A)');
                          } else {
                              plantilla.Contenido_del__c = plantilla.Contenido_del__c.replace(/\(\!CuotaInscripcionLetra_Text__c\)/g, dataSource.Anexo__c.CuotaInscripcionLetra_Text__c);
                          }
  
                          if (!dataSource.Anexo__c.hasOwnProperty("TarjetaTitularTexto__c")) {
                              plantilla.Contenido_del__c = plantilla.Contenido_del__c.replace(/\(\!TarjetaTitularTexto__c\)/g, '(N/A)');
                          } else {
                              plantilla.Contenido_del__c = plantilla.Contenido_del__c.replace(/\(\!TarjetaTitularTexto__c\)/g, dataSource.Anexo__c.TarjetaTitularTexto__c);
                          }
  
                          if (!dataSource.Anexo__c.hasOwnProperty("TarjetaAdicionalTexto__c")) {
                              plantilla.Contenido_del__c = plantilla.Contenido_del__c.replace(/\(\!TarjetaAdicionalTexto__c\)/g, '(N/A)');
                          } else {
                              plantilla.Contenido_del__c = plantilla.Contenido_del__c.replace(/\(\!TarjetaAdicionalTexto__c\)/g, dataSource.Anexo__c.TarjetaAdicionalTexto__c);
                          }
  
                          if (!dataSource.Anexo__c.hasOwnProperty("ReposicionTarjetaLetra__c")) {
                              plantilla.Contenido_del__c = plantilla.Contenido_del__c.replace(/\(\!ReposicionTarjetaLetra__c\)/g, '(N/A)');
                          } else {
                              plantilla.Contenido_del__c = plantilla.Contenido_del__c.replace(/\(\!ReposicionTarjetaLetra__c\)/g, dataSource.Anexo__c.ReposicionTarjetaLetra__c);
                          }
  
                          if (dataSource.Contrato2__c.UsoMarcaLogotipo__c) {
                              plantilla.Contenido_del__c = plantilla.Contenido_del__c.replace(/\(\!UsoMarcaLogotipoTrue__c\)/g, '<span class="fa fa-check-square-o"></span>');
                          } else { 
                              plantilla.Contenido_del__c = plantilla.Contenido_del__c.replace(/\(\!UsoMarcaLogotipoTrue__c\)/g, '<span class="fa fa-square-o"></span>');
                          }
  
                          if (!dataSource.Contrato2__c.UsoMarcaLogotipo__c) {
                              plantilla.Contenido_del__c = plantilla.Contenido_del__c.replace(/\(\!UsoMarcaLogotipoFalse__c\)/g, '<span class="fa fa-check-square-o"></span>');
                          } else {
                              plantilla.Contenido_del__c = plantilla.Contenido_del__c.replace(/\(\!UsoMarcaLogotipoFalse__c\)/g, '<span class="fa fa-square-o"></span>');
                          }
  
                          //CONTINGENCIA
                          plantilla.Contenido_del__c = plantilla.Contenido_del__c.replace('DIAS_DE_CREDITO', creditDays);
                          plantilla.Contenido_del__c = plantilla.Contenido_del__c.replace(/\(SALTAR PAGINA\)/g, '<div class="page-break"></div>');
                          plantilla.Contenido_del__c = plantilla.Contenido_del__c.replace(/\(CIUDAD_ESTADO\)/g, ''+dataSource.Account.BillingAddress.city);
                          plantilla.Contenido_del__c = plantilla.Contenido_del__c.replace(/\(TIPO_DE_GARANTIA\)/g, ''+dataSource.Contrato2__c.PartidaPresupuesto__r.WarrantyType__c);
                          plantilla.Contenido_del__c = plantilla.Contenido_del__c.replace(/\(MONTO_EN_GARANTIA\)/g, ''+dataSource.Contrato2__c.PartidaPresupuesto__r.WarrantyValue__c);
                          plantilla.Contenido_del__c = plantilla.Contenido_del__c.replace(/\(MONTO_EN_LETRA\)/g, ''+numeroALetras(dataSource.Contrato2__c.Linea_Operativa__c, {plural: 'PESOS', singular: 'PESO', centPlural: 'CENTAVOS', centSingular: 'CENTAVO'})+ ' MXN');
                          plantilla.Contenido_del__c = plantilla.Contenido_del__c.replace(/\(CONDICIONES_PAGO_PLAZO\)/g, ''+dataSource.Contrato2__c.CondicionesPagoPlazo__c);
                          
                          if((contrato.TipoPago__c == 'Prepago' || contrato.TipoPago__c == 'Pospago') 
                              && (dataSource.Product2.ProductCode == "30" || dataSource.Product2.ProductCode == "30-TC4"
                                  || dataSource.Product2.ProductCode == "30-B" )
                              && dataSource.Contrato2__c.PrepaidTag__c
                              && contrato.Tipo_Maquila__c != "SmartCard Business"
                          ) {
                              console.log("ENTRA 1241");
                              plantilla.Contenido_del__c = plantilla.Contenido_del__c.replace(/\(TERCERA_SISTEMA\)/g, '<p><b>TERCERA. SISTEMA.- </b> EDENRED entregará en el domicilio del CLIENTE, previo pago correspondiente por parte de este último, los monederos electrónicos y/o dispositivos tecnológicos del Sistema TC, que requiera para su operación, en un máximo de 7 (SIETE) días hábiles. Tanto el pedido como el pago deberán efectuarse a través de los medios establecidos por EDENRED. El CLIENTE asume la obligación de confirmar la recepción de los monederos electrónicos y/o dispositivos tecnológicos que haya solicitado, previo al envío del primer pedido de saldos. EL CLIENTE y los USUARIOS asumen la obligación de consultar y conocer el funcionamiento del producto contratado mediante los materiales puestos a disposición por EDENRED a través de las siguientes plataformas:  www.edenred.mx y www.edenredtraining.mx . Todos los monederos electrónicos y/o dispositivos tecnológicos del Sistema TC son propiedad de EDENRED, quien se reserva el derecho a sustituirlas, bloquearlas o modificar su modo de funcionamiento cuando lo considere necesario para la correcta operación del Sistema TC.</p>');
                          }
                          //Begin Added By Fran Rojas | HU SmartCard
                          else if((contrato.TipoPago__c == 'Prepago' || contrato.TipoPago__c == 'Pospago') 
                              && (dataSource.Product2.ProductCode == "30" || dataSource.Product2.ProductCode == "30-TC4" 
                                  || dataSource.Product2.ProductCode == "30-B" ) 
                              && dataSource.Contrato2__c.PrepaidTag__c  
                              && contrato.Tipo_Maquila__c == "SmartCard Business"
                          ) {
                              console.log("ENTRA 1241 CLON para SmartCard");
                              plantilla.Contenido_del__c = plantilla.Contenido_del__c.replace(/\(TERCERA_SISTEMA\)/g, '<p> <b> TERCERA. SISTEMA.- </b> EDENRED entregará, en el domicilio del CLIENTE, los monederos electrónicos TicketCar Edenred - Smart Card Business y/o dispositivos tecnológicos del Sistema TC, que requiera para su operación, en un máximo de 7 (SIETE) días hábiles. Tanto el pedido como el pago deberán efectuarse a través de los medios establecidos por EDENRED. El CLIENTE asume la obligación de confirmar la recepción de los monederos electrónicos TicketCar Edenred - Smart Card Business y/o dispositivos tecnológicos que haya solicitado, previo al envío del primer pedido de saldos, usando el procedimiento descrito en el Manual de Administrador Smart Card Business TC, el cual estará a disposición del CLIENTE y de los USUARIOS a través del sitio web de EDENRED (www.edenred.mx), así como en el centro telefónico de atención a clientes 52-62-88-57. EL CLIENTE y los USUARIOS asumen la obligación de consultar y conocer el Manual de Administrador Smart Card Business TC aplicable al producto contratado, en su versión actualizada. Todos los monederos electrónicos y/o dispositivos tecnológicos del Sistema TC son propiedad de EDENRED, quien se reserva el derecho a sustituirlas, bloquearlas o modificar su modo de funcionamiento cuando lo considere necesario para la correcta operación del Sistema TC. </p>');
                          }
                          //End Added By Fran Rojas | HU SmartCard
                          else if ((contrato.TipoPago__c == 'Prepago' || contrato.TipoPago__c == 'Pospago') 
                              && (dataSource.Product2.ProductCode == "30" || dataSource.Product2.ProductCode == "30-TC4") 
                              && !dataSource.Contrato2__c.PrepaidTag__c 
                              && (contrato.Item_Contratacion__c == 'TC Basico' || contrato.Item_Contratacion__c == 'Avanzado') 
                              && contrato.Tipo_Maquila__c != "SmartCard Business"
                          ) {
                              console.log("ENTRA 1244");
                              plantilla.Contenido_del__c = plantilla.Contenido_del__c.replace(/\(TERCERA_SISTEMA\)/g, '<p><b>TERCERA. SISTEMA.- </b>EDENRED entregará, en el domicilio del CLIENTE, los monederos electrónicos y/o dispositivos tecnológicos del Sistema TC que requiera para su operación, en un máximo de 7 (siete) días hábiles. Tanto el pedido como el pago deberán efectuarse a través de los medios establecidos por EDENRED. El CLIENTE asume la obligación de confirmar la recepción de los monederos electrónicos y/o dispositivos tecnológicos que haya solicitado, previo al envío del primer pedido de saldos. EL CLIENTE y los USUARIOS asumen la obligación de consultar y conocer el funcionamiento del producto contratado mediante los materiales puestos a disposición por EDENRED a través de las siguientes plataformas:  www.edenred.mx y www.edenredtraining.mx . Todos los monederos electrónicos y/o dispositivos tecnológicos del Sistema TC son propiedad de EDENRED, quien se reserva el derecho a sustituirlas, bloquearlas o modificar su modo de funcionamiento cuando lo considere necesario para la correcta operación del Sistema TC </p>');
                          } else if ((contrato.TipoPago__c == 'Prepago' || contrato.TipoPago__c == 'Pospago') 
                              && (dataSource.Product2.ProductCode == "30" || dataSource.Product2.ProductCode == "30-TC4") 
                              && !dataSource.Contrato2__c.PrepaidTag__c 
                              && contrato.Tipo_Maquila__c != "SmartCard Business"
                          ) {
                              console.log("ENTRA 1247");
                              plantilla.Contenido_del__c = plantilla.Contenido_del__c.replace(/\(TERCERA_SISTEMA\)/g, '<p><b>TERCERA. SISTEMA.- </b>EDENRED entregará, en el domicilio del CLIENTE, los monederos electrónicos y/o dispositivos tecnológicos del Sistema TC, que requiera para su operación, en un máximo de 7 (SIETE) días hábiles. Tanto el pedido como el pago deberán efectuarse a través de los medios establecidos por EDENRED. El CLIENTE asume la obligación de confirmar la recepción de los monederos electrónicos y/o dispositivos tecnológicos que haya solicitado, previo al envío del primer pedido de saldos . EL CLIENTE y los USUARIOS asumen la obligación de consultar y conocer el funcionamiento del producto contratado mediante los materiales puestos a disposición por EDENRED a través de las  siguientes plataformas:  www.edenred.mx y www.edenredtraining.mx . Todos los monederos electrónicos y/o dispositivos tecnológicos del Sistema TC son propiedad de EDENRED, quien se reserva el derecho a sustituirlas, bloquearlas o modificar su modo de funcionamiento cuando lo considere necesario para la correcta operación del Sistema TC.</p>');
  
                          }
                          //Begin Added By Fran Rojas | HU SmartCard
                          else if ((contrato.TipoPago__c == 'Prepago' || contrato.TipoPago__c == 'Pospago') 
                              && (dataSource.Product2.ProductCode == "30" || dataSource.Product2.ProductCode == "30-TC4") 
                              && !dataSource.Contrato2__c.PrepaidTag__c && contrato.Tipo_Maquila__c == "SmartCard Business"
                          ) {
                              console.log("ENTRA 1247 CLON poara SmartCard");
                              plantilla.Contenido_del__c = plantilla.Contenido_del__c.replace(/\(TERCERA_SISTEMA\)/g, '<p> <b>\tTERCERA. SISTEMA.- </b> EDENRED entregará, en el domicilio del CLIENTE, los monederos electrónicos TicketCar Edenred - Smart Card Business y/o dispositivos tecnológicos del Sistema TC, que requiera para su operación, en un máximo de 7 (SIETE) días hábiles. Tanto el pedido como el pago deberán efectuarse a través de los medios establecidos por EDENRED. El CLIENTE asume la obligación de confirmar la recepción de los monederos electrónicos TicketCar Edenred - Smart Card Business y/o dispositivos tecnológicos que haya solicitado, previo al envío del primer pedido de saldos, usando el procedimiento descrito en el Manual de Administrador Smart Card Business TC, el cual estará a disposición del CLIENTE y de los USUARIOS a través del sitio web de EDENRED (www.edenred.mx), así como en el centro telefónico de atención a clientes 52-62-88-57. EL CLIENTE y los USUARIOS asumen la obligación de consultar y conocer el Manual de Administrador Smart Card Business TC aplicable al producto contratado, en su versión actualizada. Todos los monederos electrónicos y/o dispositivos tecnológicos del Sistema TC son propiedad de EDENRED, quien se reserva el derecho a sustituirlas, bloquearlas o modificar su modo de funcionamiento cuando lo considere necesario para la correcta operación del Sistema TC. </p>');
                          }
                          //End Added By Fran Rojas | HU SmartCard
                          else if ((contrato.TipoPago__c == 'Prepago' || contrato.TipoPago__c == 'Pospago') 
                              && dataSource.Product2.ProductCode == "30-B" 
                              && !dataSource.Contrato2__c.PrepaidTag__c
                          ) {
                              console.log("ENTRA 1250"); //30-B
                              plantilla.Contenido_del__c = plantilla.Contenido_del__c.replace(/\(TERCERA_SISTEMA\)/g, '<p><b>TERCERA. SISTEMA.- </b>EDENRED entregará, en el domicilio del CLIENTE, los monederos electrónicos y/o dispositivos tecnológicos del Sistema BPFLEET, que requiera para su operación, en un máximo de 7 (SIETE) días hábiles. Tanto el pedido como el pago deberán efectuarse a través de los medios establecidos por EDENRED. El CLIENTE asume la obligación de confirmar la recepción de los monederos electrónicos y/o dispositivos tecnológicos que haya solicitado, previo al envío del primer pedido de saldos. EL CLIENTE y los USUARIOS asumen la obligación de consultar y conocer el funcionamiento del producto contratado mediante los materiales puestos a disposición por EDENRED a través de las  siguientes plataformas:  www.edenred.mx  y  www.edenredtraining.mx . Todos los monederos electrónicos y/o dispositivos tecnológicos del Sistema BPFLEET son propiedad de EDENRED, quien se reserva el derecho a sustituirlas, bloquearlas o modificar su modo de funcionamiento cuando lo considere necesario para la correcta operación del Sistema BPFLEET.</p>');
                          }
  
                          console.log("TIPO DE GARANTÍA: ", dataSource.Contrato2__c.PartidaPresupuesto__r.WarrantyType__c);
                          $('#contentPdf').html('');
                          $('#contentPdf').append(plantilla.Contenido_del__c);
  
                          if (plantilla.Adicional__c != undefined) {
                              plantilla.Adicional__c = html(plantilla.Adicional__c, dataSource);
                              replaceConceptValues(plantilla, conceptList, conceptsListTC4, 'Adicional__c');
                              plantilla.Adicional__c = plantilla.Adicional__c.replace(/color: rgb\(112\, 110\, 107\)\;/g, '');
                              plantilla.Adicional__c = plantilla.Adicional__c.replace(new RegExp('!check', 'gi'), '<input type="checkbox" kendoCheckBox checked="true" [(ngModel)]="model.foo" />');
                              plantilla.Adicional__c = plantilla.Adicional__c.replace(/\(\!filiales\)/g, templateFiliales);
                              plantilla.Adicional__c = plantilla.Adicional__c.replace(/\(\!productosConcepto\)/g, templateConceptos);
                              plantilla.Adicional__c = plantilla.Adicional__c.replace(/\(\!nombresreplegales\)/g, nombresRepLegales);
                              plantilla.Adicional__c = plantilla.Adicional__c.replace('DIAS_DE_CREDITO', creditDays);
                              plantilla.Adicional__c = plantilla.Adicional__c.replace(/\(SALTAR PAGINA\)/g, '<div class="page-break"></div>');
                              plantilla.Adicional__c = plantilla.Adicional__c.replace(/\(CIUDAD_ESTADO\)/g, ''+dataSource.Account.BillingAddress.city+', '+dataSource.Account.BillingPostalCode);
                              plantilla.Adicional__c = plantilla.Adicional__c.replace(/\(TIPO_DE_GARANTIA\)/g, ''+dataSource.Contrato2__c.PartidaPresupuesto__r.WarrantyType__c);
                              plantilla.Adicional__c = plantilla.Adicional__c.replace(/\(MONTO_EN_GARANTIA\)/g, ''+dataSource.Contrato2__c.PartidaPresupuesto__r.WarrantyValue__c);
                              plantilla.Adicional__c = plantilla.Adicional__c.replace(/\(MONTO_EN_LETRA\)/g, ''+numeroALetras(dataSource.Contrato2__c.Linea_Operativa__c, {plural: 'PESOS', singular: 'PESO', centPlural: 'CENTAVOS', centSingular: 'CENTAVO'})+ ' MXN');
                              plantilla.Adicional__c = plantilla.Adicional__c.replace(/\(CONDICIONES_PAGO_PLAZO\)/g, ''+dataSource.Contrato2__c.CondicionesPagoPlazo__c);
                              plantilla.Adicional__c = replaceStr(plantilla.Adicional__c, dataSource);
                              plantilla.Adicional__c = replaceTextRespLegales(plantilla.Adicional__c, cantidadRepLegales, templateDatosRepLegales, templateRepLegalesFirma);
                              $('#contentPdf').append(plantilla.Adicional__c);
                          }
  
                          if (plantilla.AnexoA__c != undefined) {
                              console.log("ANEXOA!::");
                              plantilla.AnexoA__c = html(plantilla.AnexoA__c, dataSource);
                              plantilla.AnexoA__c = replaceTextRespLegales(plantilla.AnexoA__c, cantidadRepLegales, templateDatosRepLegales, templateRepLegalesFirma);
                              plantilla.AnexoA__c = plantilla.AnexoA__c.replace(new RegExp('!check', 'gi'), '<input type="checkbox" kendoCheckBox checked="true" [(ngModel)]="model.foo" />');
                              plantilla.AnexoA__c = plantilla.AnexoA__c.replace(/\(\!filiales\)/g, templateFiliales);
                              plantilla.AnexoA__c = plantilla.AnexoA__c.replace(/\(\!productosConcepto\)/g, templateConceptos);
                              //plantilla.AnexoA__c = plantilla.AnexoA__c.replace('<table class="ql-table-blob">', '<table class="tableFilial">');
                              plantilla.AnexoA__c = plantilla.AnexoA__c.replace(/color: rgb\(112\, 110\, 107\)\;/g, '');
                              plantilla.AnexoA__c = plantilla.AnexoA__c.replace(/\(SALTAR PAGINA\)/g, '<div class="page-break"></div>'); //6193 - 6207
  
                              /*6207*/
                              /*if((dataSource.Product2.ProductCode == "32-CH" || dataSource.Product2.ProductCode == "32" || dataSource.Product2.ProductCode == "32-W" || dataSource.Product2.ProductCode == "48-CH" || dataSource.Product2.ProductCode == "57") && dataSource.Contrato2__c.PaymentMethod__c == "American Express"){
                                  //$('#contentPdf').append('<div class="page-break"></div>' + plantilla.AnexoA__c + '<div class="page-break"></div>' + '<p style="text-align: left;"><b>FORMATO CARGOS A TARJETAS AMERICAN EXPRESS</b></p> <p></p> <p style="text-align: left;">Anexo al Contrato de prestación de servicios de fecha '+dataSource.dia+'  de '+dataSource.mes+' de '+dataSource.anio+', en lo sucesivo el “CONTRATO” celebrado entre EDENRED MÉXICO, S.A. DE C.V., en lo sucesivo “EDENRED” y la empresa denominada '+dataSource.EntidadLegal__c.RazonSocial__c+', en lo sucesivo el “CLIENTE”.</p> <p style="text-align: left;">Realizar cargos a la tarjeta American Express del “CLIENTE” para pagos de diversos conceptos para la operación del “Sistema Vale Despensa Edenred Chedraui”. Dichos cargos pueden realizarse de alguna de las siguientes formas:</p> <p style="text-align: left;">Realizar cargos a la tarjeta American Express del “CLIENTE” para pagos de diversos conceptos para la operación del “Sistema Vale Despensa Edenred Chedraui”. Dichos cargos pueden realizarse de alguna de las siguientes formas:</p> <p style="text-align: left;">De forma telefónica por evento<br> Vía el portal para el “CLIENTE” del “Sistema”. </p> <p style="text-align: left;"> Los datos de la (s) Tarjeta (s) American Express del “CLIENTE” a la (s) que se autoriza realizar los cargos son los siguientes: </p> <p>Número (s) de tarjeta (s):'+dataSource.Contrato2__c.CardNumber_AMEX__c+' <br>(sólo colocar los últimos números)</p> <p> </p> <p>Nombre de titular: '+dataSource.Contrato2__c.CardHoldersName_AMEX__c+' </p> <p> </p> <p> El “CLIENTE” conviene y acepta que, al seleccionar la forma de pago mediante Tarjetas American Express, la contraprestación señalada en la cláusula SEXTA. - CONDICIONES COMERCIALES del contrato, que deberá pagar será de ' +dataSource.Contrato2__c.PartidaPresupuesto__r.Quote.Comision_por_Servicio__c+' % + IVA. Comisión mínima 3 Unidades de Medida y Actualización (“UMAs”). </p> <p> El “CLIENTE” conviene y acepta que, “EDENRED” queda liberado de toda responsabilidad si American Express ejerce cualquier acción contra el “CLIENTE”, derivados de la Ley o el contrato que tengan celebrado, y que “EDENRED” no estará obligado a efectuar ninguna reclamación a American Express, ni a interponer recursos de ningún tipo contra multas, sanciones o cobros indebidos, todo lo cual, en caso de ser necesario, será efectuado bajo la responsabilidad y cargo del propio “CLIENTE”. </p> <p> “EDENRED” tendrá absoluta libertad de negar, y sin responsabilidad alguna, el servicio al “CLIENTE” si American Express no autoriza (tarjeta bloqueada, o se declina por límite de crédito insuficiente, o por algún otro motivo) uno o más de los pagos que el “CLIENTE” requiera hacer a “EDENRED” para uso del “Sistema Vale Despensa Edenred Chedraui&quot;.</p> <p style="text-align: justify;"><br></p> <p style="text-align: justify;"><br></p> <p style="text-align: justify;"><br></p> <p style="text-align: justify;"><br></p> <p style="text-align: justify;"><br></p> <table class="ql-table-blob" border="0" style="white-space: pre-wrap; color: rgb(112, 110, 107);" width="100%"><tbody><tr height="21"><td align="center" colspan="1" rowspan="1" valign="top" width="50%" height="100">Edenred</td><td align="center" colspan="1" rowspan="1" valign="top" width="50%" height="100">El Cliente</td></tr><tr><td align="center" colspan="1" rowspan="1" width="50%">________________________________________</td><td align="center" colspan="1" rowspan="1" width="50%">________________________________________</td></tr><tr height="21"><td align="center" colspan="1" rowspan="1" width="50%" height="21">'+dataSource.Opportunity.Owner.Manager.Name+' </td><td align="center" colspan="1" rowspan="1" width="50%" height="21">'+dataSource.Contrato2__c.Contacto__r.Name+'</td></tr><tr height="21"><td align="center" colspan="1" rowspan="1" width="50%">Por: Edenred México, S.A de C.V.</td><td align="center" colspan="1" rowspan="1" width="50%">Por: '+dataSource.EntidadLegal__c.RazonSocial__c+'</td></tr></tbody></table>');
                              }else{
                                  $('#contentPdf').append('<div class="page-break"></div>' + plantilla.AnexoA__c);
                              }*/
                              $('#contentPdf').append('<div class="page-break"></div>' + plantilla.AnexoA__c); //6207
  
                          }
                          if(plantilla.AnexoB__c != undefined && dataSource.Product2.ProductCode == '60-t') {
                              console.log('CB #1');
                              replaceConceptValues(plantilla, conceptList, conceptsListTC4, 'AnexoB__c');
                          }
                          if (plantilla.AnexoB__c != undefined 
                              && ((dataSource.Product2.ProductCode != "des-AF" && dataSource.Product2.ProductCode != "des-AF-OPAM") 
                                  || (contrato.IsPaper__c && (dataSource.Product2.ProductCode == "des-AF" 
                                      || dataSource.Product2.ProductCode != "des-AF-OPAM"))) 
                              && (dataSource.Product2.ProductCode != "multip-AF" 
                                  || (contrato.IsPaper__c && dataSource.Product2.ProductCode == "multip-AF")) 
                              && (dataSource.Product2.ProductCode != "ince-AF") 
                              && (dataSource.Product2.ProductCode != "com-AF" 
                                  || (contrato.IsPaper__c && dataSource.Product2.ProductCode == "com-AF")) 
                              && (dataSource.Product2.ProductCode != "vest-AF") 
                              && (dataSource.Product2.ProductCode != "ayudaS-AF" 
                                  || (contrato.IsPaper__c && dataSource.Product2.ProductCode == "ayudaS-AF"))
                          ) {
                              plantilla.AnexoB__c = html(plantilla.AnexoB__c, dataSource);
                              plantilla.AnexoB__c = replaceTextRespLegales(plantilla.AnexoB__c, cantidadRepLegales, templateDatosRepLegales, templateRepLegalesFirma);
                              plantilla.AnexoB__c = plantilla.AnexoB__c.replace(/\(SALTAR PAGINA\)/g, '<div class="page-break"></div>');
                              plantilla.AnexoB__c = plantilla.AnexoB__c.replace(/\(\!filiales\)/g, templateFiliales);
                              plantilla.AnexoB__c = plantilla.AnexoB__c.replace(/\(\!productosConcepto\)/g, templateConceptos);
                              //plantilla.AnexoB__c = plantilla.AnexoB__c.replace('<table class="ql-table-blob">', '<table class="tableFilial">');
                              plantilla.AnexoB__c = plantilla.AnexoB__c.replace(/color: rgb\(112\, 110\, 107\)\;/g, '');
                              $('#contentPdf').append('<div class="page-break"></div>' + plantilla.AnexoB__c);
                          }
                          if (plantilla.AnexoC__c != undefined 
                              && ((dataSource.Product2.ProductCode != "des-AF" && dataSource.Product2.ProductCode != "des-AF-OPAM") 
                                  || (contrato.Domiciliation__c && (dataSource.Product2.ProductCode == "des-AF" 
                                  || dataSource.Product2.ProductCode != "des-AF-OPAM"))) 
                              && (dataSource.Product2.ProductCode != "multip-AF" 
                                  || (contrato.Domiciliation__c && dataSource.Product2.ProductCode == "multip-AF")) 
                              && (dataSource.Product2.ProductCode != "ince-AF" 
                                  || (contrato.Domiciliation__c && dataSource.Product2.ProductCode == "ince-AF")) 
                              && (dataSource.Product2.ProductCode != "com-AF" 
                                  || (contrato.Domiciliation__c && dataSource.Product2.ProductCode == "com-AF")) 
                              && (dataSource.Product2.ProductCode != "vest-AF" 
                                  || (contrato.Domiciliation__c && dataSource.Product2.ProductCode == "vest-AF")) 
                              && (dataSource.Product2.ProductCode != "ayudaS-AF" 
                                  || (contrato.Domiciliation__c && dataSource.Product2.ProductCode == "ayudaS-AF"))
                          ) {
                              plantilla.AnexoC__c = html(plantilla.AnexoC__c, dataSource);
                              plantilla.AnexoC__c = replaceTextRespLegales(plantilla.AnexoC__c, cantidadRepLegales, templateDatosRepLegales, templateRepLegalesFirma);
                              plantilla.AnexoC__c = plantilla.AnexoC__c.replace(/\(\!filiales\)/g, templateFiliales);
                              plantilla.AnexoC__c = plantilla.AnexoC__c.replace(/\(\!productosConcepto\)/g, templateConceptos);
                              plantilla.AnexoC__c = plantilla.AnexoC__c.replace(/color: rgb\(112\, 110\, 107\)\;/g, '');
  
                              if(dataSource.Product2.ProductCode == "18"  && dataSource.Contrato2__c.PaymentMethod__c == 'American Express') {
                                  $('#contentPdf').append('<div class="page-break"></div>' + plantilla.AnexoC__c + '<div class="page-break"></div>' + '<p style="text-align: center"><b>ANEXO "C"</b></p><p style="text-align: left;"><b>FORMATO CARGOS A TARJETAS AMERICAN EXPRESS</b></p> <p></p> <p style="text-align: left;">Anexo al Contrato de prestación de servicios de fecha '+dataSource.dia+'  de '+dataSource.mes+' de '+dataSource.anio+', en lo sucesivo el “CONTRATO” celebrado entre EDENRED MÉXICO, S.A. DE C.V., en lo sucesivo “EDENRED” y la empresa denominada '+dataSource.EntidadLegal__c.RazonSocial__c+ ' ' + dataSource.EntidadLegal__c.TipoSociedad_PL__c +', en lo sucesivo el “CLIENTE”.</p> <p style="text-align: left;">Realizar cargos a la tarjeta American Express del “CLIENTE” para pagos de diversos conceptos para la operación del “Sistema Vale Despensa Edenred Chedraui”. Dichos cargos pueden realizarse de alguna de las siguientes formas:</p> <p style="text-align: left;">Realizar cargos a la tarjeta American Express del “CLIENTE” para pagos de diversos conceptos para la operación del “Sistema Vale Despensa Edenred Chedraui”. Dichos cargos pueden realizarse de alguna de las siguientes formas:</p> <p style="text-align: left;">De forma telefónica por evento<br> Vía el portal para el “CLIENTE” del “Sistema”. </p> <p style="text-align: left;"> Los datos de la (s) Tarjeta (s) American Express del “CLIENTE” a la (s) que se autoriza realizar los cargos son los siguientes: </p> <p>Número (s) de tarjeta (s):'+dataSource.Contrato2__c.CardNumber_AMEX__c+' <br>(sólo colocar los últimos números)</p> <p> </p> <p>Nombre de titular: '+dataSource.Contrato2__c.CardHoldersName_AMEX__c+' </p> <p> </p> <p> El “CLIENTE” conviene y acepta que, al seleccionar la forma de pago mediante Tarjetas American Express, la contraprestación señalada en la cláusula SEXTA. - CONDICIONES COMERCIALES del contrato, que deberá pagar será de '+dataSource.Contrato2__c.PartidaPresupuesto__r.Quote.Comision_por_Servicio__c+' % + IVA. Comisión mínima 3 Unidades de Medida y Actualización (“UMAs”). </p> <p> El “CLIENTE” conviene y acepta que, “EDENRED” queda liberado de toda responsabilidad si American Express ejerce cualquier acción contra el “CLIENTE”, derivados de la Ley o el contrato que tengan celebrado, y que “EDENRED” no estará obligado a efectuar ninguna reclamación a American Express, ni a interponer recursos de ningún tipo contra multas, sanciones o cobros indebidos, todo lo cual, en caso de ser necesario, será efectuado bajo la responsabilidad y cargo del propio “CLIENTE”. </p> <p> “EDENRED” tendrá absoluta libertad de negar, y sin responsabilidad alguna, el servicio al “CLIENTE” si American Express no autoriza (tarjeta bloqueada, o se declina por límite de crédito insuficiente, o por algún otro motivo) uno o más de los pagos que el “CLIENTE” requiera hacer a “EDENRED” para uso del “Sistema Vale Despensa Edenred Chedraui&quot;.</p> <p style="text-align: justify;"><br></p> <p style="text-align: justify;"><br></p> <p style="text-align: justify;"><br></p> <p style="text-align: justify;"><br></p> <p style="text-align: justify;"><br></p> <table class="ql-table-blob" border="0" style="white-space: pre-wrap; color: rgb(112, 110, 107);" width="100%"><tbody><tr height="21"><td align="center" colspan="1" rowspan="1" valign="top" width="50%" height="100">Edenred</td><td align="center" colspan="1" rowspan="1" valign="top" width="50%" height="100">El Cliente</td></tr><tr><td align="center" colspan="1" rowspan="1" width="50%">________________________________________</td><td align="center" colspan="1" rowspan="1" width="50%">________________________________________</td></tr><tr height="21"><td align="center" colspan="1" rowspan="1" width="50%" height="21">'+dataSource.Opportunity.Owner.Manager.Name+' </td><td align="center" colspan="1" rowspan="1" width="50%" height="21">'+dataSource.Contrato2__c.Contacto__r.Name+'</td></tr><tr height="21"><td align="center" colspan="1" rowspan="1" width="50%">Por: Edenred México, S.A de C.V.</td><td align="center" colspan="1" rowspan="1" width="50%">Por: '+dataSource.EntidadLegal__c.RazonSocial__c+ ' ' + dataSource.EntidadLegal__c.TipoSociedad_PL__c +'</td></tr></tbody></table>');
                              } else if ((dataSource.Product2.ProductCode == "58" || dataSource.Product2.ProductCode == '41' 
                                  || dataSource.Product2.ProductCode == '61' 
                                  || dataSource.Product2.ProductCode == '71' 
                                  || dataSource.Product2.ProductCode == '81' 
                                  || dataSource.Product2.ProductCode == "34") 
                                  && dataSource.Contrato2__c.PaymentMethod__c == "American Express"
                              ) {
                                  dataSource.Contrato2__c.CardNumber_AMEX__c = '';
                                  dataSource.Contrato2__c.CardHoldersName_AMEX__c = '';
                                  $('#contentPdf').append('<div class="page-break"></div>' + plantilla.AnexoC__c + '<p style="text-align: center;"><b>ANEXO “C”</b></p><p style="text-align: center;"><b>CARGOS A TARJETAS AMERICAN EXPRESS SISTEMA TICKETS</b></p><p style="text-align: center;"><b>EXCEPTO MODALIDAD RED MÁXIMA (CARNET O MASTERCARD)</b></p><p>Anexo “C” al Contrato de prestación de servicios de fecha '+dataSource.dia+' del '+dataSource.mes+' de '+dataSource.anio+', en lo sucesivo el “CONTRATO” celebrado entre EDENRED MÉXICO, S.A. DE C.V., en lo sucesivo “EDENRED” y la empresa denominada '+dataSource.EntidadLegal__c.RazonSocial__c+ ' ' + dataSource.EntidadLegal__c.TipoSociedad_PL__c +', en lo sucesivo el “CLIENTE”.</p><p>Para efectos del presente “CONTRATO”, el “CLIENTE” gestionará su pago de facturas pendientes mediante cualquiera de las modalidades de pago que arroja el sistema y que podrá seleccionar a su discreción. Adicionalmente, podrá hacerlo a través de la Tarjeta American Express, por lo que a estos efectos, autoriza a “EDENRED” lo siguiente:</p><p>Realizar cargos a la tarjeta American Express del “CLIENTE” para pagos de diversos conceptos para la operación de los “Sistemas Ticket” (excepto modalidad RED MÁXIMA). Dichos cargos pueden realizarse de alguna de las siguientes formas:</p><p>De forma telefónica por evento</p><p>Vía el portal para el “CLIENTE” del “Sistema Tickets”.</p><p>Los datos de la (s) Tarjeta (s) American Express del “CLIENTE” a la (s) que se autoriza realizar los cargos son los siguientes:</p><p>Número (s) de tarjeta (s): '+dataSource.Contrato2__c.CardNumber_AMEX__c+'</p><p>(sólo colocar los últimos números)</p><p>Nombre de titular: '+dataSource.Contrato2__c.CardHoldersName_AMEX__c+'</p><p>El “CLIENTE” conviene y acepta que al seleccionar la forma de pago mediante Tarjetas American Express, la contraprestación marcada en el Anexo “A” de las condiciones comerciales que deberá pagar será de _____% + IVA. Comisión mínima 3 Unidades de Medida y Actualización (“UMAs”).</p><p>El “CLIENTE” conviene y acepta que, “EDENRED” queda liberado de toda responsabilidad si American Express ejerce cualquier acción contra el “CLIENTE”, derivados de la Ley o el contrato que tengan celebrado, y que “EDENRED” no estará obligado a efectuar ninguna reclamación a American Express, ni a interponer recursos de ningún tipo contra multas, sanciones o cobros indebidos, todo lo cual, en caso de ser necesario, será efectuado bajo la responsabilidad y cargo del propio “CLIENTE”.</p><p>“EDENRED” tendrá absoluta libertad de negar, y sin responsabilidad alguna, el servicio al “CLIENTE” si American Express no autoriza (tarjeta bloqueada, o se declina por límite de crédito insuficiente, o por algún otro motivo) uno o más de los pagos que el “CLIENTE” requiera hacer a “EDENRED” para uso del “Sistema Ticket”.</p><p/><table class="ql-table-blob" border="0" style="white-space: pre-wrap;" width="100%"><tbody><tr height="21"><td align="center" colspan="1" rowspan="1" valign="top" width="100%" height="100">EL CLIENTE</td></tr></tbody></table>'+templateRepLegalesFirma +'<br><br><br><br><table class="ql-table-blob" border="0" style="white-space: pre-wrap;" width="100%"><tbody><tr height="21"><td align="center" colspan="1" rowspan="1" valign="top" width="100%" height="100">EDENRED</td></tr><tr><td align="center" colspan="1" rowspan="1" style="color: #ffffff;" width="100%" height="21">\s1\</td></tr><tr><td align="center" colspan="1" rowspan="1" width="100%">________________________________________</td></tr><tr height="21"><td align="center" colspan="1" rowspan="1" width="100%" height="21">'+dataSource.Contrato2__c.Edenred_Representative__r.Name+'</td></tr><tr height="21"><td align="center" colspan="1" rowspan="1" width="100%">Por: Edenred México, S.A de C.V.</td></tr></tbody></table>');
                              } else {
                                  $('#contentPdf').append('<div class="page-break"></div>' + plantilla.AnexoC__c);
                              }
                          }
  
                          if (plantilla.AnexoD__c != undefined && dataSource.FormaPago__c == 'American Express' 
                              || (dataSource.Product2.ProductCode == "TC-AF" || dataSource.Product2.ProductCode == "G500-AF" 
                                  || dataSource.Product2.ProductCode == "BP-AF")
                          ) {
                              plantilla.AnexoD__c = html(plantilla.AnexoD__c, dataSource);
                              plantilla.AnexoD__c = replaceTextRespLegales(plantilla.AnexoD__c, cantidadRepLegales, templateDatosRepLegales, templateRepLegalesFirma);
                              plantilla.AnexoD__c = plantilla.AnexoD__c.replace(/\(\!filiales\)/g, templateFiliales);
                              //plantilla.AnexoD__c = plantilla.AnexoD__c.replace(/\(\!productosConcepto\)/g, templateConceptos);
                              plantilla.AnexoD__c = plantilla.AnexoD__c.replace(/color: rgb\(112\, 110\, 107\)\;/g, '');
                              plantilla.AnexoD__c = plantilla.AnexoD__c.replace(/\(\!comisionPorServicio\)/g, +dataSource.Contrato2__c.PartidaPresupuesto__r.Quote.Comision_por_Servicio__c);
                              plantilla.AnexoD__c = plantilla.AnexoD__c.replace(/\(\!TAMEX\)/g, +dataSource.Contrato2__c.CardNumber_AMEX__c);
  
                              $('#contentPdf').append('<div class="page-break"></div>' + plantilla.AnexoD__c);
                          }
  
                          if (plantilla.AnexoE__c != undefined) {
                              plantilla.AnexoE__c = html(plantilla.AnexoE__c, dataSource);
                              plantilla.AnexoE__c = replaceTextRespLegales(plantilla.AnexoE__c, cantidadRepLegales, templateDatosRepLegales, templateRepLegalesFirma);
                              plantilla.AnexoE__c = plantilla.AnexoE__c.replace(/\(\!filiales\)/g, templateFiliales);
                              plantilla.AnexoE__c = plantilla.AnexoE__c.replace(/\(\!productosConcepto\)/g, templateConceptos);
                              plantilla.AnexoE__c = plantilla.AnexoE__c.replace(/\(\!saltoPagina\)/g, '<div class="page-break"></div>');
                              plantilla.AnexoE__c = plantilla.AnexoE__c.replace(/color: rgb\(112\, 110\, 107\)\;/g, '');
                              $('#contentPdf').append('<div class="page-break"></div>' + plantilla.AnexoE__c);
                          }
  
                          if (plantilla.AdditionalAnnexVP__c != undefined 
                              && (contrato.IsPaper__c && dataSource.Product2.ProductCode == "TC-AF" || contrato.IsPaper__c 
                                  && dataSource.Product2.ProductCode == "G500-AF" 
                                  || contrato.IsPaper__c 
                                  && dataSource.Product2.ProductCode == "BP-AF")
                          ) {
                              plantilla.AdditionalAnnexVP__c = html(plantilla.AdditionalAnnexVP__c, dataSource);
                              plantilla.AdditionalAnnexVP__c = replaceTextRespLegales(plantilla.AdditionalAnnexVP__c, cantidadRepLegales, templateDatosRepLegales, templateRepLegalesFirma);
                              plantilla.AdditionalAnnexVP__c = plantilla.AdditionalAnnexVP__c.replace(/\(\!filiales\)/g, templateFiliales);
                              plantilla.AdditionalAnnexVP__c = plantilla.AdditionalAnnexVP__c.replace(/\(\!productosConcepto\)/g, templateConceptos);
                              plantilla.AdditionalAnnexVP__c = plantilla.AdditionalAnnexVP__c.replace(/color: rgb\(112\, 110\, 107\)\;/g, '');
                              $('#contentPdf').append('<div class="page-break"></div>' + plantilla.AdditionalAnnexVP__c);
                          }
  
                          if (plantilla.Carta_terminos__c != undefined ) {
                              console.log('Condiciones para Carta_terminos__c son verdaderas.'); 
                              console.log('Condiciones para Carta_terminos__c son verdaderas.');
                              plantilla.Carta_terminos__c = html(plantilla.Carta_terminos__c, dataSource);
                              plantilla.Carta_terminos__c = plantilla.Carta_terminos__c.replace(/color: rgb\(112\, 110\, 107\)\;/g, '');
                              plantilla.Carta_terminos__c= plantilla.Carta_terminos__c.replace(/\(\!nombresreplegales\)/g, nombresRepLegales);
                              plantilla.Carta_terminos__c = plantilla.Carta_terminos__c.replace(/\(SALTAR PAGINA\)/g, '<div class="page-break"></div>');
  
                              if((dataSource.Opportunity?.Contrato_Filial__r?.Producto__r?.ProductCode === "52-C" 
                                      ||dataSource.Opportunity?.Contrato_Filial__r?.Producto__r?.ProductCode === "52" 
                                      || dataSource.Opportunity?.Contrato_Filial__r?.Producto__r?.ProductCode === "62-C"
                                      || dataSource.Opportunity?.Contrato_Filial__r?.Producto__r?.ProductCode === "62" 
                                      ||  dataSource.Opportunity?.Contrato_Filial__r?.Producto__r?.ProductCode === "69-C" 
                                      || dataSource.Opportunity?.Contrato_Filial__r?.Producto__r?.ProductCode === "69") 
                                  && (dataSource.Opportunity?.Codigo_Producto_cotizacion__c === "95" 
                                      ||dataSource.Opportunity?.Codigo_Producto_cotizacion__c === "96") 
                                  && dataSource.Opportunity?.RecordType?.DeveloperName === 'Migracion'
                              ) {
                                  plantilla.Carta_terminos__c = replaceStr(plantilla.Carta_terminos__c, dataSource);
                                  logoHeader = ' <img class="logoEdenred2"  src="{!URLFOR($Resource.CotizacionesPDF, "/Encabezados/EcoVale.png")}" ';
                                  $('#contentPdf').append('<div class="page-break"></div>' + logoHeader  +'<br>' + plantilla.Carta_terminos__c );
                              }
                          }
  
                          if (dataSource.Opportunity.Maquilas__c == undefined && plantilla.AdditionalAnnexME__c != undefined 
                              && (dataSource.Product2.ProductCode == "G500-AF" || dataSource.Product2.ProductCode == "BP-AF")
                          ) {
                              plantilla.AdditionalAnnexME__c = html(plantilla.AdditionalAnnexME__c, dataSource);
                              plantilla.AdditionalAnnexME__c = replaceTextRespLegales(plantilla.AdditionalAnnexME__c, cantidadRepLegales, templateDatosRepLegales, templateRepLegalesFirma);
                              plantilla.AdditionalAnnexME__c = plantilla.AdditionalAnnexME__c.replace(/\(\!filiales\)/g, templateFiliales);
                              plantilla.AdditionalAnnexME__c = plantilla.AdditionalAnnexME__c.replace(/\(\!productosConcepto\)/g, templateConceptos);
                              plantilla.AdditionalAnnexME__c = plantilla.AdditionalAnnexME__c.replace(/color: rgb\(112\, 110\, 107\)\;/g, '');
                              $('#contentPdf').append('<div class="page-break"></div>' + plantilla.AdditionalAnnexME__c);
  
                          } else if (dataSource.Opportunity.Maquilas__c) {
                              for (let tm in maquilaTempleate) {
                                  let maquilaTemp = maquilaTempleate[tm];
                                  if(maquilaTemp && maquilaTemp.AdditionalAnnexME__c){
                                      maquilaTemp.AdditionalAnnexME__c = html(maquilaTemp.AdditionalAnnexME__c, dataSource);
                                      maquilaTemp.AdditionalAnnexME__c = replaceTextRespLegales(maquilaTemp.AdditionalAnnexME__c, cantidadRepLegales, templateDatosRepLegales, templateRepLegalesFirma);
                                      maquilaTemp.AdditionalAnnexME__c = maquilaTemp.AdditionalAnnexME__c.replace(/\(\!filiales\)/g, templateFiliales);
                                      maquilaTemp.AdditionalAnnexME__c = maquilaTemp.AdditionalAnnexME__c.replace(/\(\!productosConcepto\)/g, templateConceptos);
                                      maquilaTemp.AdditionalAnnexME__c = maquilaTemp.AdditionalAnnexME__c.replace(/color: rgb\(112\, 110\, 107\)\;/g, '');
                                      $('#contentPdf').append('<div class="page-break"></div>' + maquilaTemp.AdditionalAnnexME__c);
                                  }
                              }
                          }
                          setDisplayAttribute(plantilla, conceptList);
                          console.log('setDisplayAttribute Done');
                          var logo;
                          console.log('plantilla.Logocontrato__c',plantilla.Logocontrato__c);
                          console.log('dataSource.Product2.ProductCode ', dataSource.Product2.ProductCode);
                          if (plantilla.Logocontrato__c == undefined || plantilla.Logocontrato__c == null) {
                              logo = '    <div class = "logoTC"></div>';
                          } else if (dataSource.Product2.ProductCode != "32-W" && dataSource.Product2.ProductCode != "60-t"){ //6207
                              logo = '    <img class = "logoTC" src="{!URLFOR($Resource.CotizacionesPDF, "/Encabezados/' + plantilla.Logocontrato__c + '")}" />';
                          } else if (dataSource.Product2.ProductCode == "60-t") {
                              logo = '    <img class = "logoOPAM2" src="{!URLFOR($Resource.CotizacionesPDF, "/Encabezados/' + plantilla.Logocontrato__c + '")}" />';
                          } else {
                              logo = '';
                          }
                          if (subHeader && subHeader.length > 0) {
                              logo += '<div class = "logoTC2">' + subHeader + '</div>'
                          }
  
                          var templateHtml = '<div class="page-template">' +
                              '<div class="header">' +
                              '   <img class = "logoEdenred" src="{!URLFOR($Resource.CotizacionesPDF, "/Encabezados/' + logoHeader + '")}" />' +
                              logo + leyendaHeader
                          //'   <div class="headerText"><p>FECHA DE ACTUALIZACIÓN 19/08/16</p>CONTRATO CLIENTES EDENRED TC PAGO POR CONSUMO JUR<p></p></div>'+
                          //          '   <div class="headerText2"><p>DTCOM-001-04</p></div> ' +
                          '</div>';
                          
                          if(nombreProductoOriginal == "Mantenimiento Fleet Edenred + Américas"){
                              //templateHtml += ' <div class="page-templatef"><div class="footer"> PRUEBA FOOTER</div></div>';
                          }
  
                          console.log('logo',logo);
                          console.log('templateHtml ', templateHtml);
                          console.log('leyenda header: ' , leyendaHeader);
  
                          console.log('contrato.EtapaContrato__c',contrato.EtapaContrato__c);
                          var waterMark = false
                          if (contrato.EtapaContrato__c != undefined && contrato.EtapaContrato__c == 'Finalizado') {
                              waterMark = false;
                          } else {
                              waterMark = false;          //Se quita la marca de agua.
                          }
  
                          if (waterMark) {
                              templateHtml += '<div class="watermark">Borrador</div>';
                          } else {
                              templateHtml += '</div>';
                          }
  
                          if (templateHtml != '') {
                              kendo.drawing.drawDOM($('#pdfTemplate'), {
                                  paperSize: "A4",
                                  margin: { left: "1cm", top: top, right: "1cm", bottom: "1.5cm" },
                                  forcePageBreak: ".page-break",
                                  keepTogether: ".prevent-split",
                                  multiPage: true,
                                  template: templateHtml,
                                  scale: 0.8
                              })
                                  .then(function (group) {
                                      kendo.drawing.pdf.toDataURL(group, function (a) {
                                          var data = a.replace('data:application/pdf;base64,', '')
                                          var url = "";
                                          Visualforce.remoting.Manager.invokeAction('{!$RemoteAction.CON_ContractsContainer_CTRL.guardaPDFBase64}', '{!QuoteLineItem.Id}', data, function (result, event) {
                                              console.log('PdfGuardado', result);
                                              hidePDFSpinner();
                                              url = '/servlet/servlet.FileDownload?file=' + result.Upsert_Attachment.Id + '#view=FitH';
                                              window.open(url)
                                          });
                                      });
                                      return kendo.drawing.exportPDF(group, {});
                                  }).done(function (data) {
                                      console.debug('TERMINADO');
                                  });
  
                          }
                      })
                      .catch(function (err) {
                          console.log("ctcLightning error: ", err);
                          var toast = $A.get('e.force:showToast')
                          toast.setParams({ type: 'error', message: err.message })
                          toast.fire()
                          hidePDFSpinner();
                      })
              }
          })(window)
  
          function getExpresiones(html) {
              var ret = {};
              html.split('\{\!').forEach(function (token, index) {
                  if (token.indexOf('}') != - 1) {
                      ret[token.substr(0, token.indexOf('}'))] = ''
                  }
              })
              return ret;
          }
  
          function replaceTextRespLegales(text, cantidadResp, templateDatosRepLegales, templateRepLegalesFirma) {
              if (cantidadResp > 1) {
                  text = text.replaceAll('Representante Legal', 'representantes legales');
                  text = text.replaceAll('representante legal', 'representantes legales');
                  text = text.replaceAll('representantes legales tiene', 'representantes legales tienen');
                  text = text.replaceAll('su representantes legales', 'sus representantes legales');
                  text = text.replaceAll('del representantes legales', 'de los representantes legales');
                  text = text.replaceAll('REPRESENTANTE LEGAL', 'REPRESENTANTES LEGALES');
              }
              text = text.replace(/\(\!datosreplegales\)/g, templateDatosRepLegales);
              text = text.replace(/\(\!firmareplegales\)/g, templateRepLegalesFirma);
              return text;
          }
  
          function replaceConceptValues(plantilla, concepts, conceptsListTC4, field, meses) {
              concepts.forEach(function (concepto) {
  
                  if (conceptsListTC4[concepto.Concepto_Tipo_Cargo__c]) {
                      console.log('CB #3 >>> ', conceptsListTC4[concepto.Concepto_Tipo_Cargo__c]);
                      if (concepto.Concepto_Tipo_Cargo__c == 'Comisión por el servicio' 
                          || concepto.Concepto_Tipo_Cargo__c == 'Comisión por servicio piloto' 
                          || concepto.Concepto_Tipo_Cargo__c.includes('adscripción')
                          || concepto.Concepto_Tipo_Cargo__c == 'Comisión por Servicio Telepeaje' 
                          || concepto.Concepto_Tipo_Cargo__c == 'TAG Telepeaje'
                      ) {
                          conceptsListTC4[concepto.Concepto_Tipo_Cargo__c].PrecioFinal__c = concepto.PrecioFinal__c ? concepto.PrecioFinal__c : '0';
                      } else if ((concepto.Concepto_Tipo_Cargo__c == 'TAG Ticket Car' 
                              || concepto.Concepto_Tipo_Cargo__c == 'Cuota por renta mensual TAG') 
                          && (plantilla.Name == 'Contrato Clientes Edenred TC4 Básico Pago por Pedido editable' 
                              || plantilla.Name == 'Contrato Clientes Edenred TC4 Básico Pago por Consumo Editable' 
                              || plantilla.Name == 'Contrato PILOTO Clientes Edenred TC4 Pedido' 
                              || plantilla.Name == 'Contrato PILOTO Clientes Edenred TC4 Consumo' 
                              || plantilla.Name == 'Contrato Clientes Edenred TC4 Pago por Pedido editable')
                      ) {
                          conceptsListTC4[concepto.Concepto_Tipo_Cargo__c].PrecioFinal__c = concepto.PrecioLista__c? concepto.PrecioLista__c : '0';
                      } else {
                          conceptsListTC4[concepto.Concepto_Tipo_Cargo__c].PrecioFinal__c = concepto.PrecioFinal__c ? concepto.PrecioFinal__c : '0';
                      }
                      conceptsListTC4[concepto.Concepto_Tipo_Cargo__c].Bonificacion__c = concepto.Bonificacion__c ? concepto.Bonificacion__c : '';
                      let vig = '';
                      if (concepto.VigenciaDescuento__c) {
                          let dateV = new Date(concepto.VigenciaDescuento__c);
                          let dia = dateV.getUTCDate().toString().length > 1 ? dateV.getUTCDate() + '' : '0' + dateV.getUTCDate();
                          let mes = (dateV.getUTCMonth() + 1).toString().length > 1 ? (dateV.getUTCMonth() + 1) + '' : '0' + (dateV.getUTCMonth() + 1);
                          vig = dia + '-' + mes + '-' + dateV.getUTCFullYear();
                      }
                      conceptsListTC4[concepto.Concepto_Tipo_Cargo__c].VigenciaDescuento__c = vig;
                      conceptsListTC4[concepto.Concepto_Tipo_Cargo__c].Concepto_Tipo_Cargo__c = concepto.Concepto_Tipo_Cargo__c;
                  }
              });
              replaceConceptsInHtml(plantilla, conceptsListTC4, field);
          }
  
          function replaceConceptsInHtml(plantilla, data, field) {
              let conceptoAnualidadSelected = false;
              var meses = { '1': 'Enero', '2': 'Febrero', '3': 'Marzo', '4': 'Abril', '5': 'Mayo', '6': 'Junio', '7': 'Julio', '8': 'Agosto', '9': 'Septiembre', '10': 'Octubre', '11': 'Noviembre', '12': 'Diciembre' };
              let fecha = new Date();
              for (let concepto in data) {
                  console.log('CB Concepto >>> ', concepto);
                  console.log('CB Concepto Data >>> ',data[concepto]);
                  let includesAnualidad = concepto.includes('Anualidad');
                  data[concepto].precioFinalReemplazo = concepto == 'Mensualidad Premium' ? `(!PrecioFinal.${concepto}(?!\\sPlus))` : `(!PrecioFinal.${concepto})`;
                  data[concepto].bonificacionReemplazo = concepto == 'Mensualidad Premium' ? `(!Bonificacion.${concepto}(?!\\sPlus))` : `(!Bonificacion.${concepto})`;
                  data[concepto].vigenciaReemplazo = concepto == 'Mensualidad Premium' ? `(!vigencia.${concepto}(?!\\sPlus))` : `(!vigencia.${concepto})`;
  
                  plantilla[field] = plantilla[field].replace(new RegExp(data[concepto].bonificacionReemplazo, 'gi'), data[concepto].Bonificacion__c ? data[concepto].Bonificacion__c : conceptoAnualidadSelected && includesAnualidad ? '' : '0');
  
                  if (data[concepto].PrecioFinal__c == '' && concepto == 'Comisión por servicio piloto') {
                      plantilla[field] = plantilla[field].replace(new RegExp(data[concepto].precioFinalReemplazo, 'gi'), ' 0');
                  } else {
                      console.log('CB #4 entra en el else >> ', field);
                      plantilla[field] = plantilla[field].replace(new RegExp(data[concepto].precioFinalReemplazo, 'gi'), data[concepto].PrecioFinal__c ? (concepto == 'Comisión por el servicio' || concepto == 'Comisión por servicio piloto' || concepto == 'Comisión por Servicio Telepeaje') ? ` ${data[concepto].PrecioFinal__c}` : `$ ${data[concepto].PrecioFinal__c}` : conceptoAnualidadSelected && includesAnualidad ? '' : '');
                      console.log('CB #4 entra en el else >> ', plantilla[field]);
                  }
                  //  plantilla[field] = plantilla[field].replace(new RegExp( data[concepto].precioFinalReemplazo, 'gi' ), data[concepto].PrecioFinal__c ? (concepto == 'Comisión por servicio piloto' && data[concepto].PrecioFinal__c == 0 )  ?  ` ${data[concepto].PrecioFinal__c = '2'}` : `$ ${data[concepto].PrecioFinal__c = precioPiloto='2'}` : conceptoAnualidadSelected && includesAnualidad ? '' : '');
                  plantilla[field] = plantilla[field].replace(new RegExp(data[concepto].vigenciaReemplazo, 'gi'), data[concepto].VigenciaDescuento__c ? data[concepto].VigenciaDescuento__c : conceptoAnualidadSelected && includesAnualidad ? '' : ' ( N/A ) ');
                  plantilla[field] = plantilla[field].replace(new RegExp('!hoyDia', 'gi'), fecha.getDate());
                  plantilla[field] = plantilla[field].replace(new RegExp('!hoymes', 'gi'), meses[fecha.getMonth() + 1]);
                  plantilla[field] = plantilla[field].replace(new RegExp('!hoyanio', 'gi'), fecha.getFullYear());
                  //plantilla.AnexoA = plantilla.AnexoA__c.replace(new RegExp('!hoyDia', 'gi'), fecha.getDate());
                  conceptoAnualidadSelected = (!conceptoAnualidadSelected && concepto.includes('Anualidad')) ? true : conceptoAnualidadSelected;
              }
          }
  
          function setDisplayAttribute(plantilla, concepts) {
              let elementos = $(".conceptForm");
              /*var totalConceptos = ['Comisión por el servicio', 'Comisión por servicio piloto', 'Cargo por envío - Recurrente', 'Cargo por refacturacion', 'Anualidad - Grande',
                              'Anualidad - Pyme', 'Cuota por impresión de logo a color', 'Cuota por renta mensual TAG', 'Cuota por transacción con TAG',
                              'TAG Ticket Car', 'Cargo por tarjeta activa', 'Reposición de tarjetas', 'Tarjeta titular', 'Cuota de adscripción - Grande', 'Cuota de adscripción - Pyme', 'Renta de plataforma', 'Cobro por gestion de vehiculos',
                              'Cargo por envío','Vehiculo/Mes NFC',  'Tarjeta stock', 'Etiqueta de Presencia TAG NFC'];*/
  
              elementos.each(function (index, element) {
                  let includeRow = false;
  
                  concepts.forEach(concepto => {
                      console.log('==>concepto.Concepto_Tipo_Cargo__c: ' , concepto.Concepto_Tipo_Cargo__c);
                      if ( $(element).attr("id").includes(concepto.Concepto_Tipo_Cargo__c)) {
                          
                          includeRow = true;
                          console.log('Concepto a mostrar ' + $(element).attr("id") );
                          if(concepto.Concepto_Tipo_Cargo__c == 'Mensualidad Premium' && ($(element).attr("id").includes('Plus'))) {
                              includeRow = false;
                          }
                      }
                  });
  
                  if (!includeRow) {
                      $(element).css("display", "none");
                      console.log('Concepto para NO mostrar ' + $(element).attr("id") );
                  }
              });
          }
  
          function replaceStr(textHml, datasource) {
              textHml = textHml.replace(/<img src\=\"https\:\/\/\:0\/\">/g, '<p></p>');
              textHml = textHml.replace(/<img src="\/\/\:0"><\/img>/g, '<p></p>');
              //NVH -- Arg
                var productLogos = {
                    'XC': '{!URLFOR($Resource.tcContractLogo)}',
                    'YC': '{!URLFOR($Resource.tcContractLogoShell)}'
                };

                if (productsArgCodes.includes(datasource.Product2.ProductCode)) {
                    var logoUrl = productLogos[datasource.Product2.ProductCode];
                    var footer = '<div align="center" style="width: 100%;"><a href="https://edenred.com.ar/" target="_blank"><img src="' + logoUrl + '" alt="TC footer"></img></a></div>';
                    textHml = textHml.replace('[!footer]', footer);
                }
                var expresiones = getExpresiones(textHml)
              console.log("expresiones: ", expresiones)
              Object.keys(expresiones).forEach(function (expresion, index) {
                  var path = expresion.split('\.');
                  var data = '';
                  var valor = ctcLightning.path(expresion, datasource)
                  if (expresion.indexOf('FechaContrato__c') != -1 && valor) {
                      valor = getDate(valor)
                  }
                  if (valor == undefined) {
                      valor = ''
                  }
  
                  if (typeof (valor) == 'boolean') {
                      if (valor) {
                          valor = '<span class="fa fa-check-square-o"></span>';
                      } else {
                          valor = '<span class="fa fa-square-o"></span>';
                      }
                  }
  
                  if (expresion && expresion.indexOf('IMG__c') != -1) {
                      var resource = 'IMGTARJETASECOVALE/' + expresion.substring(expresion.indexOf('/') + 1, expresion.length)
                      valor = '<img class="imgInternaEcovale" src="{!URLFOR($Resource.TarjetasContratoEcovale, "' + resource + '" )}" />'
  
                      console.log('valor: ', valor);
                      //valor = '<img src="{!URLFOR(' + resource + ')}" />'
                  }
  
                  expresiones[expresion] = valor;
              })
  
              Object.keys(expresiones).forEach(function (expresion, index) {
                  var reg = new RegExp('\{\!' + expresion + '\}', 'g')
                  textHml = textHml.replace(reg, expresiones[expresion])
              })
              return textHml;
          }
  
          function html(textHtml, dataSource) {
              var e = document.createElement('div');
              e.innerHTML = textHtml;
              textHtml = e.childNodes[0].nodeValue;
  
              textHtml = textHtml.replace(/font-family: Calibri;/g, 'font-family: Helvetica;');
              textHtml = textHtml.replace(/font-family: Arial;/g, 'font-family: Helvetica;');
              textHtml = textHtml.replace(/<ul/g, '<p');
              textHtml = textHtml.replace(/<u/g, '<p');
              textHtml = textHtml.replace(/<\/u/g, '</p');
              textHtml = textHtml.replace(/<\/ul/g, '</p');
              textHtml = textHtml.replace(/<li/g, '<p');
              textHtml = textHtml.replace(/<\/li/g, '</p');
              textHtml = textHtml.replace(/‐/g, '-');
              textHtml = textHtml.replace(/<img src\=\"https\:\/\/\:0\/\">/g, '<p></p>');
              textHtml = textHtml.replace(/<img src="\/\/\:0"><\/img>/g, '<p></p>');
              textHtml = replaceStr(textHtml, dataSource);
  
              return textHtml;
          }
  
          function getDate(dateSF) {
              var a = new Date(dateSF);
              var months = ['Enero', 'Febrero', 'Marzo', 'Abril', 'Mayo', 'Junio', 'Julio', 'Agosto', 'Septiembre', 'Octubre', 'Noviembre', 'Diciembre'];
              var year = a.getFullYear();
              var month = months[a.getMonth()];
              var date = a.getDate();
              var hour = a.getHours();
              var min = a.getMinutes();
              var sec = a.getSeconds();
              var date = date + ' de ' + month + ' del ' + year;
              return date;
          }
  
          function isDate(date) {
              return (new Date(date) !== "Invalid Date" && !isNaN(new Date(date))) ? true : false;
          }
  
          /*
          * Name: isMerchand
          * Param: product[String]
          * Author: Fran Rojas <frojas@freewayconsulting.com>
          * Date: Nov 11, 2020
          * Desc: Validate if the Product is related to Merchand contracts
          * Comment: Added By Fran HU Contratos Merchand
          */
          function isMerchand(product, accountType){
              var merchand = false;
              if(accountType === 'RT_Afiliacion')
                  switch (product) {
                      case 'Ticket Car':
                          merchand = true;
                          break;
                      case 'Ticket Car + Fleet Edenred':
                          merchand = true;
                          break;
                      case 'Ticket Car + Fleet Edenred + G500':
                          merchand = true;
                          break;
                      case 'Ticket Car + Fleet Edenred + BP':
                          merchand = true;
                          break;
                      case 'Despensa':
                          merchand = true;
                          break;
                      case 'Multiproducto':
                          merchand = true;
                          break;
                      default:
                          merchand = false;
                  }
              return merchand;
          };
  
          function getContractName(strNameMaquila) {
              switch (strNameMaquila) {
                  case 'G500 FLEET':
                      return 'Contrato Ticket Car - Afiliados G500';
                  case 'BPfleet':
                      return 'Contrato Ticket Car - Afiliados BP';
              }
          }
      // CONVIERTE MONTO A LETRAS CONTINGENCIA
      var numeroALetras = (function() {
  
      // Código basado en https://gist.github.com/alfchee/e563340276f89b22042a
      function Unidades(num){
  
          switch(num)
          {
              case 1: return 'UN';
              case 2: return 'DOS';
              case 3: return 'TRES';
              case 4: return 'CUATRO';
              case 5: return 'CINCO';
              case 6: return 'SEIS';
              case 7: return 'SIETE';
              case 8: return 'OCHO';
              case 9: return 'NUEVE';
          }
  
          return '';
      }//Unidades()
  
      function Decenas(num){
  
          let decena = Math.floor(num/10);
          let unidad = num - (decena * 10);
  
          switch(decena)
          {
              case 1:
                  switch(unidad)
                  {
                      case 0: return 'DIEZ';
                      case 1: return 'ONCE';
                      case 2: return 'DOCE';
                      case 3: return 'TRECE';
                      case 4: return 'CATORCE';
                      case 5: return 'QUINCE';
                      default: return 'DIECI' + Unidades(unidad);
                  }
              case 2:
                  switch(unidad)
                  {
                      case 0: return 'VEINTE';
                      default: return 'VEINTI' + Unidades(unidad);
                  }
              case 3: return DecenasY('TREINTA', unidad);
              case 4: return DecenasY('CUARENTA', unidad);
              case 5: return DecenasY('CINCUENTA', unidad);
              case 6: return DecenasY('SESENTA', unidad);
              case 7: return DecenasY('SETENTA', unidad);
              case 8: return DecenasY('OCHENTA', unidad);
              case 9: return DecenasY('NOVENTA', unidad);
              case 0: return Unidades(unidad);
          }
      }//Unidades()
  
      function DecenasY(strSin, numUnidades) {
          if (numUnidades > 0)
              return strSin + ' Y ' + Unidades(numUnidades)
  
          return strSin;
      }//DecenasY()
  
      function Centenas(num) {
          let centenas = Math.floor(num / 100);
          let decenas = num - (centenas * 100);
  
          switch(centenas)
          {
              case 1:
                  if (decenas > 0)
                      return 'CIENTO ' + Decenas(decenas);
                  return 'CIEN';
              case 2: return 'DOSCIENTOS ' + Decenas(decenas);
              case 3: return 'TRESCIENTOS ' + Decenas(decenas);
              case 4: return 'CUATROCIENTOS ' + Decenas(decenas);
              case 5: return 'QUINIENTOS ' + Decenas(decenas);
              case 6: return 'SEISCIENTOS ' + Decenas(decenas);
              case 7: return 'SETECIENTOS ' + Decenas(decenas);
              case 8: return 'OCHOCIENTOS ' + Decenas(decenas);
              case 9: return 'NOVECIENTOS ' + Decenas(decenas);
          }
  
          return Decenas(decenas);
      }//Centenas()
  
      function Seccion(num, divisor, strSingular, strPlural) {
          let cientos = Math.floor(num / divisor)
          let resto = num - (cientos * divisor)
  
          let letras = '';
  
          if (cientos > 0) {
              if (cientos > 1) {
                  letras = Centenas(cientos) + ' ' + strPlural;
              } else {
                  letras = strSingular;
              }
          }
  
          if (resto > 0) {
              letras += '';
          }
  
          return letras;
      }//Seccion()
  
      function Miles(num) {
          let divisor = 1000;
          let cientos = Math.floor(num / divisor)
          let resto = num - (cientos * divisor)
  
          let strMiles = Seccion(num, divisor, 'UN MIL', 'MIL');
          let strCentenas = Centenas(resto);
  
          if(strMiles == '') {
              return strCentenas;
          }
  
          return strMiles + ' ' + strCentenas;
      }//Miles()
  
      function Millones(num) {
          let divisor = 1000000;
          let cientos = Math.floor(num / divisor)
          let resto = num - (cientos * divisor)
  
          let strMillones = Seccion(num, divisor, 'UN MILLON DE', 'MILLONES DE');
          let strMiles = Miles(resto);
  
          if(strMillones == '') {
              return strMiles;
          }
  
          return strMillones + ' ' + strMiles;
      }//Millones()
  
      return function NumeroALetras(num, currency) {
          currency = currency || {};
          let data = {
              numero: num,
              enteros: Math.floor(num),
              centavos: (((Math.round(num * 100)) - (Math.floor(num) * 100))),
              letrasCentavos: '',
              letrasMonedaPlural: currency.plural || 'PESOS CHILENOS',//'PESOS', 'Dólares', 'Bolívares', 'etcs'
              letrasMonedaSingular: currency.singular || 'PESO CHILENO', //'PESO', 'Dólar', 'Bolivar', 'etc'
              letrasMonedaCentavoPlural: currency.centPlural || 'CHIQUI PESOS CHILENOS',
              letrasMonedaCentavoSingular: currency.centSingular || 'CHIQUI PESO CHILENO'
          };
  
          if (data.centavos > 0) {
              data.letrasCentavos = 'CON ' + (function () {
                  if (data.centavos == 1) {
                      return Millones(data.centavos) + ' ' + data.letrasMonedaCentavoSingular;
                  } else {
                      return Millones(data.centavos) + ' ' + data.letrasMonedaCentavoPlural;
                  }
              })();
          };
  
          if(data.enteros == 0)
              return 'CERO ' + data.letrasMonedaPlural + ' ' + data.letrasCentavos;
          if (data.enteros == 1)
              return Millones(data.enteros) + ' ' + data.letrasMonedaSingular + ' ' + data.letrasCentavos;
          else
              return Millones(data.enteros) + ' ' + data.letrasMonedaPlural + ' ' + data.letrasCentavos;
      };
  
  })();
  
      </script>
      <style type="text/css">
          .ql-table-blob {
              border-collapse: collapse;
              border-color: black;
          }
  
          .borderedLeft {
              border-top-left-radius: 150px;
              border-bottom-left-radius: 150px;
              padding-top: 20px;
              padding-bottom: 20px;
              padding-left: 80px;
              margin-left: 20%;
              margin-top: 15px;
          }
  
          .borderedRight {
              width: 60%;
              margin-top: 15px;
              border-top-right-radius: 150px;
              border-bottom-right-radius: 150px;
              padding-top: 20px;
              padding-bottom: 20px;
              padding-right: 80px;
          }
  
          .page-template {
              position: absolute;
              width: 100%;
              top: 0;
              left: 0;
          }
  
          .page-template .watermark {
              font-weight: bold;
              font-size: 600%;
              text-align: center;
              margin-top: 70%;
              color: #424242;
              opacity: 0.1;
              transform: rotate(-55deg) scale(1.7, 1.5);
          }
  
          #pdfTemplateContenedor {
              width: 100%;
              font-size: 9pt;
              height: 1px;
              max-height: 1px;
              overflow: scroll;
              font-family: "Helvetica" !important;
              text-align: justify;
          }
  
          .page-template .header {
              position: absolute;
              top: 30px;
              left: 30px;
              right: 30px;
              text-align: right;
              font-size: 12px;
              height: 200px;
              margin-bottom: 2cm;
              /*border-bottom: 1px solid #888;*/
          }
  
          .header .logoEdenred {
              position: absolute;
              left: 5px;
              top: 0px;
              height: 30px;
          }
  
          .header .logoFleet {
              margin-top: 5px;
              margin-bottom: 5px;
              left: 5px;
              top: -5px;
              height: 25px;
          }
  
          .header .logoTC {
              position: absolute;
              left: 280px;
              top: 0px;
              height: 30px;
          }
  
          .header .logoOPAM2 {
              /*position: absolute;*/
              top: 0px;
              right: 0px;
              height: 30px;
          }
  
          .header .logoTC2 {
              position: absolute;
              left: 250px;
              top: 0px;
              height: 30px;
              font-size: 6pt;
          }
  
          .header .headerText {
              font-size: 4pt;
              position: absolute;
              left: 380px;
              top: 0px;
              height: 20px;
          }
  
          .header .headerText2 {
              font-size: 4pt;
              position: absolute;
              left: 600px;
              top: 0px;
              height: 20px;
          }
  
          #generaPDFButton {
              opacity: 0.0;
          }
  
          .tablas {
              border-collapse: collapse;
          }
  
          .tableFilial {
              width: 100%;
              border-collapse: collapse;
              border-spacing: 0;
              /*border: 1px solid black;*/
          }
  
          .tableFilial>thead>tr>th,
          .tableFilial>tbody>tr>td {
              border: 1px solid black;
              height: 16pt;
          }
  
          .pdfTemplateContenedor table {
              color: black !important;
          }
  
          .leyendaHeader {
              /*text-align: right;*/
              font-size: 5pt;
              position: absolute;
              right: 5px;
              top: 0px;
              height: 20px;
              line-height: 70%;
              margin-bottom: 0;
          }
  
          .leyendaHeaderOPAM {
              /*text-align: right;*/
              font-size: 5pt;
              position: absolute;
              right: 5px;
              top: 30px;
              height: 20px;
              line-height: 70%;
              margin-bottom: 0;
          }
  
          .headerContratos {
              border-style: solid;
          }
  
          .logoEdenred2 {
          /* position: absolute;*/
              left: 5px;
              top: 0px;
              height: 30px;
          }
  
          .logoEdenred3 {
              height: 40px;
          }
  
          .imgInternaEcovale {
              height: 80px;
          }
  
          .firmasContrato{
          page-break-after:avoid !important;
          }
          
          
          .page-templatef {
              position: absolute;
              width: 100%;
              top: 0;
              left: 0;
          }
          
          .page-templatef .footer {
              z-index:999999;      
              position:fixed; 
              bottom:0; 
              left: 0;
              width: 100%;
              background-color: red;
              color: white;
              text-align: center;
  
          }
          /*-Argentina-*/
        
    .seccionArg {
		margin: 40px 0;
	}
    .paddingArgTitle {
        padding-top: 40px;
        padding-bottom: 15px;
    }

    .paddingArgMin {
        padding-top: 15px;
    }

	.formatoPropuestaArg {
		width: 100%;
		margin: auto;
		display: block;
	}

	.descPropuestaArg {
		width: 85%;
		margin: auto;
	}

	.ribbonTituloArg {
		background-color: #F72717;
		height: 60px;
		width: 20px;
		border-radius: 300px;
		display: inline-block;
	}

	.tituloArg {
		display: inline-block;
		vertical-align: top;
	}

	.tituloArg span {
		font-family: 'Century Gothic', 'arial';
		color: #000000;
		font-size: 18px;
		font-weight: normal;
	}

	.tituloArg strong {
		font-family: 'Century Gothic', 'arial';
		color: #000000;
		font-size: 50px;
		font-weight: lighter;
	}

	.labelFormArg {
		font-family: 'Century Gothic', 'arial';
		font-weight: bold;
		color: black;
		font-size: 12px;
	}


	.camposArg {
		width: 100%;
		margin: 20px 0;
		vertical-align: top;
	}

	.descClienteArg {
		font-size: 12px;
		color: black;
		text-align: justify;
	}
    .tableDatosArg {
            font-family: "Ubuntu", sans-serif;
            font-weight: 300;
            font-style: normal;
        }
        
	.tablaArg {
		width: 100%;
		height: 100%;
		margin: auto;
		padding: 25px 0;
		border: 2px;
		border-collapse: collapse;
	}
	.headerArg {
		display: inline-block;
		text-align: left;
		padding: 5px 5%;
		width: 100%;
		background: #F72717
	}

	.headerArg span {
		font-family: 'Century Gothic', 'arial';
		font-size: 15px;
		color: white;
	}
	.ubuntu-lightArg {
		font-family: "Ubuntu", sans-serif;
		font-weight: 300;
		font-style: normal;
	}

	.theadArg {
		background-color: #F72717;
		color: white;
		font-family: sans-serif;
		font-style: normal;
        font-size: 10px;
	}
    
	.insideTableArg {
		font-size: 8px;
		text-decoration: underline;
	}

        
    /*Argentina Shell*/
	.ribbonTituloArgShell {
		background-color: #FFD300;
		height: 60px;
		width: 20px;
		border-radius: 300px;
		display: inline-block;
	}

	.headerArgShell {
		display: inline-block;
		text-align: left;
		padding: 5px 5%;
		width: 100%;
		background: #ffc72c
	}

	.headerArgShell span {
		font-family: 'Century Gothic', 'arial';
		font-size: 15px;
		color: #F72717;
	}

	.theadArgShell {
		background-color: #FFD300;
		color: #E30613;
		font-weight: 600;
		font-family: "Ubuntu", sans-serif;
	}

    .checkbox-cell {
            width: 30px;
            text-align: center;
            vertical-align: middle;
        }
        .custom-checkbox {
            display: inline-block;
            width: 14px;
            height: 14px;
            background-color: white;
            border: 1px solid #000;
            position: relative;
        }
        .checked {
            background-color: white;
            border: 1px solid #000;
            position: relative;
        }
        .text-cell {
		text-align: left;
		font-size: 12px;
	}
      </style>
      <apex:attribute name="QuoteLineItem" type="QuoteLineItem" required="true" description="QuoteLineItem" id="QuoteLineItem"/>
      <apex:attribute name="QuoteLineItemId" type="String" required="true" description="Id de QuoteLineItem" id="QuoteLineItemId"/>
      <apex:attribute name="QuoteLineItemName" type="String" required="false" description="Nombre de QuoteLineItem" />
      <apex:attribute name="AccountId" type="String" required="false" description="Id de la cuenta" />
      <apex:attribute name="FormaPago" type="String" required="false" description="Forma de pago" />
      <apex:attribute name="ProdCode" type="String" required="false" description="" />
  
      <head>
          <meta http-equiv="Content-Type" content="text/html; charset=ISO-8859-1" />
      </head>
  
      <!-- <div ng-controller="ticketPagoPorConsumo as ppc" id="ticketPagoPorConsumo"> -->
      <div id="pdfTemplateContenedor">
          <div id='pdfTemplate'>
              <div id="contentPdf">
  
              </div>
          </div>
      </div>
      <button id="generaPDFButton" type="submit" class="btn btn-primary buscar" onclick="generaPDF()">Muestra PDF</button>
      <!-- </div> -->
  
  </apex:component>